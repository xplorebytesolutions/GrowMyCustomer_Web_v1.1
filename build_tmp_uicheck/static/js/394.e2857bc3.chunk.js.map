{"version":3,"file":"static/js/394.e2857bc3.chunk.js","mappings":"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","sources":["pages/Workspaces/MessagingWorkspacePage.jsx"],"sourcesContent":["// üìÑ File: src/pages/Messaging/MessagingWorkspacePage.jsx\r\n\r\nimport {\n  ArrowRightCircle,\n  MoreVertical,\n  Archive,\n  Pin,\n  Send,\n  FileText,\r\n  BarChart3,\r\n  AlertTriangle,\r\n} from \"lucide-react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { useState } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\n\r\n// ‚úÖ server-authoritative permissions (can/hasAllAccess)\r\nimport { useAuth } from \"../../app/providers/AuthProvider\";\r\n// ‚úÖ centralized permission codes (FK)\r\nimport { FK } from \"../../capabilities/featureKeys\";\r\n// ‚úÖ upgrade flow (global UpgradeModal trigger)\r\nimport { requestUpgrade } from \"../../utils/upgradeBus\";\r\n// ‚úÖ quota helpers from Entitlements\r\nimport { useQuota } from \"../../app/providers/EntitlementsProvider\";\r\n\r\n// --- Permission map for each block (aligns with FK) ---\r\nconst PERM_BY_BLOCK = {\r\n  \"send-direct-text\": [FK.MESSAGING_SEND_TEXT],\r\n  \"send-template-message\": [FK.MESSAGING_SEND_TEMPLATE],\r\n  \"view-messaging-reports\": [FK.MESSAGING_REPORT_VIEW],\r\n  // \"status-logs\": [FK.MESSAGING_STATUS_VIEW],\r\n};\r\n\r\n// --- Cards (tiles) ---\r\nconst messageBlocks = [\r\n  {\r\n    id: \"send-direct-text\",\r\n    label: \"Send Non-Template Message\",\r\n    description: \"Send non-template messages to one or multiple contacts.\",\r\n    path: \"/app/messaging/send-direct-text\",\r\n    icon: <Send size={22} />,\r\n    action: \"Send Non-Template\",\r\n  },\r\n  {\r\n    id: \"send-template-message\",\r\n    label: \"Send Template Message\",\r\n    description:\r\n      \"Use approved WhatsApp templates for consistent, scalable messaging.\",\r\n    path: \"/app/messaging/send-template-message\",\r\n    icon: <FileText size={22} />,\r\n    action: \"Coming Soon\",\r\n  },\r\n  {\r\n    id: \"view-messaging-reports\",\r\n    label: \"Messaging Reports & Analytics\",\r\n    description:\r\n      \"Track delivery, reads, and performance of your WhatsApp campaigns.\",\r\n    path: \"/app/messaging/reports\",\r\n    icon: <BarChart3 size={22} />,\r\n    action: \"Coming Soon\",\r\n  },\r\n];\r\n\r\n// --- Quota summary banner for Messaging ---\r\nfunction MessagingQuotaSummary() {\r\n  const quota = useQuota(\"MESSAGES_PER_MONTH\");\r\n\r\n  if (!quota) return null;\r\n\r\n  const quotaKey =\r\n    (quota.quotaKey ||\r\n      quota.QuotaKey ||\r\n      quota.key ||\r\n      quota.Key ||\r\n      \"MESSAGES_PER_MONTH\") + \"\";\r\n\r\n  const periodRaw = quota.period || quota.Period || \"Monthly\";\r\n  const periodLabel = (periodRaw || \"Monthly\").toLowerCase();\r\n\r\n  const used =\r\n    typeof quota.consumed === \"number\"\r\n      ? quota.consumed\r\n      : typeof quota.Consumed === \"number\"\r\n      ? quota.Consumed\r\n      : 0;\r\n\r\n  const limit =\r\n    typeof quota.limit === \"number\"\r\n      ? quota.limit\r\n      : typeof quota.Limit === \"number\"\r\n      ? quota.Limit\r\n      : null;\r\n\r\n  const remaining =\r\n    typeof quota.remaining === \"number\"\r\n      ? quota.remaining\r\n      : typeof quota.Remaining === \"number\"\r\n      ? quota.Remaining\r\n      : null;\r\n\r\n  let pct = null;\r\n  if (limit && limit > 0) {\r\n    pct = Math.min(100, Math.round((used / limit) * 100));\r\n  }\r\n\r\n  const isLimited = limit != null;\r\n  const isLow =\r\n    isLimited && remaining != null\r\n      ? remaining <= Math.max(100, limit * 0.1)\r\n      : false;\r\n\r\n  return (\r\n    <div className=\"mb-4 rounded-xl border border-emerald-100 bg-emerald-50 p-4 flex items-center justify-between gap-4\">\r\n      <div>\r\n        <div className=\"text-sm font-semibold text-emerald-800\">\r\n          Messages ‚Äì current {periodLabel}\r\n        </div>\r\n\r\n        {!isLimited ? (\r\n          <div className=\"text-xs text-emerald-700 mt-1\">\r\n            Your current plan has{\" \"}\r\n            <span className=\"font-semibold\">no hard message limit</span>.\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div className=\"text-sm text-emerald-900 mt-1\">\r\n              <span className=\"font-semibold\">\r\n                {used.toLocaleString(\"en-IN\")}\r\n              </span>{\" \"}\r\n              used{\" \"}\r\n              <span className=\"text-xs text-emerald-700\">\r\n                / {limit.toLocaleString(\"en-IN\")} total\r\n              </span>\r\n            </div>\r\n            <div className=\"mt-2\">\r\n              <div className=\"h-2 w-full rounded-full bg-emerald-100 overflow-hidden\">\r\n                <div\r\n                  className=\"h-2 bg-emerald-600\"\r\n                  style={{ width: `${pct ?? 0}%` }}\r\n                />\r\n              </div>\r\n              {remaining != null && (\r\n                <div className=\"mt-1 text-[11px] text-emerald-700\">\r\n                  {remaining.toLocaleString(\"en-IN\")} messages remaining this{\" \"}\r\n                  {periodLabel}.\r\n                </div>\r\n              )}\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {isLimited && isLow && (\r\n        <button\r\n          type=\"button\"\r\n          className=\"text-xs px-3 py-2 rounded-lg bg-white border border-emerald-300 text-emerald-800 shadow-sm hover:bg-emerald-50\"\r\n          onClick={() =>\r\n            requestUpgrade({\r\n              reason: \"quota\",\r\n              quotaKey: quotaKey.toUpperCase(),\r\n              source: \"messaging.workspace.quota_banner\",\r\n            })\r\n          }\r\n        >\r\n          Upgrade plan\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function MessagingWorkspacePage() {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { isLoading, can, hasAllAccess, entLoading } = useAuth();\n\n  const hideWorkspaceTiles =\n    new URLSearchParams(location.search || \"\").get(\"flyout\") === \"1\";\n\n  const [pinned, setPinned] = useState(\n    JSON.parse(localStorage.getItem(\"messaging-pinned\") || \"[]\")\n  );\n  const [archived, setArchived] = useState(\r\n    JSON.parse(localStorage.getItem(\"messaging-archived\") || \"[]\")\r\n  );\r\n  const [order, setOrder] = useState(\r\n    JSON.parse(localStorage.getItem(\"messaging-order\")) ||\r\n      messageBlocks.map(b => b.id)\r\n  );\r\n\r\n  const togglePin = (e, id) => {\r\n    e.stopPropagation();\r\n    const updated = pinned.includes(id)\r\n      ? pinned.filter(i => i !== id)\r\n      : [...pinned, id];\r\n    setPinned(updated);\r\n    localStorage.setItem(\"messaging-pinned\", JSON.stringify(updated));\r\n  };\r\n\r\n  const toggleArchive = (e, id) => {\r\n    e.stopPropagation();\r\n    const updated = archived.includes(id)\r\n      ? archived.filter(i => i !== id)\r\n      : [...archived, id];\r\n    setArchived(updated);\r\n    localStorage.setItem(\"messaging-archived\", JSON.stringify(updated));\r\n  };\r\n\r\n  const onDragEnd = result => {\r\n    if (!result.destination) return;\r\n    const newOrder = Array.from(order);\r\n    const [moved] = newOrder.splice(result.source.index, 1);\r\n    newOrder.splice(result.destination.index, 0, moved);\r\n    setOrder(newOrder);\r\n    localStorage.setItem(\"messaging-order\", JSON.stringify(newOrder));\r\n  };\r\n\r\n  // Build list of blocks (we show both locked + unlocked)\r\n  const blocksWithAccess = order\r\n    .map(id => messageBlocks.find(b => b.id === id))\r\n    .filter(Boolean)\r\n    .filter(b => !archived.includes(b.id))\r\n    .map(block => {\r\n      const codes = PERM_BY_BLOCK[block.id] || [];\r\n      const allowed =\r\n        hasAllAccess || (Array.isArray(codes) && codes.some(code => can(code)));\r\n\r\n      return {\r\n        ...block,\r\n        allowed,\r\n        primaryCode: codes[0] || null,\r\n      };\r\n    });\r\n\r\n  // üîê Wait for both /auth/context and /entitlements\r\n  if (isLoading || entLoading) {\r\n    return (\r\n      <div className=\"p-10 text-center text-lg text-gray-500\">\r\n        Loading messaging features‚Ä¶\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const anyVisible = blocksWithAccess.length > 0;\r\n  const anyAllowed = blocksWithAccess.some(b => b.allowed);\r\n\r\n  if (hideWorkspaceTiles) {\n    return (\n      <div\n        className=\"p-6 bg-[#f5f6f7] min-h-[calc(100vh-80px)]\"\n        data-test-id=\"messaging-root\"\n      />\n    );\n  }\n\n  return (\n    <div className=\"p-6 bg-[#f5f6f7] min-h-[calc(100vh-80px)]\" data-test-id=\"messaging-root\">\n      {/* Emerald-themed border animation, same pattern as CRM / Catalog / Campaign */}\r\n      <style>{`\r\n        @keyframes drawRight { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n        @keyframes drawDown  { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n        @keyframes drawLeft  { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n        @keyframes drawUp    { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n\r\n        .tile:hover .topline    { animation: drawRight .9s ease forwards; }\r\n        .tile:hover .rightline  { animation: drawDown  .9s ease .18s forwards; }\r\n        .tile:hover .bottomline { animation: drawLeft  .9s ease .36s forwards; }\r\n        .tile:hover .leftline   { animation: drawUp    .9s ease .54s forwards; }\r\n      `}</style>\r\n\r\n      <h2 className=\"text-2xl font-bold text-emerald-800 mb-1\">\r\n        üí¨ Messaging Workspace\r\n      </h2>\r\n      <p className=\"text-sm text-slate-600 mb-4\">\r\n        Send one-off and template messages, and analyse messaging performance.\r\n      </p>\r\n\r\n      {/* Quota summary banner */}\r\n      <MessagingQuotaSummary />\r\n\r\n      {/* If tiles exist but all are locked ‚Üí show a ‚Äúrestricted‚Äù banner, like CRM/Catalog */}\r\n      {anyVisible && !anyAllowed && (\r\n        <div className=\"bg-amber-50 text-amber-800 p-4 border-l-4 border-amber-500 rounded-md mb-6 shadow-sm flex items-start gap-3\">\r\n          <AlertTriangle size={22} className=\"mt-1\" />\r\n          <div>\r\n            <strong>Locked messaging tools:</strong> Your current plan\r\n            doesn&apos;t include these messaging features.\r\n            <div className=\"text-sm mt-1 text-gray-600\">\r\n              Try opening a tile to see upgrade options, or contact your\r\n              administrator.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {anyVisible && (\r\n        <DragDropContext onDragEnd={onDragEnd}>\r\n          <Droppable droppableId=\"messaging-blocks\" direction=\"horizontal\">\r\n            {provided => (\r\n              <div\r\n                className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6\"\r\n                ref={provided.innerRef}\r\n                {...provided.droppableProps}\r\n              >\r\n                {blocksWithAccess.map((block, index) => {\r\n                  const baseCardClasses =\r\n                    \"tile group relative overflow-hidden rounded-md border bg-white shadow-sm transition transform hover:-translate-y-0.5 hover:shadow-md duration-200 focus:outline-none focus:ring-2 focus:ring-emerald-300 cursor-pointer\";\r\n                  const lockedClasses =\r\n                    \"opacity-70 border-dashed cursor-not-allowed hover:-translate-y-0 hover:shadow-sm\";\r\n\r\n                  const cardClasses = block.allowed\r\n                    ? baseCardClasses\r\n                    : `${baseCardClasses} ${lockedClasses}`;\r\n\r\n                  const handleCardClick = () => {\r\n                    if (!block.allowed) {\r\n                      if (block.primaryCode) {\r\n                        requestUpgrade({\r\n                          reason: \"feature\",\r\n                          code: block.primaryCode,\r\n                          source: \"messaging.workspace.tile\",\r\n                        });\r\n                      }\r\n                      return;\r\n                    }\r\n                    navigate(block.path);\r\n                  };\r\n\r\n                  const handlePrimaryActionClick = e => {\r\n                    e.stopPropagation();\r\n                    if (!block.allowed) {\r\n                      if (block.primaryCode) {\r\n                        requestUpgrade({\r\n                          reason: \"feature\",\r\n                          code: block.primaryCode,\r\n                          source: \"messaging.workspace.action\",\r\n                        });\r\n                      }\r\n                      return;\r\n                    }\r\n                    navigate(block.path);\r\n                  };\r\n\r\n                  return (\r\n                    <Draggable\r\n                      key={block.id}\r\n                      draggableId={block.id}\r\n                      index={index}\r\n                    >\r\n                      {provided => (\r\n                        <div\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                          role=\"button\"\r\n                          tabIndex={0}\r\n                          aria-label={`${block.label}: ${block.action}`}\r\n                          onKeyDown={e => {\r\n                            if (e.key === \"Enter\") handleCardClick();\r\n                          }}\r\n                          onClick={handleCardClick}\r\n                          className={cardClasses}\r\n                          style={{ userSelect: \"none\" }}\r\n                        >\r\n                          {/* üîí Upgrade badge for locked tiles */}\r\n                          {!block.allowed && (\r\n                            <span className=\"pointer-events-none absolute top-3 right-3 inline-flex items-center gap-1 rounded-full border border-dashed border-amber-500 bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700\">\r\n                              üîí Upgrade\r\n                            </span>\r\n                          )}\r\n\r\n                          {/* Emerald animated border segments */}\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"topline pointer-events-none absolute left-0 -top-[2px] h-[2px] w-full origin-left rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(90deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleX(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"rightline pointer-events-none absolute right-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-top rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(180deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleY(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"bottomline pointer-events-none absolute left-0 -bottom-[2px] h-[2px] w-full origin-right rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(270deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleX(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"leftline pointer-events-none absolute left-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-bottom rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(0deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleY(0)\",\r\n                            }}\r\n                          />\r\n\r\n                          {/* Card content ‚Äì same structure as CRM/Catalog/Campaign tiles */}\r\n                          <div className=\"flex items-start gap-4 p-5\">\r\n                            <div className=\"bg-emerald-50 rounded-md p-2 text-emerald-800\">\r\n                              {block.icon}\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                              <h3 className=\"text-md font-semibold text-emerald-800 group-hover:text-emerald-900\">\r\n                                {block.label}\r\n                              </h3>\r\n                              <p className=\"text-sm text-slate-600 workspace-tile-desc\">\n                                {block.description}\n                              </p>\n                            </div>\r\n\r\n                            {/* MoreVertical = drag handle only */}\r\n                            <div\r\n                              {...provided.dragHandleProps}\r\n                              title=\"Drag to re-order\"\r\n                              className=\"ml-2 rounded p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing\"\r\n                              onClick={e => e.stopPropagation()}\r\n                            >\r\n                              <MoreVertical size={16} />\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Footer actions */}\r\n                          <div className=\"px-5 py-3 border-t border-gray-200 flex items-center justify-between bg-gray-50\">\r\n                            <button\r\n                              onClick={handlePrimaryActionClick}\r\n                              className=\"text-sm text-gray-700 font-medium flex items-center gap-1 hover:text-gray-900\"\r\n                            >\r\n                              {block.allowed\r\n                                ? block.action\r\n                                : \"Upgrade to unlock\"}\r\n                              <ArrowRightCircle size={18} />\r\n                            </button>\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <button\r\n                                onClick={e => togglePin(e, block.id)}\r\n                                title={\r\n                                  pinned.includes(block.id) ? \"Unpin\" : \"Pin\"\r\n                                }\r\n                              >\r\n                                <Pin\r\n                                  size={18}\r\n                                  className={\r\n                                    pinned.includes(block.id)\r\n                                      ? \"text-red-600\"\r\n                                      : \"text-gray-400 hover:text-red-500\"\r\n                                  }\r\n                                />\r\n                              </button>\r\n                              <button\r\n                                onClick={e => toggleArchive(e, block.id)}\r\n                                title=\"Archive this\"\r\n                              >\r\n                                <Archive\r\n                                  size={18}\r\n                                  className={\r\n                                    archived.includes(block.id)\r\n                                      ? \"text-indigo-600\"\r\n                                      : \"text-gray-400 hover:text-indigo-500\"\r\n                                  }\r\n                                />\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  );\r\n                })}\r\n                {provided.placeholder}\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        </DragDropContext>\r\n      )}\r\n\r\n      {!anyVisible && (\r\n        <div className=\"bg-red-100 text-red-700 p-4 border-l-4 border-red-500 rounded-md mt-4 shadow-sm flex items-start gap-3\">\r\n          <AlertTriangle size={22} className=\"mt-1\" />\r\n          <div>\r\n            <strong>No messaging tiles:</strong> All messaging tools are\r\n            archived or hidden.\r\n            <div className=\"text-sm mt-1 text-gray-600\">\r\n              Un-archive some tiles to see them here.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["PERM_BY_BLOCK","FK","MESSAGING_SEND_TEXT","MESSAGING_SEND_TEMPLATE","MESSAGING_REPORT_VIEW","messageBlocks","id","label","description","path","icon","_jsx","Send","size","action","FileText","BarChart3","MessagingQuotaSummary","_pct","quota","useQuota","quotaKey","QuotaKey","key","Key","periodLabel","period","Period","toLowerCase","used","consumed","Consumed","limit","Limit","remaining","Remaining","pct","Math","min","round","isLimited","isLow","max","_jsxs","className","children","_Fragment","toLocaleString","style","width","concat","type","onClick","requestUpgrade","reason","toUpperCase","source","MessagingWorkspacePage","navigate","useNavigate","location","useLocation","isLoading","can","hasAllAccess","entLoading","useAuth","hideWorkspaceTiles","URLSearchParams","search","get","pinned","setPinned","useState","JSON","parse","localStorage","getItem","archived","setArchived","order","setOrder","map","b","blocksWithAccess","find","filter","Boolean","includes","block","codes","allowed","Array","isArray","some","code","_objectSpread","primaryCode","anyVisible","length","anyAllowed","AlertTriangle","DragDropContext","onDragEnd","result","destination","newOrder","from","moved","splice","index","setItem","stringify","Droppable","droppableId","direction","provided","ref","innerRef","droppableProps","baseCardClasses","cardClasses","handleCardClick","handlePrimaryActionClick","e","stopPropagation","Draggable","draggableId","draggableProps","role","tabIndex","onKeyDown","userSelect","background","transform","dragHandleProps","title","MoreVertical","ArrowRightCircle","togglePin","updated","i","Pin","toggleArchive","Archive","placeholder"],"sourceRoot":""}