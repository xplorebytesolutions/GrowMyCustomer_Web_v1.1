"use strict";(self.webpackChunkxbytechat_ui=self.webpackChunkxbytechat_ui||[]).push([[844],{25844:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var a=s(89379),n=s(65043),i=s(35870),r=s(57488),l=s(23156),d=s(70579);const o=e=>{switch((e||"").toLowerCase()){case"url":return(0,d.jsx)(l.f35,{className:"text-green-500"});case"phone_number":return(0,d.jsx)(l.Cab,{className:"text-green-500"});default:return(0,d.jsx)(l.w1Z,{className:"text-green-500"})}};const c=function(e){let{templateBody:t="",parameters:s=[],buttonParams:a=[],imageUrl:i=""}=e;const[r,l]=(0,n.useState)(!1),c=(()=>{let e=t||"";return s.forEach(((t,s)=>{const a=new RegExp("{{\\s*".concat(s+1,"\\s*}}"),"g");e=e.replace(a,(null===t||void 0===t?void 0:t.trim())||"{{".concat(s+1,"}}"))})),e})();return(0,n.useEffect)((()=>{l(!1)}),[i]),(0,d.jsxs)("div",{className:"p-5 bg-[#f7f6f3] rounded-lg shadow-inner max-w-sm",children:[(0,d.jsxs)("div",{className:"relative bg-white shadow-sm text-sm overflow-hidden border border-gray-200 rounded-tr-lg rounded-br-lg rounded-tl-lg rounded-bl-none",children:[(0,d.jsx)("div",{className:"absolute -left-[6px] top-3 w-0 h-0 border-t-[10px] border-t-transparent border-b-[10px] border-b-transparent border-r-[10px] border-r-white"}),(0,d.jsxs)("div",{className:"p-4 text-gray-800 whitespace-pre-wrap",children:[i&&(0,d.jsx)("div",{className:"mb-3",children:r?(0,d.jsx)("div",{className:"text-red-500 text-xs",children:"\u26a0\ufe0f Failed to load image preview."}):(0,d.jsx)("img",{src:i,alt:"Template Header",onError:()=>l(!0),className:"w-full max-h-60 object-cover rounded-md border"})}),c.split("\n").map(((e,t)=>(0,d.jsx)("p",{className:"mb-1",children:e},t)))]}),a.length>0&&(0,d.jsx)("div",{className:"border-t px-4 divide-y text-center",children:a.map(((e,t)=>(0,d.jsxs)("div",{className:"inline-flex items-center gap-2 py-3 text-green-600 font-medium justify-center w-full",children:[o(e.subType),(0,d.jsx)("span",{children:e.text})]},t)))})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 mt-2 text-left",children:"Template Preview"})]})};var m=s(60184);function x(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}function g(e){let{t:t,sending:s=!1,deleting:a=!1,onAssign:n,onViewRecipients:i,onSend:r,onPreview:l,onDelete:o}=e;const c=Number((null===t||void 0===t?void 0:t.recipients)||0),g=((null===t||void 0===t?void 0:t.status)||"").toString().toLowerCase(),u=((null===t||void 0===t?void 0:t.kind)||(null===t||void 0===t?void 0:t.templateType)||(null===t||void 0===t?void 0:t.type)||"").toString().toLowerCase(),p="image_header"===u||u.includes("image"),h=p?"Image Header":"Text Only",v=(null===t||void 0===t?void 0:t.createdAt)||(null===t||void 0===t?void 0:t.created_on)||(null===t||void 0===t?void 0:t.createdOn)||(null===t||void 0===t?void 0:t.created)||null,b=(null===t||void 0===t?void 0:t.sentAt)||(null===t||void 0===t?void 0:t.lastSentAt)||(null===t||void 0===t?void 0:t.dispatchedAt)||(null===t||void 0===t?void 0:t.deliveredAt)||null,y=(null===t||void 0===t?void 0:t.scheduledAt)||(null===t||void 0===t?void 0:t.queuedFor)||null,f=Boolean(b)||["sent","delivered","dispatched","completed"].includes(g),j=!f,N=c>0,w=c>0&&!f&&!a,C=c>0&&!f&&!s,S=(()=>{const e=((null===t||void 0===t?void 0:t.status)||"").toString().toLowerCase();return b||"sent"===e?"Sent":y||["scheduled","queued","queue","pending"].includes(e)?"Scheduled":"Not Sent"})(),k={Sent:{icon:m.A7C,color:"text-emerald-700",bg:"bg-emerald-50",border:"border-emerald-200"},Scheduled:{icon:m.w_X,color:"text-amber-700",bg:"bg-amber-50",border:"border-amber-200"},"Not Sent":{icon:m.TNq,color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200"}},A=k[S]||k["Not Sent"],R=A.icon;return(0,d.jsxs)("article",{className:"group relative flex h-full flex-col overflow-hidden rounded-xl bg-white shadow-sm border border-gray-200 transition-all duration-200 hover:shadow-md hover:border-gray-300",children:[(0,d.jsxs)("div",{className:"px-6 py-5 border-b border-gray-100",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-900 leading-tight line-clamp-2",children:(null===t||void 0===t?void 0:t.name)||"Untitled Campaign"}),(0,d.jsx)("div",{className:"mt-2 flex items-center gap-2",children:(0,d.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-md px-2.5 py-1 text-xs font-medium bg-gray-100 text-gray-700",children:[p?(0,d.jsx)(m.vqJ,{className:"text-xs"}):(0,d.jsx)(m.FrV,{className:"text-xs"}),h]})})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[l&&(0,d.jsx)("button",{onClick:l,type:"button",title:"Preview","aria-label":"Preview",className:"w-8 h-8 rounded-lg border border-gray-200 bg-white text-gray-600 hover:bg-gray-50 hover:border-gray-300 transition-colors flex items-center justify-center",children:(0,d.jsx)(m.Ny1,{className:"text-sm"})}),o&&(0,d.jsx)("button",{onClick:w?o:void 0,type:"button",title:"Delete campaign",disabled:!w,className:x("w-8 h-8 rounded-lg border transition-colors flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",w?"border-red-200 bg-red-50 text-red-600 hover:bg-red-100 hover:border-red-300":"border-gray-200 bg-gray-50 text-gray-300"),children:(0,d.jsx)(m.qbC,{className:"text-sm"})})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:x("inline-flex items-center gap-2 rounded-md px-3 py-1.5 text-xs font-medium",A.bg,A.color,A.border,"border"),children:[(0,d.jsx)(R,{className:"text-xs"}),S]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:c}),(0,d.jsx)("div",{className:"text-xs text-gray-500 font-medium",children:"Recipients"})]})]})]}),(0,d.jsx)("div",{className:"flex-1 px-6 py-5",children:(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,d.jsx)(m.bfZ,{className:"text-xs"}),(0,d.jsx)("span",{className:"text-xs font-medium",children:"Created"})]}),(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:v?new Date(v).toLocaleDateString():"\u2014"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,d.jsx)(m.Cer,{className:"text-xs"}),(0,d.jsx)("span",{className:"text-xs font-medium",children:"Last Sent"})]}),(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:b?new Date(b).toLocaleDateString():"\u2014"})]})]})}),(0,d.jsx)("div",{className:"px-6 py-3 border-t border-gray-100 bg-gray-50",children:(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)("button",{className:x("flex items-center justify-center gap-2 rounded-lg border px-3 py-2 text-xs font-medium transition-colors",j?"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300":"border-gray-200 bg-gray-50 text-gray-300 cursor-not-allowed"),onClick:j?n:void 0,type:"button",disabled:!j,title:j?"Assign recipients":"Campaign already sent",children:[(0,d.jsx)(m.NPy,{className:"text-xs"}),"Assign Recipients"]}),(0,d.jsxs)("button",{className:x("flex items-center justify-center gap-2 rounded-lg border px-3 py-2 text-xs font-medium transition-colors",N?"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300":"border-gray-200 bg-gray-50 text-gray-300 cursor-not-allowed"),onClick:N?i:void 0,type:"button",disabled:!N,title:N?"View recipients":"Add recipients first",children:[(0,d.jsx)(m.svy,{className:"text-xs"}),"View Recipients"]})]})}),(0,d.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-100",children:(0,d.jsx)("button",{className:x("w-full flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-semibold transition-colors",C?"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 shadow-lg hover:shadow-emerald-200":"bg-gray-100 text-gray-400 cursor-not-allowed"),disabled:!C||s,onClick:r,type:"button",title:C?"Send campaign":f?"Campaign already sent":"Add recipients first","aria-label":"Send campaign",children:s?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(m.gSK,{className:"text-sm"}),"Send Campaign"]})})})]})}function u(e){const t=(null===e||void 0===e?void 0:e.multiButtons)||(null===e||void 0===e?void 0:e.buttonParams)||(null===e||void 0===e?void 0:e.buttons)||[],s=(null===e||void 0===e?void 0:e.imageUrl)||null,a=(null===e||void 0===e?void 0:e.messageBody)||(null===e||void 0===e?void 0:e.templateBody)||(null===e||void 0===e?void 0:e.sampleBody)||(null===e||void 0===e?void 0:e.messageTemplate)||(null===e||void 0===e?void 0:e.body)||"",n=(null===e||void 0===e?void 0:e.createdAt)||(null===e||void 0===e?void 0:e.created_on)||(null===e||void 0===e?void 0:e.createdOn)||(null===e||void 0===e?void 0:e.created)||null,i=(null===e||void 0===e?void 0:e.sentAt)||(null===e||void 0===e?void 0:e.lastSentAt)||(null===e||void 0===e?void 0:e.dispatchedAt)||(null===e||void 0===e?void 0:e.deliveredAt)||(null===e||void 0===e?void 0:e.sent_at)||(null===e||void 0===e?void 0:e.sentOn)||(null===e||void 0===e?void 0:e.sent_on)||null,r=(null===e||void 0===e?void 0:e.scheduledAt)||(null===e||void 0===e?void 0:e.queuedFor)||(null===e||void 0===e?void 0:e.scheduled_at)||(null===e||void 0===e?void 0:e.queued_for)||null,l=(null===e||void 0===e?void 0:e.status)||(null===e||void 0===e?void 0:e.sendStatus)||(null===e||void 0===e?void 0:e.state)||null;return{id:null===e||void 0===e?void 0:e.id,name:(null===e||void 0===e?void 0:e.name)||"Untitled Campaign",kind:s?"image_header":"text_only",body:a,caption:(null===e||void 0===e?void 0:e.imageCaption)||(null===e||void 0===e?void 0:e.caption)||"",imageUrl:s,buttons:t,hasButtons:Array.isArray(t)&&t.length>0,recipients:(null===e||void 0===e?void 0:e.recipientCount)||0,createdAt:n,sentAt:i,scheduledAt:r,status:l,updatedAt:(null===e||void 0===e?void 0:e.updatedAt)||(null===e||void 0===e?void 0:e.updated_at)||n||null,raw:e}}var p=s(73216),h=s(21961),v=s(28605),b=s(67015),y=s(60446),f=s.n(y),j=s(8092),N=s.n(j);function w(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}function C(e,t,s){return Math.min(s,Math.max(t,e))}function S(e){let{hasRecipients:t,canDelete:s,onPreview:a,onViewRecipients:i,onViewLogs:r,onLogReport:l,onDelete:o}=e;const c=(0,n.useRef)(null);return(0,d.jsx)(h.W1,{as:"div",className:"relative ml-2 inline-block text-left",children:e=>{let{open:n}=e;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(h.W1.Button,{ref:c,className:"flex items-center justify-center w-8 h-8 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2",children:[(0,d.jsx)("span",{className:"sr-only",children:"Open options"}),(0,d.jsx)(m.H_v,{className:"h-4 w-4","aria-hidden":"true"})]}),(0,d.jsx)(k,{open:n,buttonRef:c,hasRecipients:t,canDelete:s,onPreview:a,onViewRecipients:i,onViewLogs:r,onLogReport:l,onDelete:o})]})}})}function k(e){let{open:t,buttonRef:s,hasRecipients:a,canDelete:i,onPreview:r,onViewRecipients:l,onViewLogs:o,onLogReport:c,onDelete:x}=e;const g=(0,n.useRef)(null),[u,p]=(0,n.useState)({top:0,left:0}),[y,f]=(0,n.useState)("origin-top-right"),[j,N]=(0,n.useState)(!1),S=(0,n.useCallback)((()=>{const e=null===s||void 0===s?void 0:s.current,t=null===g||void 0===g?void 0:g.current;if(!e||!t)return;const a=e.getBoundingClientRect(),n=t.getBoundingClientRect(),i=window.innerHeight-a.bottom-8,r=a.top-8,l=i<n.height&&r>i,d=C(l?a.top-n.height-8:a.bottom+8,8,Math.max(8,window.innerHeight-n.height-8)),o=C(a.right-n.width,8,Math.max(8,window.innerWidth-n.width-8));f(l?"origin-bottom-right":"origin-top-right"),p({top:d,left:o}),N(!0)}),[s]);return(0,n.useLayoutEffect)((()=>{if(!t)return void N(!1);N(!1);const e=requestAnimationFrame(S),s=requestAnimationFrame(S);return()=>{cancelAnimationFrame(e),cancelAnimationFrame(s)}}),[t,S]),(0,n.useEffect)((()=>{if(!t)return;const e=()=>S();return window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}}),[t,S]),(0,d.jsx)(v.ZL,{children:(0,d.jsx)(b.e,{show:t,as:n.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,d.jsxs)(h.W1.Items,{static:!0,ref:g,style:{position:"fixed",top:u.top,left:u.left,zIndex:60,visibility:j?"visible":"hidden"},className:w("w-48 rounded-xl bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none divide-y divide-gray-100 max-h-[60vh] overflow-auto",y),children:[(0,d.jsxs)("div",{className:"p-1",children:[(0,d.jsx)(h.W1.Item,{children:e=>{let{active:t}=e;return(0,d.jsxs)("button",{onClick:r,className:w(t?"bg-emerald-50 text-emerald-700":"text-gray-700","group flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm"),children:[(0,d.jsx)(m.Ny1,{className:"text-gray-400 group-hover:text-emerald-500"}),"Preview Template"]})}}),(0,d.jsx)(h.W1.Item,{disabled:!a,children:e=>{let{active:t,disabled:s}=e;return(0,d.jsxs)("button",{disabled:s,onClick:l,className:w(s?"text-gray-300 cursor-not-allowed":t?"bg-emerald-50 text-emerald-700":"text-gray-700","group flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm"),children:[(0,d.jsx)(m.YXz,{className:w("text-gray-400 group-hover:text-emerald-500",s&&"text-gray-300")}),"View Recipients"]})}}),(0,d.jsx)(h.W1.Item,{children:e=>{let{active:t}=e;return(0,d.jsxs)("button",{onClick:o,className:w(t?"bg-amber-50 text-amber-700":"text-gray-700","group flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm"),children:[(0,d.jsx)(m.OKX,{className:"text-gray-400 group-hover:text-amber-500"}),"View Logs"]})}}),(0,d.jsx)(h.W1.Item,{children:e=>{let{active:t}=e;return(0,d.jsxs)("button",{onClick:c,className:w(t?"bg-indigo-50 text-indigo-700":"text-gray-700","group flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm"),children:[(0,d.jsx)(m.v$b,{className:"text-gray-400 group-hover:text-indigo-500"}),"Log Report"]})}})]}),(0,d.jsx)("div",{className:"p-1",children:(0,d.jsx)(h.W1.Item,{disabled:!i,children:e=>{let{active:t,disabled:s}=e;return(0,d.jsxs)("button",{onClick:x,disabled:s,className:w(s?"text-gray-300 cursor-not-allowed":t?"bg-red-50 text-red-700":"text-gray-700","group flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm"),children:[(0,d.jsx)(m.qbC,{className:w("text-gray-400 group-hover:text-red-500",s&&"text-gray-300")}),"Delete Campaign"]})}})})]})})})}f().extend(N());const A=[{id:"all",label:"All",icon:m.v5n},{id:"image_header",label:"Image Header",icon:m.Ny1},{id:"text_only",label:"Text Only",icon:m.uO9},{id:"with_buttons",label:"With Buttons",icon:m.Cer},{id:"no_buttons",label:"No Buttons",icon:m.v$b}];function R(e){var t,s;let{item:a,onClose:n}=e;if(!a)return null;const i=a.body||a.messageBody||a.templateBody||"";let r=null!==(t=null!==(s=a.buttons)&&void 0!==s?s:a.multiButtons)&&void 0!==t?t:[];if("string"===typeof r)try{r=JSON.parse(r)}catch(m){r=[]}const l=a.imageUrl||a.mediaUrl||a.headerImageUrl||void 0,o=a.caption||a.imageCaption||"";return(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 p-4",onClick:n,children:(0,d.jsxs)("div",{className:"w-full max-w-2xl overflow-hidden rounded-2xl bg-white shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex items-center justify-between border-b px-6 py-4 bg-gradient-to-r from-slate-50 to-emerald-50",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-lg font-bold text-gray-900",children:a.name}),(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Template Preview"})]}),(0,d.jsx)("button",{className:"rounded-xl border border-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",onClick:n,children:"Close"})]}),(0,d.jsx)("div",{className:"p-6",children:(0,d.jsx)(c,{messageTemplate:i,multiButtons:r,imageUrl:l,caption:o,campaignId:a.id})}),(0,d.jsx)("div",{className:"flex items-center justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:(0,d.jsx)("button",{className:"rounded-xl border border-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",onClick:n,children:"Close"})})]})})}function L(e){let{open:t,target:s,usage:a,loading:i,deleting:r,onCancel:l,onConfirm:o}=e;const[c,m]=n.useState(!1),[x,g]=n.useState("");return t?(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 p-4",onClick:l,children:(0,d.jsxs)("div",{className:"w-full max-w-lg overflow-hidden rounded-2xl bg-white shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"border-b px-6 py-5 bg-red-50",children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Delete this campaign permanently?"}),(0,d.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[(0,d.jsx)("strong",{children:"This action can't be undone."})," Deleting will permanently remove this campaign and everything linked to it\u2014 its audience and recipients, any scheduled or queued sends, and the full history for this campaign (messages and activity)."]})]}),(0,d.jsxs)("div",{className:"px-6 py-5",children:[(0,d.jsx)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-4",children:i?(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"Loading campaign details\u2026"}):a?(0,d.jsxs)("ul",{className:"text-sm text-gray-800 space-y-2",children:[(0,d.jsxs)("li",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-500",children:"Name:"}),(0,d.jsx)("strong",{children:(null===s||void 0===s?void 0:s.name)||"Untitled"})]}),(0,d.jsxs)("li",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-500",children:"Status:"}),(0,d.jsx)("strong",{children:a.status})]}),(0,d.jsxs)("li",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-500",children:"Recipients:"}),(0,d.jsx)("strong",{children:a.recipients})]}),(0,d.jsxs)("li",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-500",children:"Scheduled/queued sends:"}),(0,d.jsx)("strong",{children:a.queuedJobs})]}),(0,d.jsxs)("li",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-gray-500",children:"Messages sent:"}),(0,d.jsx)("strong",{children:a.sendLogs})]})]}):(0,d.jsx)("div",{className:"text-sm text-gray-600",children:"No details available."})}),(0,d.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,d.jsxs)("label",{className:"flex items-start gap-3 text-sm text-gray-700",children:[(0,d.jsx)("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-300 text-red-600 focus:ring-red-400",checked:c,onChange:e=>m(e.target.checked)}),(0,d.jsx)("span",{children:"I understand this will permanently delete this campaign, its audience/recipients, any scheduled sends, and its history."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Type the campaign name to confirm:"}),(0,d.jsx)("input",{value:x,onChange:e=>g(e.target.value),placeholder:(null===s||void 0===s?void 0:s.name)||"Campaign name",className:"mt-2 w-full rounded-xl border border-gray-300 px-4 py-3 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-300 outline-none"})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[(0,d.jsx)("button",{className:"rounded-xl border border-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",onClick:l,disabled:r,children:"Cancel"}),(0,d.jsx)("button",{className:w("rounded-xl px-4 py-2 text-white font-medium transition-colors",r?"bg-red-400":"bg-red-600 hover:bg-red-700"),onClick:o,disabled:r||!c||(x||"").trim()!==((null===s||void 0===s?void 0:s.name)||"").trim(),children:r?"Deleting\u2026":"Permanently delete"})]})]})}):null}const _=function(){const[e,t]=(0,n.useState)([]),[s,l]=(0,n.useState)(!0),[o,c]=(0,n.useState)(null),[x,h]=(0,n.useState)(null),[v,b]=(0,n.useState)(""),[y,j]=(0,n.useState)(!1),[N,C]=(0,n.useState)("recent"),[k,_]=(0,n.useState)("all"),[D,F]=(0,n.useState)("table"),[T,B]=(0,n.useState)(null),[P,I]=(0,n.useState)(null),[V,q]=(0,n.useState)(null),[O,E]=(0,n.useState)(!1),[U,W]=(0,n.useState)(!1),[,z]=(0,n.useState)({pageIndex:0,pageSize:10,total:0}),H=(0,p.Zp)(),M=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||l(!0);try{var s,n;const e=await i.default.get("/campaign/get-image-campaign"),r=Array.isArray(e.data)?e.data:(null===(s=e.data)||void 0===s?void 0:s.items)||[];t(r);const l=Array.isArray(e.data)?e.data.length:(null===(n=e.data)||void 0===n?void 0:n.totalCount)||0;z((e=>(0,a.A)((0,a.A)({},e),{},{total:l})))}catch(d){console.error(d),e||r.oR.error("Failed to load campaigns")}finally{e||l(!1)}};(0,n.useEffect)((()=>{if(e.some((e=>"Processing"===e.status||"Sending"===e.status||"InFlight"===e.status))){const e=setInterval((()=>{M(!0)}),3e3);return()=>clearInterval(e)}}),[e]),(0,n.useEffect)((()=>{M()}),[]);const K=async e=>{c(e);try{await i.default.post("/campaign/send-campaign/".concat(e)),r.oR.success("\ud83d\ude80 Campaign sent successfully!"),M()}catch(t){console.error("\u274c Sending failed:",t),r.oR.error("\u274c Failed to send campaign")}finally{c(null)}},X=async e=>{I(e),q(null),E(!0);try{const t=await i.default.get("/campaign/".concat(e.id,"/usage"));q(t.data)}catch(t){console.error("Usage fetch failed",t),r.oR.error("\u274c Could not load campaign usage")}finally{E(!1)}},Z=(0,n.useMemo)((()=>e.map(u)),[e]),J=(0,n.useMemo)((()=>{let e=Z;if(v.trim()){const t=v.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.body.toLowerCase().includes(t)))}return y&&(e=e.filter((e=>e.recipients>0))),"all"!==k&&(e=e.filter((e=>"image_header"===k?"image_header"===e.kind:"text_only"===k?"text_only"===e.kind:"with_buttons"===k?e.hasButtons:"no_buttons"!==k||!e.hasButtons))),e=[...e].sort(((e,t)=>{if("name"===N)return e.name.localeCompare(t.name);if("recipients"===N)return t.recipients-e.recipients;const s=new Date(e.updatedAt||0).getTime();return new Date(t.updatedAt||0).getTime()-s})),e}),[Z,v,y,k,N]);return(0,d.jsx)("div",{className:"min-h-screen bg-[#f5f6f7]",children:(0,d.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-8",children:[(0,d.jsx)("div",{className:"mb-8",children:(0,d.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between",children:[(0,d.jsx)("div",{className:"flex items-center gap-4",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-emerald-600 to-emerald-500 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-600/20",children:(0,d.jsx)(m.svy,{className:"text-white text-xl"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Template Campaigns"}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage and send your WhatsApp template campaigns"})]})]})}),(0,d.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center",children:[(0,d.jsxs)("div",{className:"relative group",children:[(0,d.jsx)(m.KSO,{className:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-emerald-500 transition-colors"}),(0,d.jsx)("input",{value:v,onChange:e=>b(e.target.value),placeholder:"Search by name or message\u2026",className:"w-full lg:w-72 rounded-xl border border-gray-200 pl-12 pr-4 py-2.5 text-sm focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all shadow-sm"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700 cursor-pointer select-none",children:[(0,d.jsx)("input",{type:"checkbox",checked:y,onChange:e=>j(e.target.checked),className:"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),"Has recipients"]}),(0,d.jsxs)("select",{value:N,onChange:e=>C(e.target.value),className:"rounded-xl border border-gray-200 px-3 py-2.5 text-sm focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none shadow-sm cursor-pointer",children:[(0,d.jsx)("option",{value:"recent",children:"Sort: Recent"}),(0,d.jsx)("option",{value:"recipients",children:"Sort: Recipients"}),(0,d.jsx)("option",{value:"name",children:"Sort: Name"})]})]})]})]})}),(0,d.jsxs)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:[(0,d.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:A.map((e=>{const t=e.icon,s=k===e.id;return(0,d.jsxs)("button",{className:w("inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all",s?"bg-emerald-600 text-white shadow-md shadow-emerald-600/20":"bg-white text-gray-600 border border-transparent hover:bg-emerald-50 hover:text-emerald-700"),onClick:()=>_(e.id),children:[(0,d.jsx)(t,{className:w("w-3.5 h-3.5",s?"text-white":"text-gray-400")}),e.label]},e.id)}))}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("div",{className:"inline-flex items-center rounded-lg border border-gray-200 bg-white p-1",children:[(0,d.jsx)("button",{type:"button",className:w("inline-flex h-8 w-8 items-center justify-center rounded-md transition-all","grid"===D?"bg-emerald-50 text-emerald-700 shadow-sm":"text-gray-400 hover:text-gray-600"),onClick:()=>F("grid"),title:"Grid view",children:(0,d.jsx)(m.x7F,{className:"h-3.5 w-3.5"})}),(0,d.jsx)("button",{type:"button",className:w("inline-flex h-8 w-8 items-center justify-center rounded-md transition-all","table"===D?"bg-emerald-50 text-emerald-700 shadow-sm":"text-gray-400 hover:text-gray-600"),onClick:()=>F("table"),title:"Table view",children:(0,d.jsx)(m.ist,{className:"h-3.5 w-3.5"})})]}),(0,d.jsxs)("button",{onClick:M,className:"inline-flex items-center gap-2 rounded-xl border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-white hover:shadow-sm transition-all bg-white/50",title:"Refresh",children:[(0,d.jsx)(m.KP4,{className:w(s&&"animate-spin")}),"Refresh"]})]})]}),s&&(0,d.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map(((e,t)=>(0,d.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm animate-pulse",children:[(0,d.jsx)("div",{className:"h-40 w-full rounded-xl bg-gray-100"}),(0,d.jsx)("div",{className:"mt-4 h-6 w-2/3 rounded bg-gray-100"}),(0,d.jsx)("div",{className:"mt-2 h-4 w-1/3 rounded bg-gray-100"}),(0,d.jsx)("div",{className:"mt-4 h-20 w-full rounded bg-gray-100"}),(0,d.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,d.jsx)("div",{className:"h-10 w-24 rounded bg-gray-100"}),(0,d.jsx)("div",{className:"h-10 w-24 rounded bg-gray-100"}),(0,d.jsx)("div",{className:"h-10 w-24 rounded bg-gray-100"})]})]},t)))}),!s&&0===J.length&&(0,d.jsx)("div",{className:"mt-16 flex flex-col items-center justify-center text-center",children:(0,d.jsxs)("div",{className:"rounded-3xl border border-gray-200 p-12 shadow-sm bg-white max-w-lg",children:[(0,d.jsx)("div",{className:"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-r from-emerald-100 to-emerald-50",children:(0,d.jsx)(m.v5n,{className:"text-emerald-600 text-2xl"})}),(0,d.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"No template campaigns found"}),(0,d.jsx)("p",{className:"text-gray-600 mb-8",children:"Try adjusting your filters or create a new campaign to get started."}),(0,d.jsx)("button",{onClick:M,className:"rounded-xl border border-gray-200 px-6 py-3 font-semibold text-gray-700 hover:bg-gray-50 transition-colors",children:"Refresh List"})]})}),!s&&J.length>0&&"grid"===D&&(0,d.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:J.map((e=>{const t=o===e.id,s=x===e.id;return(0,d.jsx)(g,{t:e,sending:t,deleting:s,onPreview:()=>B(e),onSend:()=>K(e.id),onAssign:()=>H("/app/campaigns/image-campaigns/assign-contacts/".concat(e.id)),onViewRecipients:()=>H("/app/campaigns/image-campaigns/assigned-contacts/".concat(e.id)),onDelete:()=>X(e)},e.id)}))}),!s&&J.length>0&&"table"===D&&(0,d.jsxs)("div",{className:"overflow-hidden rounded-lg border border-slate-100 bg-white shadow-sm",children:[(0,d.jsx)("div",{className:"max-h-[70vh] overflow-auto",children:(0,d.jsxs)("table",{className:"w-full text-sm text-slate-900",children:[(0,d.jsx)("thead",{className:"sticky top-0 z-10 bg-gray-100 backdrop-blur text-left text-xs font-semibold tracking-wider text-gray-700 border-b border-gray-200",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-4 py-3 w-4"}),(0,d.jsx)("th",{className:"px-4 py-3",children:"Campaign Name"}),(0,d.jsx)("th",{className:"px-4 py-3",children:"Type"}),(0,d.jsx)("th",{className:"px-4 py-3 text-center",children:"Recipients"}),(0,d.jsx)("th",{className:"px-4 py-3 text-center",children:"Status"}),(0,d.jsx)("th",{className:"px-4 py-3",children:"Sent At"}),(0,d.jsx)("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-gray-100",children:J.map((e=>{const t=e.recipients>0,s=((null===e||void 0===e?void 0:e.status)||"").toString().toLowerCase(),a=Boolean(null===e||void 0===e?void 0:e.sentAt)||["sent","delivered","dispatched","completed"].includes(s),n=t&&!a;return(0,d.jsxs)("tr",{className:w("group hover:bg-gray-200 transition-colors",J.indexOf(e)%2===0?"bg-white":"bg-slate-50/40"),children:[(0,d.jsx)("td",{className:"px-4 py-3 align-middle",children:(0,d.jsx)("div",{className:w("w-1.5 h-8 rounded-full",t?"bg-emerald-500":"bg-gray-200"),title:t?"Ready to send":"No recipients assigned"})}),(0,d.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900 group-hover:text-indigo-800 align-middle",children:(0,d.jsx)("span",{className:"truncate max-w-[200px] xl:max-w-[300px]",title:e.name,children:e.name})}),(0,d.jsx)("td",{className:"px-4 py-3 text-gray-600 align-middle",children:(0,d.jsxs)("span",{className:w("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border","image_header"===e.kind?"bg-indigo-50 text-indigo-700 border-indigo-100":"bg-slate-50 text-slate-700 border-slate-200"),children:["image_header"===e.kind?(0,d.jsx)(m.Ny1,{className:"opacity-70"}):(0,d.jsx)(m.uO9,{className:"opacity-70"}),"image_header"===e.kind?"Image Header":"Text Only"]})}),(0,d.jsx)("td",{className:"px-4 py-3 text-center align-middle",children:(0,d.jsx)("button",{disabled:!t,onClick:()=>H("/app/campaigns/image-campaigns/assigned-contacts/".concat(e.id)),className:w("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium transition-colors",t?"bg-green-100 text-green-800 hover:bg-green-200 cursor-pointer":"bg-gray-100 text-gray-600 cursor-default"),title:t?"View assigned recipients":"",children:e.recipients})}),(0,d.jsx)("td",{className:"px-4 py-3 text-center align-middle",children:(0,d.jsxs)("span",{className:w("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border",a?"bg-emerald-50 text-emerald-700 border-emerald-100":"failed"===s?"bg-red-50 text-red-700 border-red-100":"sending"===s||"processing"===s?"bg-blue-50 text-blue-700 border-blue-100":"bg-amber-50 text-amber-700 border-amber-100"),title:null!==e&&void 0!==e&&e.status?"Status: ".concat(e.status):void 0,children:[(0,d.jsx)(m.Cer,{className:"opacity-70"}),a?"Sent":(null===e||void 0===e?void 0:e.status)||"Pending"]})}),(0,d.jsx)("td",{className:"px-4 py-3 text-gray-500 group-hover:text-gray-800 text-xs align-middle",children:(0,d.jsxs)("div",{className:"flex items-center gap-1.5",title:e.sentAt?new Date(e.sentAt).toLocaleString():"",children:[(0,d.jsx)(m.obD,{className:"text-gray-400 group-hover:text-gray-600"}),e.sentAt?f()(e.sentAt).fromNow():"\u2014"]})}),(0,d.jsx)("td",{className:"px-4 py-3 align-middle",children:(0,d.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{className:"inline-flex items-center gap-2 rounded-lg bg-emerald-50 px-3.5 py-1.5 text-sm font-semibold text-emerald-700 hover:bg-emerald-100 hover:text-emerald-800 transition-colors",onClick:()=>H("/app/campaigns/logs/".concat(e.id)),children:[(0,d.jsx)(m.OKX,{className:"text-emerald-600"}),"View Logs"]}),(0,d.jsxs)("button",{className:"inline-flex items-center gap-2 rounded-lg bg-indigo-50 px-3.5 py-1.5 text-sm font-semibold text-indigo-700 hover:bg-indigo-100 hover:text-indigo-800 transition-colors",onClick:()=>H("/app/campaigns/".concat(e.id,"/reports/logs")),children:[(0,d.jsx)(m.v$b,{className:"text-indigo-600"}),"Log Report"]})]}):t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"text-sm font-medium text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 px-3 py-1.5 rounded-md transition-colors",onClick:()=>H("/app/campaigns/image-campaigns/assign-contacts/".concat(e.id)),children:"Assign"}),(0,d.jsx)("button",{className:"ml-2 rounded-lg bg-emerald-600 px-3.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600 transition-all",onClick:()=>K(e.id),children:"Send"})]}):(0,d.jsx)("button",{className:"rounded-lg bg-emerald-600 px-3.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600 transition-all",onClick:()=>H("/app/campaigns/image-campaigns/assign-contacts/".concat(e.id)),children:"Assign Contacts"}),(0,d.jsx)(S,{hasRecipients:t,canDelete:n,onPreview:()=>B(e),onViewRecipients:()=>H("/app/campaigns/image-campaigns/assigned-contacts/".concat(e.id)),onViewLogs:()=>H("/app/campaigns/logs/".concat(e.id)),onLogReport:()=>H("/app/campaigns/".concat(e.id,"/reports/logs")),onDelete:()=>X(e)})]})})]},e.id)}))})]})}),(0,d.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 px-6 py-4 text-sm text-slate-600 bg-slate-50/50 border-t border-slate-100",children:(0,d.jsx)("div",{className:"flex items-center gap-4",children:(0,d.jsx)("span",{className:"text-xs font-medium text-slate-700",children:J.length>0?(0,d.jsxs)(d.Fragment,{children:["Showing"," ",(0,d.jsxs)("span",{className:"font-semibold text-emerald-700",children:["1-",J.length]})," ","of"," ",(0,d.jsx)("span",{className:"font-semibold text-slate-900",children:J.length})," ","campaigns"]}):"No campaigns"})})})]}),(0,d.jsx)(R,{item:T,onClose:()=>B(null)}),(0,d.jsx)(L,{open:!!P,target:P,usage:V,loading:O,deleting:U,onCancel:()=>{I(null),q(null),E(!1),W(!1)},onConfirm:async()=>{if(P){W(!0),h(P.id);try{var e;const t=await i.default.delete("/campaign/".concat(P.id),{params:{force:!0}});r.oR.success((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"\ud83d\uddd1\ufe0f Campaign deleted permanently."),I(null),q(null),await M()}catch(d){var t,s,a,n,l;console.error("Delete failed",d);const e=(null===d||void 0===d||null===(t=d.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"\u274c Failed to delete campaign.";409===(null===d||void 0===d||null===(a=d.response)||void 0===a?void 0:a.status)?r.oR.error(e||"\u274c Cannot delete while campaign is sending. Cancel or wait."):400===(null===d||void 0===d||null===(n=d.response)||void 0===n?void 0:n.status)?r.oR.error(e||"\u274c Delete failed \u2014 only draft campaigns can be deleted without force."):404===(null===d||void 0===d||null===(l=d.response)||void 0===l?void 0:l.status)?r.oR.error("\u274c Campaign not found."):r.oR.error(e)}finally{W(!1),h(null)}}}},(null===P||void 0===P?void 0:P.id)||"closed")]})})}}}]);
//# sourceMappingURL=844.d97a4769.chunk.js.map