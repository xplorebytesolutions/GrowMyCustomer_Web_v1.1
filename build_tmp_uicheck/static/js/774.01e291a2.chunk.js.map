{"version":3,"file":"static/js/774.01e291a2.chunk.js","mappings":"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","sources":["../node_modules/lucide-react/src/icons/circle-user-round.ts","pages/Workspaces/CrmWorkspacePage.jsx"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M18 20a6 6 0 0 0-12 0', key: '1qehca' }],\n  ['circle', { cx: '12', cy: '10', r: '4', key: '1h16sb' }],\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n];\n\n/**\n * @component @name CircleUserRound\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTggMjBhNiA2IDAgMCAwLTEyIDAiIC8+CiAgPGNpcmNsZSBjeD0iMTIiIGN5PSIxMCIgcj0iNCIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/circle-user-round\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleUserRound = createLucideIcon('circle-user-round', __iconNode);\n\nexport default CircleUserRound;\n","// üìÑ File: src/pages/Workspaces/CrmWorkspacePage.jsx\r\n\r\nimport {\r\n  Archive,\r\n  Pin,\r\n  ArrowRightCircle,\r\n  UserCircle2,\r\n  Tags,\r\n  BellRing,\n  Clock4,\n  StickyNote,\n  MoreVertical,\n  AlertTriangle,\r\n  SlidersHorizontal, // ‚úÖ NEW (Attribute tile icon)\r\n} from \"lucide-react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { useState, useMemo } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\n\r\n// ‚úÖ server-authoritative AuthProvider\r\nimport { useAuth } from \"../../app/providers/AuthProvider\";\r\n// üîî Global upgrade flow\r\nimport { requestUpgrade } from \"../../utils/upgradeBus\";\r\nimport { FK } from \"../../capabilities/featureKeys\";\r\n\r\n/**\r\n * üîê Map CRM blocks to EXACT Permission.Code values from your back end.\r\n */\r\n\r\nconst PERM_BY_BLOCK = {\r\n  contacts: [FK.CRM_CONTACT_VIEW],\r\n  tags: [FK.CRM_TAGS_VIEW],\r\n  reminders: [FK.CRM_REMINDERS_VIEW],\r\n  timeline: [FK.CRM_TIMELINE_VIEW],\n  notes: [FK.CRM_NOTES_VIEW],\n  attributes: FK.CRM_ATTRIBUTE_VIEW, // ‚úÖ NEW TILE\r\n};\r\n\r\nconst crmBlocks = [\r\n  {\r\n    id: \"contacts\",\r\n    label: \"Contacts\",\r\n    description: \"Central place to manage leads, customers, and their details.\",\r\n    path: \"/app/crm/contacts\",\r\n    icon: <UserCircle2 size={22} />,\r\n    action: \"Open Contacts\",\r\n  },\r\n  {\r\n    id: \"tags\",\r\n    label: \"Tags\",\r\n    description: \"Organize and filter contacts using color-coded tags.\",\r\n    path: \"/app/crm/tags\",\r\n    icon: <Tags size={22} />,\r\n    action: \"Manage Tags\",\r\n  },\r\n\r\n  // ‚úÖ NEW TILE: Attribute (Custom Fields)\r\n  {\r\n    id: \"attributes\",\r\n    label: \"Attribute\",\r\n    description:\r\n      \"Create and manage custom attributes for contacts (dynamic fields).\",\r\n    path: \"/app/crm/attributes\", // ‚úÖ make sure your App route exists\r\n    icon: <SlidersHorizontal size={22} />,\r\n    action: \"Open Attributes\",\r\n  },\r\n\r\n  {\r\n    id: \"reminders\",\r\n    label: \"Reminders\",\r\n    description: \"Schedule follow-ups and set alerts to never miss a lead.\",\r\n    path: \"/app/crm/reminders\",\r\n    icon: <BellRing size={22} />,\r\n    action: \"View Reminders\",\r\n  },\r\n  {\n    id: \"timeline\",\n    label: \"Timeline\",\n    description: \"Track every interaction and touchpoint with each contact.\",\n    path: \"/app/crm/timeline\",\n    icon: <Clock4 size={22} />,\n    action: \"View Timeline\",\n  },\n  {\n    id: \"notes\",\n    label: \"Notes\",\n    description: \"Capture notes and key details for each contact.\",\n    path: \"/app/crm/notes\",\n    icon: <StickyNote size={22} />,\n    action: \"Open Notes\",\n  },\n];\n\r\nexport default function CrmWorkspacePage() {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { isLoading, entLoading, hasAllAccess, can } = useAuth();\n\n  const hideWorkspaceTiles =\n    new URLSearchParams(location.search || \"\").get(\"flyout\") === \"1\";\n\r\n  // --- LocalStorage keys under \"crm-*\"\r\n  const [pinned, setPinned] = useState(\r\n    JSON.parse(localStorage.getItem(\"crm-pinned\") || \"[]\")\r\n  );\r\n  const [archived, setArchived] = useState(\r\n    JSON.parse(localStorage.getItem(\"crm-archived\") || \"[]\")\r\n  );\r\n\r\n  // Seed order with all current ids; reconcile with any saved order\r\n  const allIds = useMemo(() => crmBlocks.map(b => b.id), []);\r\n  const storedOrder =\r\n    JSON.parse(localStorage.getItem(\"crm-order\") || \"null\") || [];\r\n  const initialOrder = useMemo(() => {\r\n    if (!Array.isArray(storedOrder) || storedOrder.length === 0) return allIds;\r\n    const known = storedOrder.filter(id => allIds.includes(id));\r\n    const missing = allIds.filter(id => !known.includes(id));\r\n    return [...known, ...missing];\r\n  }, [allIds]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const [order, setOrder] = useState(initialOrder);\r\n  const [showArchived, setShowArchived] = useState(false);\r\n\r\n  const togglePin = (e, id) => {\r\n    e.stopPropagation();\r\n    const updated = pinned.includes(id)\r\n      ? pinned.filter(i => i !== id)\r\n      : [...pinned, id];\r\n    setPinned(updated);\r\n    localStorage.setItem(\"crm-pinned\", JSON.stringify(updated));\r\n  };\r\n\r\n  const toggleArchive = (e, id) => {\r\n    e.stopPropagation();\r\n    const updated = archived.includes(id)\r\n      ? archived.filter(i => i !== id)\r\n      : [...archived, id];\r\n    setArchived(updated);\r\n    localStorage.setItem(\"crm-archived\", JSON.stringify(updated));\r\n  };\r\n\r\n  const onDragEnd = result => {\r\n    if (!result.destination) return;\r\n    const newOrder = Array.from(order);\r\n    const [moved] = newOrder.splice(result.source.index, 1);\r\n    newOrder.splice(result.destination.index, 0, moved);\r\n    setOrder(newOrder);\r\n    localStorage.setItem(\"crm-order\", JSON.stringify(newOrder));\r\n  };\r\n\r\n  // Build list of blocks (show both locked + unlocked)\r\n  const blocksWithAccess = order\r\n    .map(id => crmBlocks.find(b => b.id === id))\r\n    .filter(Boolean)\r\n    .filter(b => (showArchived ? true : !archived.includes(b.id)))\r\n    .map(block => {\r\n      const codes = PERM_BY_BLOCK[block.id] || [];\r\n      const codeList = Array.isArray(codes) ? codes : [codes].filter(Boolean);\r\n      const allowed =\r\n        hasAllAccess ||\r\n        (codeList.length > 0 &&\r\n          typeof can === \"function\" &&\r\n          codeList.some(code => can(code)));\r\n\r\n      return {\r\n        ...block,\r\n        allowed,\r\n        primaryCode: codeList[0] || null,\r\n      };\r\n    });\r\n\r\n  const anyVisible = blocksWithAccess.length > 0;\r\n  const anyAllowed = blocksWithAccess.some(b => b.allowed);\r\n\r\n  if (isLoading || entLoading) {\r\n    return (\r\n      <div className=\"p-10 text-center text-lg text-gray-500\">\r\n        Loading CRM features‚Ä¶\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (hideWorkspaceTiles) {\n    return (\n      <div\n        className=\"p-6 bg-[#f5f6f7] min-h-[calc(100vh-80px)]\"\n        data-test-id=\"crm-root\"\n      />\n    );\n  }\n\n  return (\n    <div className=\"p-6 bg-[#f5f6f7] min-h-[calc(100vh-80px)]\" data-test-id=\"crm-root\">\n\r\n      {/* Emerald animated border, same pattern as Automation workspace */}\r\n      <style>{`\r\n        @keyframes drawRight { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n        @keyframes drawDown  { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n        @keyframes drawLeft  { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n        @keyframes drawUp    { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n\r\n        .tile:hover .topline    { animation: drawRight .9s ease forwards; }\r\n        .tile:hover .rightline  { animation: drawDown  .9s ease .18s forwards; }\r\n        .tile:hover .bottomline { animation: drawLeft  .9s ease .36s forwards; }\r\n        .tile:hover .leftline   { animation: drawUp    .9s ease .54s forwards; }\r\n      `}</style>\r\n\r\n      <div className=\"flex justify-between items-center mb-4\">\r\n        <h2 className=\"text-2xl font-bold text-emerald-800\">\r\n          üìá CRM Workspace\r\n        </h2>\r\n        <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={showArchived}\r\n            onChange={() => setShowArchived(!showArchived)}\r\n            className=\"accent-emerald-600\"\r\n          />\r\n          Show Archived\r\n        </label>\r\n      </div>\r\n\r\n      <p className=\"text-sm text-slate-600 mb-4\">\r\n        Manage contacts, tags, reminders, and interaction timelines in one\r\n        place.\r\n      </p>\r\n\r\n      {/* If tiles exist but all are locked ‚Üí show restricted banner */}\r\n      {anyVisible && !anyAllowed && (\r\n        <div className=\"bg-amber-50 text-amber-800 p-4 border-l-4 border-amber-500 rounded-md mb-6 shadow-sm flex items-start gap-3\">\r\n          <AlertTriangle size={22} className=\"mt-1\" />\r\n          <div>\r\n            <strong>Locked CRM tools:</strong> Your current plan doesn&apos;t\r\n            include these CRM features.\r\n            <div className=\"text-sm mt-1 text-gray-600\">\r\n              Try opening a tile to see upgrade options, or contact your\r\n              administrator.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {anyVisible && (\r\n        <DragDropContext onDragEnd={onDragEnd}>\r\n          <Droppable droppableId=\"crm-blocks\" direction=\"horizontal\">\r\n            {provided => (\r\n              <div\r\n                className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6\"\r\n                ref={provided.innerRef}\r\n                {...provided.droppableProps}\r\n              >\r\n                {blocksWithAccess.map((block, index) => {\r\n                  const baseCardClasses =\r\n                    \"tile group relative overflow-hidden rounded-md border bg-white shadow-sm transition duration-200 hover:-translate-y-0.5 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-emerald-300 cursor-pointer\";\r\n                  const lockedClasses =\r\n                    \"opacity-70 border-dashed cursor-not-allowed hover:-translate-y-0 hover:shadow-sm\";\r\n\r\n                  const cardClasses = block.allowed\r\n                    ? baseCardClasses\r\n                    : `${baseCardClasses} ${lockedClasses}`;\r\n\r\n                  const handleCardClick = () => {\r\n                    if (!block.allowed) {\r\n                      if (block.primaryCode) {\r\n                        requestUpgrade({\r\n                          reason: \"feature\",\r\n                          code: block.primaryCode,\r\n                          source: \"crm.workspace.tile\",\r\n                        });\r\n                      }\r\n                      return;\r\n                    }\r\n                    navigate(block.path);\r\n                  };\r\n\r\n                  const handlePrimaryActionClick = e => {\r\n                    e.stopPropagation();\r\n                    if (!block.allowed) {\r\n                      if (block.primaryCode) {\r\n                        requestUpgrade({\r\n                          reason: \"feature\",\r\n                          code: block.primaryCode,\r\n                          source: \"crm.workspace.action\",\r\n                        });\r\n                      }\r\n                      return;\r\n                    }\r\n                    navigate(block.path);\r\n                  };\r\n\r\n                  return (\r\n                    <Draggable\r\n                      key={block.id}\r\n                      draggableId={block.id}\r\n                      index={index}\r\n                    >\r\n                      {provided => (\r\n                        <div\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                          role=\"button\"\r\n                          tabIndex={0}\r\n                          aria-label={`${block.label}: ${block.action}`}\r\n                          onKeyDown={e => {\r\n                            if (e.key === \"Enter\") handleCardClick();\r\n                          }}\r\n                          onClick={handleCardClick}\r\n                          className={cardClasses}\r\n                          style={{ userSelect: \"none\" }}\r\n                        >\r\n                          {/* üîí Upgrade badge for locked tiles */}\r\n                          {!block.allowed && (\r\n                            <span className=\"pointer-events-none absolute top-3 right-3 inline-flex items-center gap-1 rounded-full border border-dashed border-amber-500 bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700\">\r\n                              üîí Upgrade\r\n                            </span>\r\n                          )}\r\n\r\n                          {/* Emerald animated border (top ‚Üí right ‚Üí bottom ‚Üí left) */}\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"topline pointer-events-none absolute left-0 -top-[2px] h-[2px] w-full origin-left rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(90deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleX(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"rightline pointer-events-none absolute right-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-top rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(180deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleY(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"bottomline pointer-events-none absolute left-0 -bottom-[2px] h-[2px] w-full origin-right rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(270deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleX(0)\",\r\n                            }}\r\n                          />\r\n                          <span\r\n                            aria-hidden\r\n                            className=\"leftline pointer-events-none absolute left-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-bottom rounded opacity-0 group-hover:opacity-100\"\r\n                            style={{\r\n                              background:\r\n                                \"linear-gradient(0deg, #A7F3D0, #34D399, #059669)\",\r\n                              transform: \"scaleY(0)\",\r\n                            }}\r\n                          />\r\n\r\n                          {/* Card body */}\r\n                          <div className=\"flex items-start gap-4 p-5\">\r\n                            <div className=\"bg-emerald-50 rounded-md p-2 text-emerald-800\">\r\n                              {block.icon}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <h3 className=\"text-md font-semibold text-emerald-800 truncate group-hover:text-emerald-900\">\r\n                                {block.label}\r\n                              </h3>\r\n                              <p className=\"text-sm text-slate-600 workspace-tile-desc\">\n                                {block.description}\n                              </p>\n                            </div>\r\n\r\n                            {/* Drag handle only on kebab */}\r\n                            <div\r\n                              {...provided.dragHandleProps}\r\n                              title=\"Drag to re-order\"\r\n                              className=\"ml-2 rounded p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing\"\r\n                              onClick={e => e.stopPropagation()}\r\n                            >\r\n                              <MoreVertical size={16} />\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Footer */}\r\n                          <div className=\"px-5 py-3 border-t border-gray-200 flex items-center justify-between bg-gray-50\">\r\n                            <button\r\n                              onClick={handlePrimaryActionClick}\r\n                              className=\"text-sm text-gray-700 font-medium flex items-center gap-1 hover:text-gray-900\"\r\n                            >\r\n                              {block.allowed\r\n                                ? block.action\r\n                                : \"Upgrade to unlock\"}\r\n                              <ArrowRightCircle size={18} />\r\n                            </button>\r\n\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <button\r\n                                onClick={e => togglePin(e, block.id)}\r\n                                title={\r\n                                  pinned.includes(block.id) ? \"Unpin\" : \"Pin\"\r\n                                }\r\n                              >\r\n                                <Pin\r\n                                  size={18}\r\n                                  className={\r\n                                    pinned.includes(block.id)\r\n                                      ? \"text-red-600\"\r\n                                      : \"text-gray-400 hover:text-red-500\"\r\n                                  }\r\n                                />\r\n                              </button>\r\n                              <button\r\n                                onClick={e => toggleArchive(e, block.id)}\r\n                                title=\"Archive this\"\r\n                              >\r\n                                <Archive\r\n                                  size={18}\r\n                                  className={\r\n                                    archived.includes(block.id)\r\n                                      ? \"text-indigo-600\"\r\n                                      : \"text-gray-400 hover:text-indigo-500\"\r\n                                  }\r\n                                />\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  );\r\n                })}\r\n                {provided.placeholder}\r\n              </div>\r\n            )}\r\n          </Droppable>\r\n        </DragDropContext>\r\n      )}\r\n\r\n      {!anyVisible && (\r\n        <div className=\"bg-red-100 text-red-700 p-4 border-l-4 border-red-500 rounded-md mt-4 shadow-sm flex items-start gap-3\">\r\n          <AlertTriangle size={22} className=\"mt-1\" />\r\n          <div>\r\n            <strong>No CRM tiles:</strong> All CRM tools are archived or hidden.\r\n            <div className=\"text-sm mt-1 text-gray-600\">\r\n              Un-archive some tiles to see them here.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// // üìÑ File: src/pages/Workspaces/CrmWorkspacePage.jsx\r\n\r\n// import {\r\n//   Archive,\r\n//   Pin,\r\n//   ArrowRightCircle,\r\n//   UserCircle2,\r\n//   Tags,\r\n//   BellRing,\r\n//   Clock4,\r\n//   MoreVertical,\r\n//   AlertTriangle,\r\n// } from \"lucide-react\";\r\n// import { useNavigate } from \"react-router-dom\";\r\n// import { useState, useMemo } from \"react\";\r\n// import { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\r\n\r\n// // ‚úÖ server-authoritative AuthProvider\r\n// import { useAuth } from \"../../app/providers/AuthProvider\";\r\n// // üîî Global upgrade flow\r\n// import { requestUpgrade } from \"../../utils/upgradeBus\";\r\n// import { FK } from \"../../capabilities/featureKeys\";\r\n\r\n// /**\r\n//  * üîê Map CRM blocks to EXACT Permission.Code values from your back end.\r\n//  */\r\n// const PERM_BY_BLOCK = {\r\n//   contacts: [FK.CRM_CONTACT_VIEW],\r\n//   tags: [FK.CRM_TAGS_VIEW],\r\n//   reminders: [FK.CRM_REMINDERS_VIEW],\r\n//   timeline: [FK.CRM_TIMELINE_VIEW],\r\n// };\r\n\r\n// const crmBlocks = [\r\n//   {\r\n//     id: \"contacts\",\r\n//     label: \"Contacts\",\r\n//     description: \"Central place to manage leads, customers, and their details.\",\r\n//     path: \"/app/crm/contacts\",\r\n//     icon: <UserCircle2 size={22} />,\r\n//     action: \"Open Contacts\",\r\n//   },\r\n//   {\r\n//     id: \"tags\",\r\n//     label: \"Tags\",\r\n//     description: \"Organize and filter contacts using color-coded tags.\",\r\n//     path: \"/app/crm/tags\",\r\n//     icon: <Tags size={22} />,\r\n//     action: \"Manage Tags\",\r\n//   },\r\n//   {\r\n//     id: \"reminders\",\r\n//     label: \"Reminders\",\r\n//     description: \"Schedule follow-ups and set alerts to never miss a lead.\",\r\n//     path: \"/app/crm/reminders\",\r\n//     icon: <BellRing size={22} />,\r\n//     action: \"View Reminders\",\r\n//   },\r\n//   {\r\n//     id: \"timeline\",\r\n//     label: \"Timeline\",\r\n//     description: \"Track every interaction and touchpoint with each contact.\",\r\n//     path: \"/app/crm/timeline\",\r\n//     icon: <Clock4 size={22} />,\r\n//     action: \"View Timeline\",\r\n//   },\r\n// ];\r\n\r\n// export default function CrmWorkspacePage() {\r\n//   const navigate = useNavigate();\r\n//   const { isLoading, entLoading, hasAllAccess, can } = useAuth();\r\n\r\n//   // --- LocalStorage keys under \"crm-*\"\r\n//   const [pinned, setPinned] = useState(\r\n//     JSON.parse(localStorage.getItem(\"crm-pinned\") || \"[]\")\r\n//   );\r\n//   const [archived, setArchived] = useState(\r\n//     JSON.parse(localStorage.getItem(\"crm-archived\") || \"[]\")\r\n//   );\r\n\r\n//   // Seed order with all current ids; reconcile with any saved order\r\n//   const allIds = useMemo(() => crmBlocks.map(b => b.id), []);\r\n//   const storedOrder =\r\n//     JSON.parse(localStorage.getItem(\"crm-order\") || \"null\") || [];\r\n//   const initialOrder = useMemo(() => {\r\n//     if (!Array.isArray(storedOrder) || storedOrder.length === 0) return allIds;\r\n//     const known = storedOrder.filter(id => allIds.includes(id));\r\n//     const missing = allIds.filter(id => !known.includes(id));\r\n//     return [...known, ...missing];\r\n//   }, [allIds]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n//   const [order, setOrder] = useState(initialOrder);\r\n//   const [showArchived, setShowArchived] = useState(false);\r\n\r\n//   const togglePin = (e, id) => {\r\n//     e.stopPropagation();\r\n//     const updated = pinned.includes(id)\r\n//       ? pinned.filter(i => i !== id)\r\n//       : [...pinned, id];\r\n//     setPinned(updated);\r\n//     localStorage.setItem(\"crm-pinned\", JSON.stringify(updated));\r\n//   };\r\n\r\n//   const toggleArchive = (e, id) => {\r\n//     e.stopPropagation();\r\n//     const updated = archived.includes(id)\r\n//       ? archived.filter(i => i !== id)\r\n//       : [...archived, id];\r\n//     setArchived(updated);\r\n//     localStorage.setItem(\"crm-archived\", JSON.stringify(updated));\r\n//   };\r\n\r\n//   const onDragEnd = result => {\r\n//     if (!result.destination) return;\r\n//     const newOrder = Array.from(order);\r\n//     const [moved] = newOrder.splice(result.source.index, 1);\r\n//     newOrder.splice(result.destination.index, 0, moved);\r\n//     setOrder(newOrder);\r\n//     localStorage.setItem(\"crm-order\", JSON.stringify(newOrder));\r\n//   };\r\n\r\n//   // Build list of blocks (show both locked + unlocked)\r\n//   const blocksWithAccess = order\r\n//     .map(id => crmBlocks.find(b => b.id === id))\r\n//     .filter(Boolean)\r\n//     .filter(b => (showArchived ? true : !archived.includes(b.id)))\r\n//     .map(block => {\r\n//       const codes = PERM_BY_BLOCK[block.id] || [];\r\n//       const allowed =\r\n//         hasAllAccess || (Array.isArray(codes) && codes.some(code => can(code)));\r\n\r\n//       return {\r\n//         ...block,\r\n//         allowed,\r\n//         primaryCode: codes[0] || null,\r\n//       };\r\n//     });\r\n\r\n//   const anyVisible = blocksWithAccess.length > 0;\r\n//   const anyAllowed = blocksWithAccess.some(b => b.allowed);\r\n\r\n//   if (isLoading || entLoading) {\r\n//     return (\r\n//       <div className=\"p-10 text-center text-lg text-gray-500\">\r\n//         Loading CRM features‚Ä¶\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   return (\r\n//     <div className=\"p-6\" data-test-id=\"crm-root\">\r\n//       {/* Emerald animated border, same pattern as Automation workspace */}\r\n//       <style>{`\r\n//         @keyframes drawRight { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n//         @keyframes drawDown  { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n//         @keyframes drawLeft  { from { transform: scaleX(0) } to { transform: scaleX(1) } }\r\n//         @keyframes drawUp    { from { transform: scaleY(0) } to { transform: scaleY(1) } }\r\n\r\n//         .tile:hover .topline    { animation: drawRight .9s ease forwards; }\r\n//         .tile:hover .rightline  { animation: drawDown  .9s ease .18s forwards; }\r\n//         .tile:hover .bottomline { animation: drawLeft  .9s ease .36s forwards; }\r\n//         .tile:hover .leftline   { animation: drawUp    .9s ease .54s forwards; }\r\n//       `}</style>\r\n\r\n//       <div className=\"flex justify-between items-center mb-4\">\r\n//         <h2 className=\"text-2xl font-bold text-emerald-800\">\r\n//           üìá CRM Workspace\r\n//         </h2>\r\n//         <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n//           <input\r\n//             type=\"checkbox\"\r\n//             checked={showArchived}\r\n//             onChange={() => setShowArchived(!showArchived)}\r\n//             className=\"accent-purple-600\"\r\n//           />\r\n//           Show Archived\r\n//         </label>\r\n//       </div>\r\n\r\n//       <p className=\"text-sm text-slate-600 mb-4\">\r\n//         Manage contacts, tags, reminders, and interaction timelines in one\r\n//         place.\r\n//       </p>\r\n\r\n//       {/* If tiles exist but all are locked ‚Üí show restricted banner */}\r\n//       {anyVisible && !anyAllowed && (\r\n//         <div className=\"bg-amber-50 text-amber-800 p-4 border-l-4 border-amber-500 rounded-md mb-6 shadow-sm flex items-start gap-3\">\r\n//           <AlertTriangle size={22} className=\"mt-1\" />\r\n//           <div>\r\n//             <strong>Locked CRM tools:</strong> Your current plan doesn&apos;t\r\n//             include these CRM features.\r\n//             <div className=\"text-sm mt-1 text-gray-600\">\r\n//               Try opening a tile to see upgrade options, or contact your\r\n//               administrator.\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n\r\n//       {anyVisible && (\r\n//         <DragDropContext onDragEnd={onDragEnd}>\r\n//           <Droppable droppableId=\"crm-blocks\" direction=\"horizontal\">\r\n//             {provided => (\r\n//               <div\r\n//                 className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6\"\r\n//                 ref={provided.innerRef}\r\n//                 {...provided.droppableProps}\r\n//               >\r\n//                 {blocksWithAccess.map((block, index) => {\r\n//                   const baseCardClasses =\r\n//                     \"tile group relative overflow-hidden rounded-md border bg-white shadow-sm transition duration-200 hover:-translate-y-0.5 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-purple-300 cursor-pointer\";\r\n//                   const lockedClasses =\r\n//                     \"opacity-70 border-dashed cursor-not-allowed hover:-translate-y-0 hover:shadow-sm\";\r\n\r\n//                   const cardClasses = block.allowed\r\n//                     ? baseCardClasses\r\n//                     : `${baseCardClasses} ${lockedClasses}`;\r\n\r\n//                   const handleCardClick = () => {\r\n//                     if (!block.allowed) {\r\n//                       if (block.primaryCode) {\r\n//                         requestUpgrade({\r\n//                           reason: \"feature\",\r\n//                           code: block.primaryCode,\r\n//                           source: \"crm.workspace.tile\",\r\n//                         });\r\n//                       }\r\n//                       return;\r\n//                     }\r\n//                     navigate(block.path);\r\n//                   };\r\n\r\n//                   const handlePrimaryActionClick = e => {\r\n//                     e.stopPropagation();\r\n//                     if (!block.allowed) {\r\n//                       if (block.primaryCode) {\r\n//                         requestUpgrade({\r\n//                           reason: \"feature\",\r\n//                           code: block.primaryCode,\r\n//                           source: \"crm.workspace.action\",\r\n//                         });\r\n//                       }\r\n//                       return;\r\n//                     }\r\n//                     navigate(block.path);\r\n//                   };\r\n\r\n//                   return (\r\n//                     <Draggable\r\n//                       key={block.id}\r\n//                       draggableId={block.id}\r\n//                       index={index}\r\n//                     >\r\n//                       {provided => (\r\n//                         <div\r\n//                           ref={provided.innerRef}\r\n//                           {...provided.draggableProps}\r\n//                           role=\"button\"\r\n//                           tabIndex={0}\r\n//                           aria-label={`${block.label}: ${block.action}`}\r\n//                           onKeyDown={e => {\r\n//                             if (e.key === \"Enter\") handleCardClick();\r\n//                           }}\r\n//                           onClick={handleCardClick}\r\n//                           className={cardClasses}\r\n//                           style={{ userSelect: \"none\" }}\r\n//                         >\r\n//                           {/* üîí Upgrade badge for locked tiles */}\r\n//                           {!block.allowed && (\r\n//                             <span className=\"pointer-events-none absolute top-3 right-3 inline-flex items-center gap-1 rounded-full border border-dashed border-amber-500 bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700\">\r\n//                               üîí Upgrade\r\n//                             </span>\r\n//                           )}\r\n\r\n//                           {/* Emerald animated border (top ‚Üí right ‚Üí bottom ‚Üí left) */}\r\n//                           <span\r\n//                             aria-hidden\r\n//                             className=\"topline pointer-events-none absolute left-0 -top-[2px] h-[2px] w-full origin-left rounded opacity-0 group-hover:opacity-100\"\r\n//                             style={{\r\n//                               background:\r\n//                                 \"linear-gradient(90deg, #A7F3D0, #34D399, #059669)\",\r\n//                               transform: \"scaleX(0)\",\r\n//                             }}\r\n//                           />\r\n//                           <span\r\n//                             aria-hidden\r\n//                             className=\"rightline pointer-events-none absolute right-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-top rounded opacity-0 group-hover:opacity-100\"\r\n//                             style={{\r\n//                               background:\r\n//                                 \"linear-gradient(180deg, #A7F3D0, #34D399, #059669)\",\r\n//                               transform: \"scaleY(0)\",\r\n//                             }}\r\n//                           />\r\n//                           <span\r\n//                             aria-hidden\r\n//                             className=\"bottomline pointer-events-none absolute left-0 -bottom-[2px] h-[2px] w-full origin-right rounded opacity-0 group-hover:opacity-100\"\r\n//                             style={{\r\n//                               background:\r\n//                                 \"linear-gradient(270deg, #A7F3D0, #34D399, #059669)\",\r\n//                               transform: \"scaleX(0)\",\r\n//                             }}\r\n//                           />\r\n//                           <span\r\n//                             aria-hidden\r\n//                             className=\"leftline pointer-events-none absolute left-0 -top-[2px] h-[calc(100%+4px)] w-[2px] origin-bottom rounded opacity-0 group-hover:opacity-100\"\r\n//                             style={{\r\n//                               background:\r\n//                                 \"linear-gradient(0deg, #A7F3D0, #34D399, #059669)\",\r\n//                               transform: \"scaleY(0)\",\r\n//                             }}\r\n//                           />\r\n\r\n//                           {/* Card body */}\r\n//                           <div className=\"flex items-start gap-4 p-5\">\r\n//                             <div className=\"bg-emerald-50 rounded-md p-2 text-emerald-800\">\r\n//                               {block.icon}\r\n//                             </div>\r\n//                             <div className=\"flex-1 min-w-0\">\r\n//                               <h3 className=\"text-md font-semibold text-emerald-800 truncate group-hover:text-emerald-900\">\r\n//                                 {block.label}\r\n//                               </h3>\r\n//                               <p className=\"text-sm text-slate-600\">\r\n//                                 {block.description}\r\n//                               </p>\r\n//                             </div>\r\n\r\n//                             {/* Drag handle only on kebab */}\r\n//                             <div\r\n//                               {...provided.dragHandleProps}\r\n//                               title=\"Drag to re-order\"\r\n//                               className=\"ml-2 rounded p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing\"\r\n//                               onClick={e => e.stopPropagation()}\r\n//                             >\r\n//                               <MoreVertical size={16} />\r\n//                             </div>\r\n//                           </div>\r\n\r\n//                           {/* Footer */}\r\n//                           <div className=\"px-5 py-3 border-t border-gray-200 flex items-center justify-between bg-gray-50\">\r\n//                             <button\r\n//                               onClick={handlePrimaryActionClick}\r\n//                               className=\"text-sm text-gray-700 font-medium flex items-center gap-1 hover:text-gray-900\"\r\n//                             >\r\n//                               {block.allowed\r\n//                                 ? block.action\r\n//                                 : \"Upgrade to unlock\"}\r\n//                               <ArrowRightCircle size={18} />\r\n//                             </button>\r\n\r\n//                             <div className=\"flex items-center gap-3\">\r\n//                               <button\r\n//                                 onClick={e => togglePin(e, block.id)}\r\n//                                 title={\r\n//                                   pinned.includes(block.id) ? \"Unpin\" : \"Pin\"\r\n//                                 }\r\n//                               >\r\n//                                 <Pin\r\n//                                   size={18}\r\n//                                   className={\r\n//                                     pinned.includes(block.id)\r\n//                                       ? \"text-red-600\"\r\n//                                       : \"text-gray-400 hover:text-red-500\"\r\n//                                   }\r\n//                                 />\r\n//                               </button>\r\n//                               <button\r\n//                                 onClick={e => toggleArchive(e, block.id)}\r\n//                                 title=\"Archive this\"\r\n//                               >\r\n//                                 <Archive\r\n//                                   size={18}\r\n//                                   className={\r\n//                                     archived.includes(block.id)\r\n//                                       ? \"text-indigo-600\"\r\n//                                       : \"text-gray-400 hover:text-indigo-500\"\r\n//                                   }\r\n//                                 />\r\n//                               </button>\r\n//                             </div>\r\n//                           </div>\r\n//                         </div>\r\n//                       )}\r\n//                     </Draggable>\r\n//                   );\r\n//                 })}\r\n//                 {provided.placeholder}\r\n//               </div>\r\n//             )}\r\n//           </Droppable>\r\n//         </DragDropContext>\r\n//       )}\r\n\r\n//       {!anyVisible && (\r\n//         <div className=\"bg-red-100 text-red-700 p-4 border-l-4 border-red-500 rounded-md mt-4 shadow-sm flex items-start gap-3\">\r\n//           <AlertTriangle size={22} className=\"mt-1\" />\r\n//           <div>\r\n//             <strong>No CRM tiles:</strong> All CRM tools are archived or hidden.\r\n//             <div className=\"text-sm mt-1 text-gray-600\">\r\n//               Un-archive some tiles to see them here.\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n//     </div>\r\n//   );\r\n// }\r\n"],"names":["CircleUserRound","createLucideIcon","d","key","cx","cy","r","PERM_BY_BLOCK","contacts","FK","CRM_CONTACT_VIEW","tags","CRM_TAGS_VIEW","reminders","CRM_REMINDERS_VIEW","timeline","CRM_TIMELINE_VIEW","notes","CRM_NOTES_VIEW","attributes","CRM_ATTRIBUTE_VIEW","crmBlocks","id","label","description","path","icon","_jsx","UserCircle2","size","action","Tags","SlidersHorizontal","BellRing","Clock4","StickyNote","CrmWorkspacePage","navigate","useNavigate","location","useLocation","isLoading","entLoading","hasAllAccess","can","useAuth","hideWorkspaceTiles","URLSearchParams","search","get","pinned","setPinned","useState","JSON","parse","localStorage","getItem","archived","setArchived","allIds","useMemo","map","b","storedOrder","initialOrder","Array","isArray","length","known","filter","includes","missing","order","setOrder","showArchived","setShowArchived","blocksWithAccess","find","Boolean","block","codes","codeList","allowed","some","code","_objectSpread","primaryCode","anyVisible","anyAllowed","className","children","_jsxs","type","checked","onChange","AlertTriangle","DragDropContext","onDragEnd","result","destination","newOrder","from","moved","splice","source","index","setItem","stringify","Droppable","droppableId","direction","provided","ref","innerRef","droppableProps","baseCardClasses","cardClasses","concat","handleCardClick","requestUpgrade","reason","handlePrimaryActionClick","e","stopPropagation","Draggable","draggableId","draggableProps","role","tabIndex","onKeyDown","onClick","style","userSelect","background","transform","dragHandleProps","title","MoreVertical","ArrowRightCircle","togglePin","updated","i","Pin","toggleArchive","Archive","placeholder"],"sourceRoot":""}