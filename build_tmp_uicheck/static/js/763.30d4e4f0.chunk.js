/*! For license information please see 763.30d4e4f0.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkxbytechat_ui=self.webpackChunkxbytechat_ui||[]).push([[763],{20917:(e,t,s)=>{var a,l,n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},r=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}();t.ZX=function(e){document.body.classList.add("react-confirm-alert-body-element"),function(){if(document.getElementById("react-confirm-alert-firm-svg"))return;var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"feGaussianBlur");t.setAttribute("stdDeviation","0.3");var s=document.createElementNS(e,"filter");s.setAttribute("id","gaussian-blur"),s.appendChild(t);var a=document.createElementNS(e,"svg");a.setAttribute("id","react-confirm-alert-firm-svg"),a.setAttribute("class","react-confirm-alert-svg"),a.appendChild(s),document.body.appendChild(a)}(),function(e){var t=document.getElementById(e.targetId||h);e.targetId&&!t&&console.error("React Confirm Alert:","Can not get element id (#"+e.targetId+")");t||(document.body.children[0].classList.add("react-confirm-alert-blur"),(t=document.createElement("div")).id=h,document.body.appendChild(t)),(p=(0,d.createRoot)(t)).render(o.default.createElement(x,e))}(e)};var i=s(65043),o=u(i),c=u(s(65173)),d=s(84391);function u(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var x=(l=a=function(e){function t(){var e,s,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,n=Array(l),r=0;r<l;r++)n[r]=arguments[r];return s=a=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),a.handleClickButton=function(e){e.onClick&&e.onClick(),a.close()},a.handleClickOverlay=function(e){var t=a.props,s=t.closeOnClickOutside,l=t.onClickOutside,n=e.target===a.overlay;s&&n&&(l(),a.close()),e.stopPropagation()},a.close=function(){var e=a.props.afterClose;document.body.classList.remove("react-confirm-alert-body-element"),function(e){var t=document.getElementById(e.targetId||h);t&&p.unmount(t)}(a.props),function(e){var t=document.getElementById("react-confirm-alert-firm-svg");t&&t.parentNode.removeChild(t);document.body.children[0].classList.remove("react-confirm-alert-blur"),e()}(e)},a.keyboard=function(e){var t=a.props,s=t.closeOnEscape,l=t.onKeypressEscape,n=t.onkeyPress,r=t.keyCodeForClose,i=e.keyCode,o=27===i;r.includes(i)&&a.close(),s&&o&&(l(e),a.close()),n&&n()},a.componentDidMount=function(){document.addEventListener("keydown",a.keyboard,!1)},a.componentWillUnmount=function(){document.removeEventListener("keydown",a.keyboard,!1),a.props.willUnmount()},a.renderCustomUI=function(){var e=a.props,t=e.title,s=e.message,l=e.buttons;return(0,e.customUI)({title:t,message:s,buttons:l,onClose:a.close})},m(a,s)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"render",value:function(){var e=this,t=this.props,s=t.title,a=t.message,l=t.buttons,r=t.childrenElement,i=t.customUI,c=t.overlayClassName;return o.default.createElement("div",{className:"react-confirm-alert-overlay "+c,ref:function(t){return e.overlay=t},onClick:this.handleClickOverlay},o.default.createElement("div",{className:"react-confirm-alert"},i?this.renderCustomUI():o.default.createElement("div",{className:"react-confirm-alert-body"},s&&o.default.createElement("h1",null,s),a,r(),o.default.createElement("div",{className:"react-confirm-alert-button-group"},l.map((function(t,s){return o.default.createElement("button",n({key:s,className:t.className},t,{onClick:function(s){return e.handleClickButton(t)}}),t.label)}))))))}}]),t}(i.Component),a.propTypes={title:c.default.string,message:c.default.string,buttons:c.default.array.isRequired,childrenElement:c.default.func,customUI:c.default.func,closeOnClickOutside:c.default.bool,closeOnEscape:c.default.bool,keyCodeForClose:c.default.arrayOf(c.default.number),willUnmount:c.default.func,afterClose:c.default.func,onClickOutside:c.default.func,onKeypressEscape:c.default.func,onkeyPress:c.default.func,overlayClassName:c.default.string},a.defaultProps={buttons:[{label:"Cancel",onClick:function(){return null},className:null},{label:"Confirm",onClick:function(){return null},className:null}],childrenElement:function(){return null},closeOnClickOutside:!0,closeOnEscape:!0,keyCodeForClose:[],willUnmount:function(){return null},afterClose:function(){return null},onClickOutside:function(){return null},onKeypressEscape:function(){return null}},l);var p=null,h="react-confirm-alert"},94727:()=>{},97763:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var a=s(65043),l=s(73216),n=s(35475),r=s(35870),i=s(57488),o=s(72450),c=s(20917),d=(s(94727),s(84820)),u=s(70579);const m=e=>{let{isOpen:t,onClose:s,messageLog:a}=e;return a?(0,u.jsxs)(d.lG,{open:t,onClose:s,className:"relative z-50",children:[(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30","aria-hidden":"true"}),(0,u.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,u.jsxs)(d.lG.Panel,{className:"w-full max-w-lg rounded-lg bg-white p-6 shadow-xl border border-gray-200",children:[(0,u.jsx)(d.lG.Title,{className:"text-lg font-semibold text-purple-700 mb-3",children:"\ud83d\udce8 Sent Message Preview"}),(0,u.jsx)("div",{className:"text-sm bg-gray-50 p-4 border rounded-md whitespace-pre-wrap text-gray-800 mb-4",children:a.finalMessage||"No message available"}),(0,u.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Channel:"})," ",a.sourceChannel||"-"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Sent At:"})," ",a.sentAt?new Date(a.sentAt).toLocaleString():"-"]}),a.clickType&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Click Type:"})," ",a.clickType]})]}),(0,u.jsx)("div",{className:"mt-5 text-right",children:(0,u.jsx)("button",{onClick:s,className:"px-4 py-2 text-sm bg-purple-600 text-white rounded hover:bg-purple-700",children:"Close"})})]})})]}):null};var x=s(50108),p=s(60163),h=s(4240),g=s(17869),f=s(86150),v=s(35746),y=s(76833),b=s(35087),j=s(76245),N=s(16388);const w=e=>{let{icon:t,title:s,value:a,subText:l=null,gradient:n,decoration:r=null}=e;const i={wave:(0,u.jsx)("svg",{className:"absolute bottom-0 left-0 w-full h-16 text-white opacity-10",fill:"currentColor",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:(0,u.jsx)("path",{d:"M0,50 C25,100 75,0 100,50 L100,100 L0,100 Z"})}),graph:(0,u.jsx)("svg",{className:"absolute bottom-0 right-0 h-20 text-white opacity-10",fill:"none",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:(0,u.jsx)("path",{d:"M0 80 C20 40, 40 90, 60 50, 80 10, 100 60",stroke:"currentColor",strokeWidth:"4"})}),bars:(0,u.jsxs)("svg",{className:"absolute bottom-0 right-4 h-16 text-white opacity-10",fill:"currentColor",viewBox:"0 0 50 100",preserveAspectRatio:"none",children:[(0,u.jsx)("rect",{x:"0",y:"60",width:"8",height:"40"}),(0,u.jsx)("rect",{x:"12",y:"40",width:"8",height:"60"}),(0,u.jsx)("rect",{x:"24",y:"20",width:"8",height:"80"}),(0,u.jsx)("rect",{x:"36",y:"50",width:"8",height:"50"})]})};return(0,u.jsxs)("div",{className:"relative overflow-hidden rounded-xl shadow-lg p-5 text-white bg-gradient-to-r ".concat(n),children:[r&&i[r],(0,u.jsxs)("div",{className:"relative flex items-center gap-5",children:[(0,u.jsx)("div",{className:"opacity-80",children:t}),(0,u.jsxs)("div",{className:"flex-grow",children:[(0,u.jsx)("p",{className:"text-sm font-medium text-white/80",children:s}),(0,u.jsx)("p",{className:"text-3xl font-bold tracking-tight",children:a}),l&&(0,u.jsx)("p",{className:"text-xs text-white/70",children:l})]})]})]})},C=function(e){let{summary:t}=e;if(!t)return(0,u.jsx)("div",{className:"bg-white border rounded-lg shadow-sm p-4 mb-4",children:(0,u.jsx)("p",{className:"text-gray-500",children:"Loading summary..."})});const s=t.sent>0?(t.delivered/t.sent*100).toFixed(1):0,a=t.delivered>0?(t.read/t.delivered*100).toFixed(1):0,l=[{name:"Read",value:t.read||0},{name:"Delivered (Unread)",value:(t.delivered||0)-(t.read||0)},{name:"Sent (Pending Delivery)",value:(t.sent||0)-(t.delivered||0)-(t.failedCount||0)},{name:"Failed",value:t.failedCount||0}],n=["#10B981","#3B82F6","#F59E0B","#EF4444"];return(0,u.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,u.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5",children:[(0,u.jsx)(w,{title:"Total Recipients",value:t.totalSent||0,icon:(0,u.jsx)(v.A,{size:40}),gradient:"from-slate-500 to-slate-600"}),(0,u.jsx)(w,{title:"Sent",value:t.sent||0,subText:"Successfully sent to provider",icon:(0,u.jsx)(v.A,{size:40}),gradient:"from-pink-500 to-purple-600",decoration:"wave"}),(0,u.jsx)(w,{title:"Delivered",value:t.delivered||0,subText:"".concat(s,"% Delivery Rate"),icon:(0,u.jsx)(y.A,{size:40}),gradient:"from-purple-500 to-indigo-600",decoration:"graph"}),(0,u.jsx)(w,{title:"Read",value:t.read||0,subText:"".concat(a,"% Read Rate"),icon:(0,u.jsx)(b.A,{size:40}),gradient:"from-blue-400 to-cyan-500",decoration:"bars"}),(0,u.jsx)(w,{title:"Failed",value:t.failedCount||0,subText:"Could not be sent",icon:(0,u.jsx)(j.A,{size:40}),gradient:"from-orange-400 to-red-500"}),(0,u.jsx)(w,{title:"Clicked",value:t.clickedCount||0,icon:(0,u.jsx)(N.A,{size:40}),gradient:"from-green-400 to-teal-500"})]}),(0,u.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex flex-col justify-center items-center",children:[(0,u.jsx)("h3",{className:"font-semibold text-gray-700 mb-2",children:"Message Status Funnel"}),(0,u.jsx)("div",{className:"w-full h-48 relative",children:(0,u.jsx)(x.u,{width:"100%",height:"100%",children:(0,u.jsxs)(p.r,{children:[(0,u.jsx)(h.F,{data:l.filter((e=>e.value>0)),dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,fill:"#8884d8",paddingAngle:5,children:l.filter((e=>e.value>0)).map(((e,t)=>(0,u.jsx)(g.f,{fill:n[l.indexOf(e)]},"cell-".concat(t))))}),(0,u.jsx)(f.m,{formatter:(e,t)=>[e,t]})]})})})]})]})};var k=s(67015);const S=(0,s(77784).A)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var A=s(2580),R=s(40614),E=s(44260),T=s(58487),F=s(72313);const O=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),s=Math.abs(t),a=Math.floor(s/6e4);if(a<1)return"just now";if(a<60)return"".concat(a,"m ").concat(t<0?"from now":"ago");const l=Math.floor(a/60);if(l<24)return"".concat(l,"h ").concat(t<0?"from now":"ago");const n=Math.floor(l/24);return"".concat(n,"d ").concat(t<0?"from now":"ago")},L=e=>{try{const t=new URL(e),s=t.pathname.length>1?t.pathname.split("/").slice(-1)[0]:"";return"".concat(t.hostname).concat(s?"/".concat(s):"")}catch(t){return(null===e||void 0===e?void 0:e.slice(0,60))||""}},P={MessageSent:(0,u.jsx)(v.A,{size:16,className:"text-white"}),Delivered:(0,u.jsx)(y.A,{size:16,className:"text-white"}),Read:(0,u.jsx)(b.A,{size:16,className:"text-white"}),ButtonClicked:(0,u.jsx)(N.A,{size:16,className:"text-white"}),FlowSend:(0,u.jsx)(v.A,{size:16,className:"text-white"}),Redirect:(0,u.jsx)(S,{size:16,className:"text-white"})},z={MessageSent:"bg-blue-500",Delivered:"bg-emerald-500",Read:"bg-cyan-500",ButtonClicked:"bg-green-500",FlowSend:"bg-indigo-500",Redirect:"bg-amber-500"};const B=e=>{let{event:t,isCurrent:s}=e;const a=P[t.eventType]||(0,u.jsx)(E.A,{size:16,className:"text-white"}),l=z[t.eventType]||"bg-gray-400",n=Boolean(t.url),r=!("ButtonClicked"===t.eventType||"Redirect"===t.eventType);return(0,u.jsxs)("div",{className:"relative pl-6",children:[(0,u.jsx)("div",{className:"absolute -left-3 top-1 w-6 h-6 rounded-full flex items-center justify-center ring-4 ring-white ".concat(l," ").concat(s?"scale-110 shadow-lg":""),children:a}),(0,u.jsxs)("div",{className:"rounded-lg p-1.5 ".concat(s?"bg-amber-50 border border-amber-200":"bg-white"),children:[(0,u.jsx)("p",{className:"font-semibold text-gray-800",children:t.title}),r&&t.details&&(0,u.jsx)("p",{className:"text-sm text-gray-600 break-words",children:t.details}),n&&(0,u.jsxs)("p",{className:"mt-1",children:[(0,u.jsxs)("a",{className:"inline-flex items-center gap-1 text-blue-700 underline underline-offset-2",href:t.url,target:"_blank",rel:"noreferrer",title:t.url,children:[(0,u.jsx)(T.A,{size:14}),L(t.url)]}),(0,u.jsxs)("button",{onClick:()=>{var e;t.url&&(null===(e=navigator.clipboard)||void 0===e||e.writeText(t.url))},className:"ml-2 inline-flex items-center gap-1 text-gray-500 hover:text-gray-700",title:"Copy URL",children:[(0,u.jsx)(F.A,{size:14}),(0,u.jsx)("span",{className:"text-xs",children:"Copy"})]})]}),(0,u.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:[(i=t.timestamp,i?new Date(i).toLocaleString():"N/A")," \u2022 ",O(t.timestamp)]})]})]});var i},D=function(e){let{isOpen:t,onClose:s,log:l}=e;const[n,o]=(0,a.useState)({events:[]}),[c,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)("all"),[h,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(""),y=(e=>{if(!e)return"";let t=String(e).trim();const s=t.startsWith("+");return t=(s?"+":"")+t.replace(/[^\d]/g,""),t.startsWith("+")||(t="+"+t),t})((null===n||void 0===n?void 0:n.contactPhone)||(null===l||void 0===l?void 0:l.recipientNumber)||(null===l||void 0===l?void 0:l.contactPhone)||(null===l||void 0===l?void 0:l.to)||(e=>{if(!e)return null;const t=String(e).match(/(\+?\d[\d\s\-()]{5,}\d)/);return t?t[1]:null})(null===l||void 0===l?void 0:l.contactName)||"")||"Unknown";(0,a.useEffect)((()=>{if(!t||!l)return;const e=l.campaignSendLogId||l.id;e&&(async()=>{m(!0),v("");try{const t=(await r.default.get("/tracking/journeys/".concat(e))).data;o(Array.isArray(t)?{events:t}:t||{events:[]})}catch(n){var t,s,a,l;const e=(null===n||void 0===n||null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||(null===n||void 0===n||null===(a=n.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.title)||(null===n||void 0===n?void 0:n.message)||"";"string"===typeof e&&e.toLowerCase().includes("emptyprojectionmember")?(console.warn("[Journey] Backend EF error:",e),v("Journey data is temporarily unavailable. Please try again after a refresh.")):(v(e||"Failed to fetch contact journey."),i.oR.error("\ud83d\udea8 ".concat(e||"Failed to fetch contact journey"))),o({events:[]})}finally{m(!1)}})()}),[t,l]),(0,a.useEffect)((()=>{t&&g(!1)}),[t]);const b="flow"===n.campaignType?(0,u.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-emerald-100 text-emerald-700 text-xs font-semibold",children:"Flow"}):(0,u.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded bg-blue-100 text-blue-700 text-xs font-semibold",children:"Dynamic URL"}),j=(0,a.useMemo)((()=>{const e=(null===n||void 0===n?void 0:n.events)||[];return"messages"===x?e.filter((e=>{return"MessageSent"===(t=e.eventType)||"Delivered"===t||"Read"===t||"FlowSend"===t;var t})):"clicks"===x?e.filter((e=>{return"ButtonClicked"===(t=e.eventType)||"Redirect"===t;var t})):e}),[n,x]),N=h||j.length<=6?j:j.slice(0,6),w=null===n||void 0===n?void 0:n.leftOffAt;return(0,u.jsx)(k.e,{appear:!0,show:t,as:a.Fragment,children:(0,u.jsxs)(d.lG,{as:"div",className:"relative z-50",onClose:s,children:[(0,u.jsx)(k.e.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,u.jsx)("div",{className:"fixed inset-0 bg-black/40"})}),(0,u.jsx)("div",{className:"fixed inset-0 overflow-y-hidden",children:(0,u.jsx)("div",{className:"flex items-center justify-center min-h-full p-4",children:(0,u.jsx)(k.e.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,u.jsxs)(d.lG.Panel,{className:"w-full max-w-2xl flex flex-col max-h-[85vh] transform overflow-hidden rounded-xl bg-white shadow-xl transition-all",children:[(0,u.jsxs)(d.lG.Title,{className:"sticky top-0 z-10 bg-white/70 backdrop-blur px-6 pt-6 pb-2 text-base font-semibold text-gray-800 flex items-center gap-2 border-b border-gray-200",children:[(0,u.jsx)("span",{className:"text-purple-600",children:"\ud83e\udded"}),"Contact Journey for ",y,b,(0,u.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,u.jsx)(A.A,{size:16,className:"text-gray-400"}),(0,u.jsxs)("div",{className:"inline-flex rounded-lg border overflow-hidden",children:[(0,u.jsx)("button",{className:"px-2 py-1 text-xs ".concat("all"===x?"bg-gray-900 text-white":"bg-white"),onClick:()=>p("all"),children:"All"}),(0,u.jsx)("button",{className:"px-2 py-1 text-xs border-l ".concat("messages"===x?"bg-gray-900 text-white":"bg-white"),onClick:()=>p("messages"),children:"Messages"}),(0,u.jsx)("button",{className:"px-2 py-1 text-xs border-l ".concat("clicks"===x?"bg-gray-900 text-white":"bg-white"),onClick:()=>p("clicks"),children:"Clicks"})]}),(0,u.jsx)("button",{onClick:s,className:"ml-2 inline-flex items-center justify-center rounded-lg p-2 hover:bg-gray-100","aria-label":"Close",children:(0,u.jsx)(R.A,{size:16})})]})]}),(0,u.jsx)("div",{className:"flex-grow overflow-y-auto px-6",children:c?(0,u.jsx)("p",{className:"text-center text-gray-500 py-8",children:"Loading journey..."}):f?(0,u.jsx)("div",{className:"py-8",children:(0,u.jsx)("p",{className:"text-center text-amber-700 bg-amber-50 border border-amber-200 rounded p-3 text-sm",children:f})}):(j.length||0)>0?(0,u.jsxs)(u.Fragment,{children:[w&&(0,u.jsx)("div",{className:"mt-3 mb-2 text-xs text-gray-600",children:(0,u.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-50 text-amber-700 px-2 py-1 font-semibold",children:["Left off at:"," ",(0,u.jsx)("span",{className:"text-amber-900",children:w}),n.flowName?(0,u.jsxs)("span",{className:"text-amber-700",children:["\xa0in"," ",(0,u.jsx)("span",{className:"font-bold",children:n.flowName})]}):null]})}),(0,u.jsxs)("div",{className:"relative ml-3 py-3",children:[(0,u.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-px bg-slate-200"}),(0,u.jsx)("div",{className:"space-y-3",children:N.map(((e,t)=>{var s;return(0,u.jsx)(B,{isCurrent:w&&(null===e||void 0===e||null===(s=e.title)||void 0===s?void 0:s.includes(w)),event:e},t)}))})]}),j.length>6&&(0,u.jsx)("div",{className:"flex justify-center pt-2 pb-4",children:(0,u.jsx)("button",{onClick:()=>g((e=>!e)),className:"text-sm font-semibold text-purple-700 hover:text-purple-800",children:h?"Show less":"Show ".concat(j.length-6," more events")})})]}):(0,u.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No journey events found for this message."})}),(0,u.jsx)("div",{className:"flex-shrink-0 px-6 pt-2 pb-4 flex justify-end gap-3 border-t border-gray-200",children:(0,u.jsx)("button",{onClick:s,className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm font-semibold",children:"Close"})})]})})})})]})})};const M=function(){const{campaignId:e}=(0,l.g)(),[t,s]=(0,a.useState)([]),[d,x]=(0,a.useState)(null),[p,h]=(0,a.useState)(!0),[g,f]=(0,a.useState)(""),[v,y]=(0,a.useState)(""),[b,j]=(0,a.useState)(1),[N]=(0,a.useState)(10),[w,k]=(0,a.useState)(0),[S,A]=(0,a.useState)(0),[R,E]=(0,a.useState)(!1),[T,F]=(0,a.useState)(null),[O,L]=(0,a.useState)(!1),[P,z]=(0,a.useState)(null),B=e=>{const t=e=>"string"===typeof e?e.trim():e,s=t(null===e||void 0===e?void 0:e.contactPhone);if(s&&"-"!==s&&"n/a"!==s.toLowerCase())return s;return t(null===e||void 0===e?void 0:e.recipientNumber)||t(null===e||void 0===e?void 0:e.to)||""},M=(0,a.useCallback)((async()=>{h(!0);try{const t=new URLSearchParams({page:b,pageSize:N,status:v,search:g}),a=await r.default.get("/campaign-logs/campaign/".concat(e,"?").concat(t.toString()));s(a.data.items||[]),A(a.data.totalCount||0),k(a.data.totalPages||0)}catch(t){i.oR.error("\u274c Failed to load send logs")}finally{h(!1)}}),[e,b,N,v,g]),I=(0,a.useCallback)((async()=>{try{const t=await r.default.get("/campaign-logs/campaign/".concat(e,"/summary"));x(t.data.data||t.data)}catch(t){console.error("\u274c Failed to fetch summary")}}),[e]);return(0,a.useEffect)((()=>{const e=setTimeout(M,500);return()=>clearTimeout(e)}),[M]),(0,a.useEffect)((()=>{I()}),[I]),(0,u.jsxs)("div",{className:"p-6 bg-[#f5f6f7] min-h-[calc(100vh-80px)]",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,u.jsx)("h1",{className:"text-2xl font-bold text-purple-700",children:"\ud83d\udce8 Send Logs for Campaign"}),(0,u.jsxs)(n.N_,{to:"/app/campaigns/template-campaigns-list",className:"inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50 transition",children:[(0,u.jsx)("span",{className:"text-lg",children:"\u2190"})," Back to Campaigns"]})]}),(0,u.jsx)(C,{summary:d}),(0,u.jsxs)("div",{className:"grid md:grid-cols-4 gap-4 mb-4",children:[(0,u.jsx)("input",{className:"border px-3 py-2 rounded",placeholder:"\ud83d\udd0d Search by name or phone",onChange:e=>{f(e.target.value),j(1)}}),(0,u.jsxs)("select",{className:"border px-3 py-2 rounded",value:v,onChange:e=>{y(e.target.value),j(1)},children:[(0,u.jsx)("option",{value:"",children:"All Statuses"}),(0,u.jsx)("option",{value:"Sent",children:"Sent"}),(0,u.jsx)("option",{value:"Delivered",children:"Delivered"}),(0,u.jsx)("option",{value:"Read",children:"Read"}),(0,u.jsx)("option",{value:"Queued",children:"Queued"}),(0,u.jsx)("option",{value:"Failed",children:"Failed"})]})]}),(0,u.jsxs)("div",{className:"mb-4 flex justify-between",children:[(0,u.jsxs)("p",{className:"text-sm text-gray-500",children:["Showing ",t.length," of ",S," logs"]}),(0,u.jsxs)("div",{className:"space-x-2",children:[(0,u.jsx)("button",{onClick:()=>{const s=[["Contact Phone","Status","Channel","Sent At","Delivered","Read","Clicked","Click Type"],...t.map((e=>[B(e),e.sendStatus,e.sourceChannel,e.sentAt?new Date(e.sentAt).toLocaleString():"",e.deliveredAt?new Date(e.deliveredAt).toLocaleString():"",e.readAt?new Date(e.readAt).toLocaleString():"",e.isClicked?"Yes":"No",e.clickType||""]))],a=new Blob([s.map((e=>e.join(","))).join("\n")],{type:"text/csv"});(0,o.saveAs)(a,"CampaignLogs-".concat(e,".csv"))},className:"bg-emerald-600 text-white text-sm px-3 py-1 rounded hover:bg-emerald-700",children:"\u2b07 Export CSV"}),(0,u.jsx)("button",{onClick:()=>{(0,c.ZX)({title:"Retry All Failed Messages?",message:"This will retry all failed messages in this campaign. Continue?",buttons:[{label:"Yes",onClick:async()=>{try{const t=await r.default.post("/campaign-logs/campaign/".concat(e,"/retry-all"));i.oR.success("\u2705 Retried ".concat(t.data.retried," messages")),M(),I()}catch(t){i.oR.error("\u274c Retry failed")}}},{label:"Cancel"}]})},className:"bg-purple-600 text-white text-sm px-3 py-1 rounded hover:bg-purple-700",children:"\ud83d\udd01 Retry All Failed"})]})]}),p?(0,u.jsx)("p",{children:"Loading logs..."}):0===t.length?(0,u.jsx)("p",{className:"text-gray-500",children:"No logs found with current filters."}):(0,u.jsx)("div",{className:"overflow-x-auto bg-white shadow rounded",children:(0,u.jsxs)("table",{className:"w-full text-sm",children:[(0,u.jsx)("thead",{className:"bg-gray-100 text-left",children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{className:"p-2",children:"Contact"}),(0,u.jsx)("th",{className:"p-2",children:"Status"}),(0,u.jsx)("th",{className:"p-2",children:"Channel"}),(0,u.jsx)("th",{className:"p-2",children:"Sent"}),(0,u.jsx)("th",{className:"p-2",children:"Clicked"}),(0,u.jsx)("th",{className:"p-2",children:"Click Type"}),(0,u.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,u.jsx)("tbody",{children:t.map((e=>(0,u.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,u.jsx)("td",{className:"p-2",children:B(e)||"-"}),(0,u.jsx)("td",{className:"p-2",children:e.sendStatus||"-"}),(0,u.jsx)("td",{className:"p-2",children:e.sourceChannel||"-"}),(0,u.jsx)("td",{className:"p-2",children:e.sentAt?new Date(e.sentAt).toLocaleString():"-"}),(0,u.jsx)("td",{className:"p-2",children:e.isClicked?"\u2705 Yes":"\u274c No"}),(0,u.jsx)("td",{className:"p-2",children:e.clickType||"-"}),(0,u.jsxs)("td",{className:"p-2 space-x-2",children:[(0,u.jsx)("button",{onClick:()=>(e=>{F(e),E(!0)})(e),className:"text-xs text-blue-600 hover:underline",children:"Preview"}),(0,u.jsx)("button",{onClick:()=>{z(e),L(!0)},className:"text-xs text-indigo-600 hover:underline",children:"\ud83e\udded Journey"}),"Failed"===e.sendStatus&&(0,u.jsx)("button",{onClick:()=>{return t=e.id,void(0,c.ZX)({title:"Retry This Message?",message:"Are you sure you want to retry this failed message?",buttons:[{label:"Yes",onClick:async()=>{try{await r.default.post("/campaign-logs/".concat(t,"/retry")),i.oR.success("\u2705 Retry triggered"),M(),I()}catch(e){i.oR.error("\u274c Retry failed")}}},{label:"Cancel"}]});var t},className:"text-xs text-white bg-red-500 hover:bg-red-600 px-2 py-1 rounded",children:"Retry"})]})]},e.id)))})]})}),w>1&&(0,u.jsxs)("div",{className:"flex justify-end items-center mt-4 space-x-2",children:[(0,u.jsx)("button",{className:"px-2 py-1 text-sm border rounded",disabled:1===b,onClick:()=>j((e=>e-1)),children:"\u2b05 Prev"}),(0,u.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",b," of ",w]}),(0,u.jsx)("button",{className:"px-2 py-1 text-sm border rounded",disabled:b===w,onClick:()=>j((e=>e+1)),children:"Next \u27a1"})]}),(0,u.jsx)(m,{isOpen:R,onClose:()=>{E(!1),F(null)},messageLog:T}),(0,u.jsx)(D,{isOpen:O,onClose:()=>L(!1),log:P})]})}}}]);
//# sourceMappingURL=763.30d4e4f0.chunk.js.map