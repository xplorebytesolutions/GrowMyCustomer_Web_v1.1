/*! For license information please see 953.c505d9ff.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkxbytechat_ui=self.webpackChunkxbytechat_ui||[]).push([[953],{54953:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ge});var s=a(65043),l=a(14459),n=a(39292),r=a(66797),o=a(7104),i=a(50797),d=a(71360),c=a(70579);function u(e){let{onAddClick:t,onSearchChange:a,activeTab:s,onTabChange:l,searchTerm:u,onFilterClick:m,onImportClick:x,onDownloadSample:h,importing:p=!1,activeFiltersCount:v=0}=e;return(0,c.jsxs)("div",{className:"space-y-3 px-4 py-3",children:[(0,c.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[(0,c.jsxs)("div",{className:"relative flex-1 max-w-xl",children:[(0,c.jsx)(n.A,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),(0,c.jsx)("input",{type:"text",placeholder:"Search by name, phone, or email",value:u,onChange:e=>null===a||void 0===a?void 0:a(e.target.value),className:"w-full rounded-lg border border-slate-200 bg-white pl-9 pr-3 py-2 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-200"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,c.jsxs)("button",{onClick:m,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border transition-all ".concat(v>0?"bg-emerald-50 border-emerald-300 text-emerald-900 hover:bg-emerald-100":"border-slate-200 text-slate-700 hover:bg-slate-50"),children:[(0,c.jsx)(r.A,{size:16}),"Filters",v>0&&(0,c.jsx)("span",{className:"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-emerald-600 text-white text-[11px] font-bold",children:v})]}),(0,c.jsxs)("button",{onClick:h,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border border-slate-200 text-slate-700 hover:bg-slate-50",children:[(0,c.jsx)(o.A,{size:16})," Download Sample CSV"]}),(0,c.jsxs)("button",{onClick:x,disabled:p,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border border-slate-200 text-slate-700 hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed",children:[(0,c.jsx)(i.A,{size:16})," ",p?"Importing...":"Import CSV"]}),(0,c.jsxs)("button",{onClick:t,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm bg-emerald-600 hover:bg-emerald-700 text-white shadow-sm",children:[(0,c.jsx)(d.A,{size:16})," Add contact"]})]})]}),(0,c.jsx)("div",{className:"flex flex-wrap gap-2 text-sm font-medium",children:[{key:"all",label:"All"},{key:"favourites",label:"Favourites"},{key:"archived",label:"Archived"},{key:"groups",label:"Groups"}].map((e=>{const t=s===e.key;return(0,c.jsx)("button",{onClick:()=>null===l||void 0===l?void 0:l(e.key),className:"px-3 py-1.5 rounded-full border transition-colors ".concat(t?"bg-emerald-50 border-emerald-200 text-emerald-900":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"),children:e.label},e.key)}))})]})}var m=a(89379),x=a(73216),h=a(57488),p=a(75686),v=a(35870),g=a(80045);const b=["className","checked","onCheckedChange"],f=s.forwardRef(((e,t)=>{let{className:a="",checked:s,onCheckedChange:l}=e,n=(0,g.A)(e,b);return(0,c.jsx)("input",(0,m.A)((0,m.A)({type:"checkbox",ref:t,checked:s,className:"w-4 h-4 text-emerald-600 border-slate-300 rounded focus:ring-emerald-500 ".concat(a)},n),{},{onChange:e=>null===l||void 0===l?void 0:l(e.target.checked)}))}));f.displayName="Checkbox";var y=a(21961),j=a(67015);function N(e){let{children:t}=e;return(0,c.jsx)(y.W1,{as:"div",className:"relative inline-block text-left",children:t})}const w=e=>{let{asChild:t,children:a}=e;return(0,c.jsx)(y.IU,{as:s.Fragment,children:a})},S=e=>{let{children:t,className:a=""}=e;return(0,c.jsx)(j.e,{as:s.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,c.jsx)(y.c,{className:"absolute right-0 z-10 mt-2 w-48 origin-top-right overflow-hidden rounded-lg border border-slate-200 bg-white shadow-lg focus:outline-none ".concat(a),children:t})})},C=e=>{let{children:t,onClick:a,className:s=""}=e;return(0,c.jsx)(y.Dr,{children:e=>{let{active:l}=e;return(0,c.jsx)("button",{onClick:a,className:"".concat(l?"bg-slate-50":""," w-full px-4 py-2 text-left text-sm text-slate-700 ").concat(s),children:t})}})};function A(e){var t,a;const s=null!==(t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.data)&&void 0!==t?t:null===e||void 0===e?void 0:e.data;return Array.isArray(s)?s:[]}function k(e){let{isOpen:t,mode:a,contact:l,onClose:n,onUpdated:r}=e;const[o,i]=s.useState([]),[d,u]=s.useState(""),[m,x]=s.useState(!1),[p,g]=s.useState(!1),b=s.useMemo((()=>function(e){return(null===e||void 0===e?void 0:e.tags)||(null===e||void 0===e?void 0:e.contactTags)||(null===e||void 0===e?void 0:e.tagSummaries)||(null===e||void 0===e?void 0:e.tagList)||[]}(l)),[l]);s.useEffect((()=>{if(!t)return;(async()=>{x(!0);try{var e;if("remove"===a){var t,s,l,n;const e=Array.isArray(b)?b:[];i(e);const a=null!==(t=null!==(s=null===e||void 0===e||null===(l=e[0])||void 0===l?void 0:l.id)&&void 0!==s?s:null===e||void 0===e||null===(n=e[0])||void 0===n?void 0:n.tagId)&&void 0!==t?t:"";return void u(a?String(a):"")}const r=await async function(){try{const e=A(await v.default.get("/tags"));if(e.length>0)return e}catch(e){}return A(await v.default.get("/tags/get-tags"))}(),o=new Set((b||[]).map((e=>{var t;return String(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null===e||void 0===e?void 0:e.tagId)})).filter(Boolean)),d=(r||[]).filter((e=>!o.has(String(null===e||void 0===e?void 0:e.id))));i(d),u(null!==d&&void 0!==d&&null!==(e=d[0])&&void 0!==e&&e.id?String(d[0].id):"")}catch(r){h.oR.error("Failed to load tags."),i([]),u("")}finally{x(!1)}})()}),[t,a,b]);const f="remove"===a?"Remove tag":"Add tag";if(!t)return null;const y="remove"===a?"This contact has no tags to remove.":"No tags available to add. Create tags first.";return(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:(0,c.jsxs)("div",{className:"w-full max-w-sm overflow-hidden rounded-2xl bg-white shadow-xl ring-1 ring-black/5",children:[(0,c.jsxs)("div",{className:"border-b border-slate-100 px-5 py-4",children:[(0,c.jsx)("h2",{className:"text-sm font-semibold text-slate-900",children:f}),(0,c.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:(null===l||void 0===l?void 0:l.name)||"Unnamed contact"})]}),(0,c.jsx)("div",{className:"px-5 py-4",children:m?(0,c.jsx)("p",{className:"text-xs text-slate-500",children:"Loading tags..."}):0===o.length?(0,c.jsx)("p",{className:"text-xs text-slate-500",children:y}):(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),null===l||void 0===l||!l.id)return void h.oR.error("No contact selected.");if(!d)return void h.oR.warn("Select a tag first.");if(p)return;const t=Number.isFinite(Number(d))?Number(d):d;g(!0);try{if("remove"===a){const e={contactIds:[l.id],tagId:t};try{await v.default.request({url:"/contacts/bulk-unassign-tag",method:"DELETE",data:e})}catch(c){var s;const t=null===c||void 0===c||null===(s=c.response)||void 0===s?void 0:s.status;if(404!==t&&405!==t)throw c;await v.default.post("/contacts/bulk-unassign-tag",e)}h.oR.success("Tag removed.")}else await v.default.post("/contacts/bulk-assign-tag",{contactIds:[l.id],tagId:t}),h.oR.success("Tag added.");null===r||void 0===r||r(),null===n||void 0===n||n()}catch(u){var o,i;h.oR.error((null===u||void 0===u||null===(o=u.response)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.message)||"Failed to update tag.")}finally{g(!1)}},className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Select tag"}),(0,c.jsx)("select",{className:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-200 disabled:opacity-60",value:d,onChange:e=>u(e.target.value),disabled:p,children:o.map((e=>{var t,a,s,l;const n=null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null===e||void 0===e?void 0:e.tagId,r=null!==(a=null!==(s=null!==(l=null===e||void 0===e?void 0:e.name)&&void 0!==l?l:null===e||void 0===e?void 0:e.tagName)&&void 0!==s?s:null===e||void 0===e?void 0:e.label)&&void 0!==a?a:"Tag";return(0,c.jsx)("option",{value:String(n),children:r},String(n))}))})]}),(0,c.jsxs)("div",{className:"flex justify-end gap-2 pt-1",children:[(0,c.jsx)("button",{type:"button",onClick:n,disabled:p,className:"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed",children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:p||!d,className:"rounded-lg px-4 py-1.5 text-xs font-semibold text-white disabled:opacity-60 disabled:cursor-not-allowed ".concat("remove"===a?"bg-rose-600 hover:bg-rose-700":"bg-emerald-600 hover:bg-emerald-700"),children:p?"Saving...":f})]})]})})]})})}function I(e){return e.tags||e.contactTags||e.tagSummaries||e.tagList||[]}function T(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t}function F(e,t,a){const s=T(e);if(!s)return!0;const l=T(t),n=T(a);if(l&&s<l)return!1;if(n){const e=new Date(n);if(e.setHours(23,59,59,999),s>e)return!1}return!0}function R(e){if(!0===e||!1===e)return e;if("string"===typeof e){const t=e.toLowerCase();if("true"===t||"yes"===t)return!0;if("false"===t||"no"===t)return!1}return null}function M(e){const t=Number(null===e||void 0===e?void 0:e.optStatus),a=Number(null===e||void 0===e?void 0:e.channelStatus),s=[];return 2===t&&s.push({key:"opted-out",label:"Opted out",className:"border-amber-200 bg-amber-50 text-amber-700"}),2===a?s.push({key:"invalid",label:"Invalid",className:"border-rose-200 bg-rose-50 text-rose-700"}):1===a&&s.push({key:"blocked",label:"Blocked",className:"border-orange-200 bg-orange-50 text-orange-700"}),s}function D(e,t){let{searchTerm:a,filters:s}=t;return(Array.isArray(e)?e:[]).filter((e=>{var t,l,n;const r=null!==(t=null===e||void 0===e?void 0:e.createdAt)&&void 0!==t?t:null===e||void 0===e?void 0:e.created_at,o=null!==(l=null!==(n=null===e||void 0===e?void 0:e.lastSeenAt)&&void 0!==n?n:null===e||void 0===e?void 0:e.last_seen_at)&&void 0!==l?l:null===e||void 0===e?void 0:e.lastSeen;return function(e,t){const a=(t||"").trim().toLowerCase();if(!a)return!0;const s=String((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),l=String((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),n=String((null===e||void 0===e?void 0:e.phoneNumber)||"").toLowerCase();return s.includes(a)||l.includes(a)||n.includes(a)}(e,a)&&F(r,null===s||void 0===s?void 0:s.createdFrom,null===s||void 0===s?void 0:s.createdTo)&&F(o,null===s||void 0===s?void 0:s.lastSeenFrom,null===s||void 0===s?void 0:s.lastSeenTo)&&function(e,t){const a=null===t||void 0===t?void 0:t.optedIn;if("yes"===a||"no"===a){var s,l;const t=R(null!==(s=null!==(l=null===e||void 0===e?void 0:e.optedIn)&&void 0!==l?l:null===e||void 0===e?void 0:e.isOptedIn)&&void 0!==s?s:null===e||void 0===e?void 0:e.isOptIn);if(null!==t&&t!==("yes"===a))return!1}const n=null===t||void 0===t?void 0:t.incomingBlocked;if("yes"===n||"no"===n){var r,o;const t=R(null!==(r=null!==(o=null===e||void 0===e?void 0:e.incomingBlocked)&&void 0!==o?o:null===e||void 0===e?void 0:e.isIncomingBlocked)&&void 0!==r?r:null===e||void 0===e?void 0:e.isBlocked);if(null!==t&&t!==("yes"===n))return!1}return!0}(e,s)&&function(e,t){const a=Array.isArray(null===t||void 0===t?void 0:t.tagIds)?t.tagIds.map(String).filter(Boolean):[];if(0===a.length)return!0;const s=I(e),l=new Set((Array.isArray(s)?s:[]).map((e=>{var t;return String(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null===e||void 0===e?void 0:e.tagId)})).filter(Boolean));return"all"===(null===t||void 0===t?void 0:t.tagMatch)?a.every((e=>l.has(e))):a.some((e=>l.has(e)))}(e,s)}))}function P(e){let{onEdit:t,refreshTrigger:a,activeTab:l,onSelectionChange:n,selectedIds:r=[],searchTerm:o,filters:i,currentPage:d,setCurrentPage:u}=e;const[g,b]=(0,s.useState)([]),[y,j]=(0,s.useState)(1),[A,T]=(0,s.useState)(0),[F,R]=(0,s.useState)(20),[P,B]=(0,s.useState)(!1),[E,O]=(0,s.useState)("add"),[L,z]=(0,s.useState)(null),V=(0,x.Zp)(),q=(0,s.useCallback)((async()=>{try{var e,t,a,s,n,r,c;const h=i||{},y=Array.isArray(h.tagIds)?h.tagIds.map(String).filter(Boolean):[];if(y.length>0){var x,p;const e=await v.default.post("/contacts/filter-by-tags",y),t=D(null!==(x=null===(p=e.data)||void 0===p?void 0:p.data)&&void 0!==x?x:e.data,{searchTerm:o,filters:h}),a=Math.max(1,Math.ceil(t.length/F)),s=Math.min(Math.max(1,d),a);s!==d&&u(s);const l=(s-1)*F,n=t.slice(l,l+F);return b(n),j(a),void T(t.length)}if(!!h.createdFrom||!!h.createdTo||!!h.lastSeenFrom||!!h.lastSeenTo||Array.isArray(h.attributes)&&h.attributes.length>0||"yes"===h.optedIn||"no"===h.optedIn||"yes"===h.incomingBlocked||"no"===h.incomingBlocked){var g,f;const e={};h.createdFrom&&(e.createdFrom=h.createdFrom),h.createdTo&&(e.createdTo=h.createdTo),h.lastSeenFrom&&(e.lastSeenFrom=h.lastSeenFrom),h.lastSeenTo&&(e.lastSeenTo=h.lastSeenTo),h.tagMatch&&(e.tagMatch=h.tagMatch),Array.isArray(h.attributes)&&h.attributes.length>0&&(e.attributes=JSON.stringify(h.attributes)),"yes"===h.optedIn&&(e.optedIn=!0),"no"===h.optedIn&&(e.optedIn=!1),"yes"===h.incomingBlocked&&(e.incomingBlocked=!0),"no"===h.incomingBlocked&&(e.incomingBlocked=!1);const t=await v.default.get("/contacts/",{params:(0,m.A)({tab:l,search:o,page:1,pageSize:1e3},e)}),a=null!==(g=null===(f=t.data)||void 0===f?void 0:f.data)&&void 0!==g?g:t.data,s=D(Array.isArray(null===a||void 0===a?void 0:a.items)?a.items:Array.isArray(null===a||void 0===a?void 0:a.Items)?a.Items:Array.isArray(a)?a:[],{searchTerm:o,filters:h}),n=Math.max(1,Math.ceil(s.length/F)),r=Math.min(Math.max(1,d),n);r!==d&&u(r);const i=(r-1)*F,c=s.slice(i,i+F);return b(c),j(n),void T(s.length)}const N={tab:l,search:o,page:d,pageSize:F};h.createdFrom&&(N.createdFrom=h.createdFrom),h.createdTo&&(N.createdTo=h.createdTo),h.lastSeenFrom&&(N.lastSeenFrom=h.lastSeenFrom),h.lastSeenTo&&(N.lastSeenTo=h.lastSeenTo),h.tagMatch&&(N.tagMatch=h.tagMatch),"yes"===h.optedIn&&(N.optedIn=!0),"no"===h.optedIn&&(N.optedIn=!1),"yes"===h.incomingBlocked&&(N.incomingBlocked=!0),"no"===h.incomingBlocked&&(N.incomingBlocked=!1);const w=await v.default.get("/contacts/",{params:N}),S=null!==(e=null===(t=w.data)||void 0===t?void 0:t.data)&&void 0!==e?e:w.data,C=Array.isArray(null===S||void 0===S?void 0:S.items)?S.items:Array.isArray(null===S||void 0===S?void 0:S.Items)?S.Items:Array.isArray(S)?S:[];b(C);const A=null!==(a=null!==(s=null===S||void 0===S?void 0:S.totalCount)&&void 0!==s?s:null===S||void 0===S?void 0:S.TotalCount)&&void 0!==a?a:C.length,k=null!==(n=null!==(r=null===S||void 0===S?void 0:S.pageSize)&&void 0!==r?r:null===S||void 0===S?void 0:S.PageSize)&&void 0!==n?n:F,I=null!==(c=null===S||void 0===S?void 0:S.totalPages)&&void 0!==c?c:null===S||void 0===S?void 0:S.TotalPages,R="number"===typeof I&&I>0?I:Math.max(1,Math.ceil(A/k));j(R),T(A)}catch(w){var y,N;const e=(null===(y=w.response)||void 0===y||null===(N=y.data)||void 0===N?void 0:N.message)||"Failed to load contacts.";h.oR.error(e)}}),[l,o,d,F,i,u]);(0,s.useEffect)((()=>{q()}),[a,l,o,d,q]);const W=(e,t)=>{O(e),z(t),B(!0)},U="py-2";return(0,c.jsxs)("div",{className:"overflow-x-auto",children:[(0,c.jsxs)("table",{className:"w-full text-sm text-slate-900",children:[(0,c.jsx)("thead",{className:"bg-slate-50",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"px-4 ".concat(U," text-center w-6 border-b border-slate-200"),children:(0,c.jsx)(f,{checked:g.length>0&&g.every((e=>r.includes(e.id))),onCheckedChange:e=>{const t=g.map((e=>e.id)).filter((e=>void 0!==e&&null!==e));if(e){const e=Array.from(new Set([...r,...t]));return void(null===n||void 0===n||n(e))}const a=r.filter((e=>!t.includes(e)));null===n||void 0===n||n(a)},className:"w-4 h-4"})}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700"),children:"Name"}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700"),children:"Phone"}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden md:table-cell"),children:"Email"}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden lg:table-cell"),children:"Tags"}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden lg:table-cell"),children:"Created"}),(0,c.jsx)("th",{className:"px-4 ".concat(U," text-center w-8 border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700"),children:"Actions"})]})}),(0,c.jsx)("tbody",{className:"divide-y divide-slate-100",children:0===g.length?(0,c.jsx)("tr",{children:(0,c.jsxs)("td",{colSpan:7,className:"px-6 py-12 text-center text-slate-600",children:[(0,c.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"No contacts found"}),(0,c.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:"Try a different search or add a new contact."})]})}):g.map(((e,a)=>(0,c.jsxs)("tr",{className:"hover:bg-emerald-50/30 transition-colors ".concat(a%2===0?"bg-white":"bg-slate-50/40"),children:[(0,c.jsx)("td",{className:"px-4 ".concat(U," text-center align-middle"),children:(0,c.jsx)(f,{checked:r.includes(e.id),onCheckedChange:t=>((e,t)=>{const a=e?r.includes(t)?r:[...r,t]:r.filter((e=>e!==t));null===n||void 0===n||n(a)})(t,e.id),className:"w-4 h-4"})}),(0,c.jsx)("td",{className:"px-4 ".concat(U),children:(0,c.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,c.jsx)("span",{className:"font-semibold truncate text-sm text-slate-900",children:e.name||"Unnamed contact"}),M(e).map((e=>(0,c.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-medium ".concat(e.className),children:e.label},e.key)))]})}),(0,c.jsx)("td",{className:"px-4 ".concat(U," truncate text-sm font-medium text-slate-800"),children:e.phoneNumber||"-"}),(0,c.jsx)("td",{className:"px-4 ".concat(U," hidden md:table-cell truncate text-sm text-slate-800"),children:e.email||"-"}),(0,c.jsx)("td",{className:"px-4 ".concat(U," hidden lg:table-cell"),children:0===I(e).length?(0,c.jsx)("span",{className:"text-xs text-slate-400",children:"-"}):(0,c.jsxs)("div",{className:"flex flex-wrap gap-1",children:[I(e).slice(0,2).map((e=>{const t=e.id||e.tagId||e.name,a=e.name||e.label||e.tagName;return(0,c.jsx)("span",{className:"inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700",children:a},t)})),I(e).length>2&&(0,c.jsxs)("span",{className:"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] text-slate-600",children:["+",I(e).length-2]})]})}),(0,c.jsx)("td",{className:"px-4 ".concat(U," hidden lg:table-cell truncate text-sm text-slate-800"),children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"-"}),(0,c.jsx)("td",{className:"px-4 ".concat(U," text-center"),children:(0,c.jsxs)(N,{children:[(0,c.jsx)(w,{asChild:!0,children:(0,c.jsx)("button",{className:"p-1.5 rounded-md hover:bg-slate-100 focus:outline-none",children:(0,c.jsx)(p.A,{size:16})})}),(0,c.jsxs)(S,{className:"w-48",children:[(0,c.jsx)(C,{onClick:()=>t(e),className:"px-3 py-2",children:"Edit"}),(0,c.jsx)(C,{onClick:()=>W("add",e),className:"px-3 py-2",children:"Add tag"}),(0,c.jsx)(C,{onClick:()=>W("remove",e),className:"px-3 py-2",children:"Remove tag"}),(0,c.jsx)(C,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this contact?"))try{await v.default.delete("/contacts/".concat(e)),h.oR.success("Contact deleted."),q()}catch(s){var t,a;const e=(null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Failed to delete contact.";h.oR.error(e)}})(e.id),className:"px-3 py-2 text-rose-700 hover:bg-rose-50",children:"Delete"}),(0,c.jsx)(C,{onClick:()=>V("/dashboard/contacts/".concat(e.id,"/notes")),className:"px-3 py-2",children:"Notes"})]})]})})]},e.id)))})]}),(0,c.jsx)(k,{isOpen:P,mode:E,contact:L,onClose:()=>{B(!1),z(null)},onUpdated:q}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 px-6 py-4 text-sm text-slate-600 bg-slate-50/50 border-t border-slate-100",children:[(0,c.jsxs)("div",{className:"flex items-center gap-4",children:[(0,c.jsx)("span",{className:"text-xs font-medium text-slate-700",children:A>0?(0,c.jsxs)(c.Fragment,{children:["Showing"," ",(0,c.jsxs)("span",{className:"font-semibold text-emerald-700",children:[(d-1)*F+1,"-",Math.min(d*F,A)]})," ","of"," ",(0,c.jsx)("span",{className:"font-semibold text-slate-900",children:A})," ","contacts"]}):"No contacts"}),(0,c.jsx)("span",{className:"hidden sm:inline text-xs text-slate-400",children:"\u2022"}),(0,c.jsxs)("span",{className:"text-xs text-slate-500",children:["Page ",d," of ",y]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)("div",{className:"flex items-center gap-2",children:(0,c.jsxs)("select",{value:F,onChange:e=>{R(Number(e.target.value)),u(1)},className:"text-xs font-medium border border-slate-300 rounded-md px-2 py-1.5 bg-white hover:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-200 transition-all cursor-pointer",children:[(0,c.jsx)("option",{value:10,children:"10/page"}),(0,c.jsx)("option",{value:20,children:"20/page"}),(0,c.jsx)("option",{value:50,children:"50/page"}),(0,c.jsx)("option",{value:100,children:"100/page"})]})}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("button",{onClick:()=>u((e=>Math.max(e-1,1))),disabled:1===d,className:"px-3 py-1.5 border border-slate-200 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-slate-300 transition-colors text-xs font-medium",children:"Prev"}),(0,c.jsx)("button",{onClick:()=>u((e=>Math.min(e+1,y))),disabled:d===y,className:"px-3 py-1.5 border border-slate-200 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-slate-300 transition-colors text-xs font-medium",children:"Next"})]})]})]})]})}function B(e){let{selected:t=[],onChange:a,multi:l=!0,tags:n}=e;const[r,o]=(0,s.useState)([]);(0,s.useEffect)((()=>{Array.isArray(n)||i()}),[n]);const i=async()=>{try{var e;const t=await v.default.get("/tags");let a=[];Array.isArray(t.data)?a=t.data:Array.isArray(null===(e=t.data)||void 0===e?void 0:e.data)&&(a=t.data.data),o(a)}catch(t){console.error("\u274c Failed to load tags",t),h.oR.error("Failed to load tags"),o([])}},d=Array.isArray(n)?n:r;return d.length?(0,c.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map((e=>{const s=t.includes(e.id);return(0,c.jsxs)("button",{type:"button",onClick:()=>(e=>{if(a)if(l){const s=t.includes(e)?t.filter((t=>t!==e)):[...t,e];a(s)}else a([e])})(e.id),className:"px-3 py-1 rounded-full text-xs border transition-all duration-150 flex items-center ".concat(s?"bg-emerald-600 text-white border-emerald-600 shadow-sm":"bg-gray-50 text-gray-700 border-gray-300 hover:bg-emerald-50 hover:border-emerald-200 hover:text-emerald-800"),title:e.notes||e.name,children:[(0,c.jsx)("span",{className:"inline-block w-2 h-2 rounded-full mr-2",style:{backgroundColor:e.colorHex||"#22C55E"}}),e.name]},e.id)}))}):(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"No tags yet. Create tags in the Tags workspace."})}var E=a(86204);const O=e=>e?e instanceof Date?e.toISOString().slice(0,10):"string"===typeof e?e.slice(0,10):"":"",L=(e,t)=>{if(null===t||void 0===t||""===t)return"-";if("Boolean"===e)return t?"Yes":"No";if("MultiSelect"===e&&Array.isArray(t))return t.join(", ")||"-";if("Date"===e)try{return new Date(t).toLocaleDateString()}catch(a){return t}return String(t)};function z(e){let{entityType:t="Contact",entityId:a,mode:l="edit"}=e;const[n,r]=(0,s.useState)([]),[o,i]=(0,s.useState)({}),[d,u]=(0,s.useState)(!1),[x,p]=(0,s.useState)(!1),v="view"===l,g=(0,s.useMemo)((()=>String(t||"Contact").trim()||"Contact"),[t]),b=async()=>{if(a){u(!0);try{const{definitions:e,valuesMap:t}=await(0,E.Wd)({entityType:g,entityId:a}),s=(0,m.A)({},t||{});e.forEach((e=>{const a=null===t||void 0===t?void 0:t[e.id];"Boolean"===e.dataType&&(s[e.id]=!0===a||"true"===a||1===a||"1"===a),"MultiSelect"===e.dataType&&(s[e.id]=Array.isArray(a)?a:a?[a]:[]),"Number"===e.dataType&&(s[e.id]=null===a||void 0===a?"":String(a)),"Date"===e.dataType&&(s[e.id]=O(a))})),r(e),i(s)}catch(s){var e,t;h.oR.error((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to load attributes."),r([]),i({})}finally{u(!1)}}};(0,s.useEffect)((()=>{b()}),[a,g]);const f=(0,s.useMemo)((()=>n.slice().sort(((e,t)=>e.sortOrder-t.sortOrder))),[n]),y=(e,t)=>{i((a=>(0,m.A)((0,m.A)({},a),{},{[e]:t})))};return a?d?(0,c.jsx)("div",{className:"rounded-md border border-slate-100 bg-white px-3 py-3 text-xs text-slate-500",children:"Loading attributes..."}):f.length?v?(0,c.jsx)("div",{className:"space-y-3",children:f.map((e=>(0,c.jsxs)("div",{className:"rounded-md border border-slate-100 bg-white px-3 py-2",children:[(0,c.jsx)("p",{className:"text-[11px] font-semibold text-slate-500",children:e.label}),(0,c.jsx)("p",{className:"text-sm text-slate-800",children:L(e.dataType,o[e.id])})]},e.id)))}):(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map((e=>{var t,a,s;return(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsxs)("label",{className:"text-xs font-semibold text-slate-600",children:[e.label,e.isRequired&&(0,c.jsx)("span",{className:"ml-1 text-rose-500",children:"*"})]}),"Text"===e.dataType&&(0,c.jsx)("input",{type:"text",value:null!==(t=o[e.id])&&void 0!==t?t:"",onChange:t=>y(e.id,t.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400"}),"Number"===e.dataType&&(0,c.jsx)("input",{type:"number",value:null!==(a=o[e.id])&&void 0!==a?a:"",onChange:t=>y(e.id,t.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400"}),"Date"===e.dataType&&(0,c.jsx)("input",{type:"date",value:O(o[e.id]),onChange:t=>y(e.id,t.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400"}),"Boolean"===e.dataType&&(0,c.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,c.jsx)("input",{type:"checkbox",checked:Boolean(o[e.id]),onChange:t=>y(e.id,t.target.checked),className:"h-4 w-4 rounded border-slate-300 text-purple-600 focus:ring-purple-500"}),Boolean(o[e.id])?"Yes":"No"]}),"SingleSelect"===e.dataType&&(0,c.jsxs)("select",{value:null!==(s=o[e.id])&&void 0!==s?s:"",onChange:t=>y(e.id,t.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400",children:[(0,c.jsx)("option",{value:"",children:"Select..."}),e.options.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]}),"MultiSelect"===e.dataType&&(0,c.jsx)("div",{className:"rounded-md border border-slate-200 bg-slate-50 px-3 py-2",children:0===e.options.length?(0,c.jsx)("p",{className:"text-xs text-slate-400",children:"No options."}):(0,c.jsx)("div",{className:"space-y-2",children:e.options.map((t=>(0,c.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,c.jsx)("input",{type:"checkbox",checked:Array.isArray(o[e.id])&&o[e.id].includes(t),onChange:()=>((e,t)=>{const a=Array.isArray(o[e])?o[e]:[];a.includes(t)?y(e,a.filter((e=>e!==t))):y(e,[...a,t])})(e.id,t),className:"h-4 w-4 rounded border-slate-300 text-purple-600 focus:ring-purple-500"}),t]},t)))})})]},e.id)}))}),(0,c.jsx)("div",{className:"flex justify-end",children:(0,c.jsx)("button",{type:"button",onClick:async()=>{if(a){p(!0);try{const e={entityType:g,entityId:a,values:f.map((e=>{let t=o[e.id];if("Number"===e.dataType)if(""===t||null===t||void 0===t)t=null;else{const e=Number(t);t=Number.isFinite(e)?e:null}return"Date"===e.dataType&&(t=t?new Date(t).toISOString():null),"Boolean"===e.dataType&&(t=Boolean(t)),"MultiSelect"===e.dataType&&(t=Array.isArray(t)?t:[]),{fieldId:e.id,value:t}}))};await(0,E.jB)(e),h.oR.success("Attributes saved."),await b()}catch(s){var e,t;h.oR.error((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to save attributes.")}finally{p(!1)}}},disabled:x,className:"rounded-md bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 disabled:bg-purple-300",children:x?"Saving...":"Save Attributes"})})]}):(0,c.jsx)("div",{className:"rounded-md border border-dashed border-slate-200 bg-slate-50 px-3 py-3 text-xs text-slate-500",children:"No attributes configured yet."}):(0,c.jsx)("div",{className:"rounded-md border border-slate-100 bg-slate-50 px-3 py-2 text-xs text-slate-500",children:"Save contact first to set attributes."})}const V=["Manual","Website Form","Google Search","Facebook Ad","LinkedIn","Referral","Trade Show","Cold Call","Other"],q=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const W=function(e){let{isOpen:t,onClose:a,contact:l,onSaveComplete:n}=e;const[r,o]=(0,s.useState)({name:"",phoneNumber:"",email:"",leadSource:"Manual",notes:"",tagIds:[]}),[i,d]=(0,s.useState)([]),[u,x]=(0,s.useState)(!1),[p,g]=(0,s.useState)({phoneNumber:!1,email:!1}),[b,f]=(0,s.useState)(!1),y=e=>{let t=e.replace(/\D/g,"");return t.length>10&&t.startsWith("91")&&(t=t.slice(2)),t.length>10&&t.startsWith("0")&&(t=t.slice(1)),t.slice(0,10)},j=(N=r.phoneNumber)?10!==N.length?"Mobile number must be exactly 10 digits.":"":"Mobile number is required.";var N;const w=(e=>e?q.test(e)?"":"Please enter a valid email address.":"")(r.email),S=!j&&!w;(0,s.useEffect)((()=>{t&&(async()=>{try{var e;const t=await v.default.get("/tags"),a=Array.isArray(t.data)?t.data:Array.isArray(null===(e=t.data)||void 0===e?void 0:e.data)?t.data.data:[];d(a)}catch(t){console.error("Failed to load tags:",t),h.oR.error("Failed to load tags.")}})()}),[t]),(0,s.useEffect)((()=>{if(l){const e=l.tags||l.contactTags||l.tagSummaries||l.tagList||[],t=Array.isArray(e)?e.map((e=>e.tagId||e.id)).filter(Boolean):[];o({name:l.name||"",phoneNumber:y(l.phoneNumber||""),email:l.email||"",leadSource:l.leadSource||"Manual",notes:l.notes||"",tagIds:t})}else o({name:"",phoneNumber:"",email:"",leadSource:"Manual",notes:"",tagIds:[]});g({phoneNumber:!1,email:!1}),f(!1)}),[l,t]);const C=e=>{const{name:t,value:a}=e.target;o((e=>(0,m.A)((0,m.A)({},e),{},{[t]:a})))};return t?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4",children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl relative",children:[(0,c.jsx)("button",{onClick:a,className:"absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl",children:"\xd7"}),(0,c.jsx)("h2",{className:"text-xl font-bold mb-4",children:null!==l&&void 0!==l&&l.id?"Edit Contact":"Add New Contact"}),(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f(!0),!S)return void h.oR.error(j||w);x(!0);const t=(0,m.A)((0,m.A)({},r),{},{tagIds:r.tagIds});try{null!==l&&void 0!==l&&l.id?(await v.default.put("/contacts/".concat(l.id),t),h.oR.success("\u2705 Contact updated successfully!")):(await v.default.post("/contacts/create",t),h.oR.success("\u2705 Contact created successfully!")),null===n||void 0===n||n(),a()}catch(i){if(i.response&&409===i.response.status)h.oR.warn(i.response.data.message||"Contact with this phone number already exists.");else{var s,o;const e=(null===(s=i.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Failed to save contact.";h.oR.error(e)}}finally{x(!1)}},className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsx)("input",{name:"name",value:r.name,onChange:C,placeholder:"Full Name *",required:!0,className:"border px-3 py-2 rounded w-full"}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("input",{type:"tel",name:"phoneNumber",value:r.phoneNumber,onChange:e=>{const t=y(e.target.value);o((e=>(0,m.A)((0,m.A)({},e),{},{phoneNumber:t}))),g((e=>(0,m.A)((0,m.A)({},e),{},{phoneNumber:!0})))},placeholder:"Phone Number *",required:!0,maxLength:10,inputMode:"numeric",autoComplete:"tel",className:"border px-3 py-2 rounded w-full"}),(p.phoneNumber||b)&&j&&(0,c.jsx)("p",{className:"text-[11px] text-rose-600",children:j})]}),(0,c.jsxs)("div",{className:"space-y-1",children:[(0,c.jsx)("input",{type:"email",name:"email",value:r.email,onChange:e=>{const{value:t}=e.target;o((e=>(0,m.A)((0,m.A)({},e),{},{email:t}))),g((e=>(0,m.A)((0,m.A)({},e),{},{email:!0})))},placeholder:"Email",className:"border px-3 py-2 rounded w-full"}),(p.email||b)&&w&&(0,c.jsx)("p",{className:"text-[11px] text-rose-600",children:w})]}),(0,c.jsx)("select",{name:"leadSource",value:r.leadSource,onChange:C,className:"border px-3 py-2 rounded w-full",children:V.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))}),(0,c.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,c.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Tags (optional)"}),0===i.length?(0,c.jsxs)("div",{className:"text-xs text-slate-600 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 flex items-center justify-between gap-3",children:[(0,c.jsx)("span",{children:"No tags yet. Create a tag first to segment contacts."}),(0,c.jsx)("button",{type:"button",onClick:()=>window.open("/app/crm/tags","_blank"),className:"text-emerald-700 font-semibold hover:text-emerald-800 whitespace-nowrap",children:"Create tag"})]}):(0,c.jsx)(B,{tags:i,selected:r.tagIds,onChange:e=>o((t=>(0,m.A)((0,m.A)({},t),{},{tagIds:e}))),multi:!0}),!(null!==l&&void 0!==l&&l.id)&&i.length>0&&(0,c.jsx)("p",{className:"text-[11px] text-slate-500",children:"Tags are optional. You can add them now or later."})]}),(0,c.jsx)("textarea",{name:"notes",value:r.notes,onChange:C,placeholder:"Notes...",className:"md:col-span-2 border px-3 py-2 rounded w-full min-h-[80px]"}),(0,c.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h3",{className:"text-sm font-semibold text-slate-700",children:"Attributes"}),(0,c.jsx)("span",{className:"text-[11px] text-slate-400",children:"CRM contact attributes"})]}),null!==l&&void 0!==l&&l.id?(0,c.jsx)(z,{entityType:"Contact",entityId:l.id,mode:"edit"}):(0,c.jsx)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 px-3 py-2 text-xs text-slate-500",children:"Save contact first to set attributes."})]}),(0,c.jsxs)("div",{className:"md:col-span-2 flex justify-end gap-3",children:[(0,c.jsx)("button",{type:"button",onClick:a,className:"bg-gray-200 text-gray-800 px-6 py-2 rounded hover:bg-gray-300",children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:u||!S,className:"bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 disabled:bg-emerald-300",children:u?"Saving...":null!==l&&void 0!==l&&l.id?"Update Contact":"Add Contact"})]})]})]})}):null};const U=function(e){let{selectedIds:t=[],onClearSelection:a,onRefresh:l}=e;const[n,r]=(0,s.useState)([]),[o,i]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1);(0,s.useEffect)((()=>{t.length>0&&m()}),[t.length]);const m=async()=>{try{const t=e=>{var t,a;const s=null!==(t=null===(a=e.data)||void 0===a?void 0:a.data)&&void 0!==t?t:e.data;return Array.isArray(s)?s:[]};try{const e=t(await v.default.get("/tags"));if(e.length>0)return void r(e)}catch(e){}const a=await v.default.get("/tags/get-tags");r(t(a))}catch(t){h.oR.error("Failed to load tags.")}};return 0===t.length?null:(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 py-3 bg-emerald-50/60 border border-emerald-200/70",children:[(0,c.jsxs)("p",{className:"text-sm text-slate-700 font-medium",children:[t.length," selected"]}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto",children:[(0,c.jsxs)("select",{value:o,onChange:e=>i(e.target.value),disabled:d,className:"w-full sm:w-60 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-200 disabled:opacity-60",children:[(0,c.jsx)("option",{value:"",children:"Select tag"}),n.map((e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id)))]}),(0,c.jsx)("button",{onClick:async()=>{if(o)try{var e;if(d)return;u(!0);const s=await v.default.post("/contacts/bulk-assign-tag",{contactIds:t,tagId:Number.isFinite(Number(o))?Number(o):o});h.oR.success((null===s||void 0===s||null===(e=s.data)||void 0===e?void 0:e.message)||"Tag applied to selected contacts."),null===a||void 0===a||a(),i(""),null===l||void 0===l||l()}catch(r){var s,n;const e=(null===(s=r.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Failed to apply tag.";h.oR.error(e)}finally{u(!1)}else h.oR.warn("Select a tag first.")},disabled:!o||d,className:"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 disabled:opacity-60 disabled:cursor-not-allowed",children:d?"Saving...":"Apply tag"}),(0,c.jsx)("button",{onClick:async()=>{if(o)try{var e,s;if(d)return;u(!0);const c=Number.isFinite(Number(o))?Number(o):o,m={contactIds:t,tagId:c,tagIds:[c]};let g=null;try{g=await v.default.request({url:"/contacts/bulk-unassign-tag",method:"DELETE",data:m})}catch(x){var n;const e=null===x||void 0===x||null===(n=x.response)||void 0===n?void 0:n.status;if(400!==e&&404!==e&&405!==e&&415!==e)throw x;try{g=await v.default.post("/contacts/bulk-unassign-tag",m)}catch(p){var r;if(404===(null===p||void 0===p||null===(r=p.response)||void 0===r?void 0:r.status)){const e=await Promise.allSettled(t.map((e=>v.default.delete("/contacts/".concat(e,"/tags/").concat(c))))),s=e.filter((e=>{var t,a;if("fulfilled"===e.status)return!0;return 404===(null===(t=e.reason)||void 0===t||null===(a=t.response)||void 0===a?void 0:a.status)})).length,n=e.length-s;return 0===n?h.oR.success("Tag removed from ".concat(s," contact(s).")):h.oR.warn("Removed from ".concat(s," contact(s), failed for ").concat(n,".")),null===a||void 0===a||a(),i(""),void(null===l||void 0===l||l())}throw p}}h.oR.success((null===(e=g)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Tag removed from selected contacts."),null===a||void 0===a||a(),i(""),null===l||void 0===l||l()}catch(g){var c,m;const e=(null===(c=g.response)||void 0===c||null===(m=c.data)||void 0===m?void 0:m.message)||"Failed to remove tag.";h.oR.error(e)}finally{u(!1)}else h.oR.warn("Select a tag first.")},disabled:!o||d,className:"rounded-lg bg-rose-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-rose-700 disabled:opacity-60 disabled:cursor-not-allowed",children:"Remove tag"}),(0,c.jsx)("button",{onClick:a,disabled:d,className:"text-sm font-medium text-slate-600 hover:text-slate-900 disabled:opacity-60 disabled:cursor-not-allowed",children:"Clear selection"})]})]})};var H=a(5766),J=a.n(H);const _=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,G=e=>{const t=String(null!==e&&void 0!==e?e:"").replace(/\D/g,"");return t?12===t.length&&t.startsWith("91")?t.slice(2):11===t.length&&t.startsWith("0")?t.slice(1):10===t.length?t:"":""},K=e=>String(e||"").trim().toLowerCase().replace(/[^a-z0-9]/g,""),Q=(e,t)=>{for(const a of t)if(void 0!==e[a])return e[a];return""};function Y(e){let{isOpen:t,onClose:a,onRefresh:l,onImportingChange:n}=e;const[r,o]=(0,s.useState)(null),[i,d]=(0,s.useState)(!1),[u,x]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!1),[b,f]=(0,s.useState)([]),[y,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!0),[S,C]=(0,s.useState)(!0),[A,k]=(0,s.useState)(!0),[I,T]=(0,s.useState)(!1),F=(0,s.useMemo)((()=>b.filter((e=>e.errors.length>0))),[b]),R=(0,s.useMemo)((()=>b.filter((e=>e.isDuplicate))),[b]),M=(0,s.useMemo)((()=>b.filter((e=>e.existsInCrm))),[b]),D=(0,s.useMemo)((()=>b.filter((e=>!(e.errors.length>0)&&((!S||!e.isDuplicate)&&(!A||!e.existsInCrm))))),[b,S,A]),P=b.length,B=P-F.length,E=Math.max(0,P-D.length),O=(0,s.useMemo)((()=>{const e=[];return y?(F.length>0&&!N&&e.push("Validation errors found. Enable \u201cSkip invalid rows\u201d."),R.length>0&&!S&&e.push("Duplicate phones found. Enable \u201cSkip duplicates\u201d."),M.length>0&&!A&&e.push("Existing contacts found. Enable \u201cSkip existing contacts\u201d."),0===D.length&&e.push("No importable rows after applying filters."),e):e}),[y,F.length,R.length,M.length,N,S,A,D.length]),L=y&&0===O.length&&!i&&!u&&!p,z=()=>{o(null),d(!1),x(!1),g(!1),f([]),j(!1),w(!0),C(!0),k(!0),T(!1),null===n||void 0===n||n(!1)};return t?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md w-full max-w-md space-y-4 relative",children:[(0,c.jsx)("h2",{className:"text-xl font-bold text-emerald-700",children:"Import Contacts CSV"}),(0,c.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;o((null===(t=e.target.files)||void 0===t?void 0:t[0])||null),f([]),j(!1),w(!0),C(!0),k(!0),T(!1)}}),y&&(0,c.jsxs)("div",{className:"rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-700 space-y-1",children:[(0,c.jsx)("div",{className:"font-semibold text-slate-800",children:"Validation summary"}),(0,c.jsxs)("div",{children:["Total rows: ",P]}),(0,c.jsxs)("div",{children:["Valid rows: ",B]}),(0,c.jsxs)("div",{children:["Invalid rows: ",F.length]}),(0,c.jsxs)("div",{children:["Duplicates in file: ",R.length]}),(0,c.jsxs)("div",{children:["Existing in CRM: ",M.length]}),(0,c.jsxs)("div",{children:["Ready to import: ",D.length]}),u&&(0,c.jsx)("div",{className:"text-[11px] text-slate-500",children:"Checking existing contacts..."})]}),y&&(0,c.jsxs)("div",{className:"space-y-2 text-xs text-slate-700",children:[(0,c.jsxs)("label",{className:"flex items-center gap-2",children:[(0,c.jsx)("input",{type:"checkbox",checked:N,onChange:e=>w(e.target.checked)}),"Skip rows with validation errors"]}),(0,c.jsxs)("label",{className:"flex items-center gap-2",children:[(0,c.jsx)("input",{type:"checkbox",checked:S,onChange:e=>C(e.target.checked)}),"Skip duplicate phone numbers in file"]}),(0,c.jsxs)("label",{className:"flex items-center gap-2",children:[(0,c.jsx)("input",{type:"checkbox",checked:A,onChange:e=>k(e.target.checked)}),"Skip contacts that already exist in CRM"]})]}),F.length>0&&(0,c.jsxs)("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700 max-h-40 overflow-auto",children:[(0,c.jsx)("div",{className:"font-semibold text-rose-800 mb-1",children:"Row issues"}),(0,c.jsx)("ul",{className:"space-y-1",children:F.map(((e,t)=>(0,c.jsxs)("li",{children:[(0,c.jsxs)("span",{className:"font-semibold",children:["Row ",e.rowNumber,":"]})," ",e.errors.join(" ")]},"".concat(e.rowNumber,"-err-").concat(t))))})]}),R.length>0&&(0,c.jsxs)("div",{className:"rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700 max-h-32 overflow-auto",children:[(0,c.jsx)("div",{className:"font-semibold text-amber-800 mb-1",children:"Duplicate rows"}),(0,c.jsx)("ul",{className:"space-y-1",children:R.map(((e,t)=>(0,c.jsxs)("li",{children:["Row ",e.rowNumber,": ",e.phoneRaw||e.normalizedPhone]},"".concat(e.rowNumber,"-dup-").concat(t))))})]}),M.length>0&&(0,c.jsxs)("div",{className:"rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700 max-h-32 overflow-auto",children:[(0,c.jsx)("div",{className:"font-semibold text-amber-800 mb-1",children:"Already in CRM"}),(0,c.jsx)("ul",{className:"space-y-1",children:M.map(((e,t)=>(0,c.jsxs)("li",{children:["Row ",e.rowNumber,": ",e.phoneRaw||e.normalizedPhone]},"".concat(e.rowNumber,"-exist-").concat(t))))})]}),O.length>0&&(0,c.jsx)("div",{className:"rounded-md border border-slate-200 bg-white px-3 py-2 text-xs text-slate-600",children:O.map(((e,t)=>(0,c.jsx)("div",{children:e},"".concat(e,"-").concat(t))))}),(0,c.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,c.jsx)("button",{onClick:()=>{p||(z(),null===a||void 0===a||a())},disabled:p,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm disabled:opacity-60",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{r?r.name.toLowerCase().endsWith(".csv")?(d(!0),j(!1),f([]),J().parse(r,{header:!0,skipEmptyLines:!0,transformHeader:K,complete:e=>{const t=Array.isArray(e.data)?e.data:[],a=[];t.forEach(((e,t)=>{const s=Q(e,["name"]),l=Q(e,["phonenumber","phone","mobile","mobilenumber"]),n=Q(e,["email"]),r=Q(e,["leadsource","source"]),o=Q(e,["notes","note"]);if(![s,l,n,r,o].some((e=>String(null!==e&&void 0!==e?e:"").trim())))return;const i=[];String(null!==s&&void 0!==s?s:"").trim()||i.push("Name is required.");const d=G(l);String(null!==l&&void 0!==l?l:"").trim()?d||i.push("Phone number must be 10 digits after removing +91 or leading 0."):i.push("Phone number is required.");const c=String(null!==n&&void 0!==n?n:"").trim();c&&!_.test(c)&&i.push("Email format is invalid."),a.push({rowNumber:t+2,name:String(null!==s&&void 0!==s?s:"").trim(),phoneRaw:String(null!==l&&void 0!==l?l:"").trim(),normalizedPhone:d,email:c,leadSource:String(null!==r&&void 0!==r?r:"").trim(),notes:String(null!==o&&void 0!==o?o:"").trim(),errors:i,isDuplicate:!1,existsInCrm:!1})}));const s=new Set;a.forEach((e=>{e.normalizedPhone&&(s.has(e.normalizedPhone)?e.isDuplicate=!0:s.add(e.normalizedPhone))})),f(a),j(!0),d(!1),0!==a.length?(async e=>{const t=Array.from(new Set(e.map((e=>e.normalizedPhone)).filter(Boolean)));if(0===t.length)return;const a=new Set;x(!0);for(const r of t)try{var s,l;const e=await v.default.get("/contacts/",{params:{tab:"all",search:r,page:1,pageSize:10}}),t=null!==(s=null===(l=e.data)||void 0===l?void 0:l.data)&&void 0!==s?s:e.data;(Array.isArray(null===t||void 0===t?void 0:t.items)?t.items:Array.isArray(null===t||void 0===t?void 0:t.Items)?t.Items:Array.isArray(t)?t:[]).some((e=>{const t=G(e.phoneNumber),a=void 0!==e.isActive?e.isActive:void 0===e.IsActive||e.IsActive;return t&&t===r&&!1!==a}))&&a.add(r)}catch(n){console.error("Failed to check existing contacts",n)}f((e=>e.map((e=>(0,m.A)((0,m.A)({},e),{},{existsInCrm:a.has(e.normalizedPhone)}))))),x(!1)})(a):h.oR.warn("No valid data rows found in the CSV.")},error:()=>{h.oR.error("Failed to read the CSV file."),d(!1)}})):h.oR.warn("Please upload a .csv file."):h.oR.warn("Please select a CSV file.")},disabled:!r||i||p,className:"px-4 py-2 rounded border border-emerald-200 text-emerald-700 hover:bg-emerald-50 text-sm disabled:opacity-60",children:i?"Validating...":"Validate"}),(0,c.jsx)("button",{onClick:()=>{L&&T(!0)},disabled:!L,className:"px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700 text-sm disabled:bg-emerald-300",children:"Import"})]}),I&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[60] p-4",children:(0,c.jsxs)("div",{className:"bg-white rounded-xl shadow-lg max-w-sm w-full p-5 space-y-4",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"Confirm import"}),(0,c.jsxs)("p",{className:"text-sm text-slate-600",children:[D.length," contacts will be imported. Continue?"]}),E>0&&(0,c.jsxs)("p",{className:"text-xs text-slate-500",children:["Skipping ",E," row",1===E?"":"s"," due to filters."]}),(0,c.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,c.jsx)("button",{onClick:()=>T(!1),disabled:p,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm disabled:opacity-60",children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{if(!r||0===D.length)return;g(!0),null===n||void 0===n||n(!0);const e=D.map((e=>({Name:e.name,PhoneNumber:e.normalizedPhone,Email:e.email,LeadSource:e.leadSource,Notes:e.notes}))),t=J().unparse(e,{columns:["Name","PhoneNumber","Email","LeadSource","Notes"]}),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=new FormData;o.append("file",s,r.name);try{await v.default.post("/contacts/bulk-import",o,{headers:{"Content-Type":"multipart/form-data"}}),h.oR.success("Contacts imported successfully."),null===l||void 0===l||l(),z(),null===a||void 0===a||a()}catch(c){var i,d;const e=(null===(i=c.response)||void 0===i||null===(d=i.data)||void 0===d?void 0:d.message)||"Failed to import contacts. Please check the CSV.";h.oR.error(e)}finally{g(!1),null===n||void 0===n||n(!1),T(!1)}},disabled:p,className:"px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700 text-sm disabled:bg-emerald-300",children:p?"Importing...":"Confirm Import"})]})]})})]})}):null}var $=a(28646),Z=a(29350);const X=(0,a(77784).A)("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var ee=a(95258),te=a(50516),ae=a(36210),se=a(40614),le=a(2580),ne=a(9855);function re(e){var t,a;const s=null!==(t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.data)&&void 0!==t?t:null===e||void 0===e?void 0:e.data;return Array.isArray(s)?s:[]}function oe(e){const t=new Date(e);return t.setHours(0,0,0,0),t}function ie(e){const t=new Date(e);return t.setHours(23,59,59,999),t}function de(e){if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(s,"-").concat(l)}const ce=Object.freeze({lastSeenPreset:"",lastSeenFrom:"",lastSeenTo:"",createdPreset:"",createdFrom:"",createdTo:"",optedIn:"all",incomingBlocked:"all",tagIds:[],tagMatch:"any",attributes:[]}),ue=[{id:"dates",label:"Date Ranges",icon:$.A},{id:"tags",label:"Tags",icon:Z.A},{id:"attributes",label:"Attributes",icon:X},{id:"status",label:"Status",icon:ee.A}];function me(e){let{filters:t,setField:a}=e;const s=e=>{let{label:t,value:a,onChange:s,options:l}=e;return(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wider",children:t}),(0,c.jsx)("div",{className:"flex gap-2",children:l.map((e=>{const t=a===e.value;return(0,c.jsx)("button",{type:"button",onClick:()=>s(e.value),className:"flex-1 px-4 py-2.5 rounded-lg text-xs font-medium border transition-all ".concat(t?"bg-emerald-600 border-emerald-600 text-white shadow-sm ring-2 ring-emerald-100":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300"),children:e.label},e.value)}))})]})};return(0,c.jsxs)("div",{className:"space-y-8 animate-in fade-in zoom-in-95 duration-200",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-sm font-medium text-slate-900 mb-1",children:"Status"}),(0,c.jsx)("p",{className:"text-xs text-slate-500",children:"Filter contacts based on their opt-in status and availability."})]}),(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)(s,{label:"Marketing Opt-in",value:t.optedIn,onChange:e=>a("optedIn",e),options:[{value:"all",label:"All Contacts"},{value:"yes",label:"Opted In"},{value:"no",label:"Opted Out"}]}),(0,c.jsx)("div",{className:"h-px bg-slate-100"}),(0,c.jsx)(s,{label:"Incoming Messages",value:t.incomingBlocked,onChange:e=>a("incomingBlocked",e),options:[{value:"all",label:"All Contacts"},{value:"yes",label:"Incoming Blocked"},{value:"no",label:"Allowed"}]})]})]})}function xe(e){let{filters:t,setField:a,tags:s,loadingTags:l,tagQuery:r,setTagQuery:o,toggleTag:i}=e;const d=Array.isArray(t.tagIds)?t.tagIds:[],u=r.trim().toLowerCase(),m=0===u.length?s:s.filter((e=>String((null===e||void 0===e?void 0:e.name)||"").toLowerCase().includes(u)));return(0,c.jsxs)("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-200",children:[(0,c.jsxs)("div",{className:"flex-none mb-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-sm font-medium text-slate-900 mb-1",children:"Tags"}),(0,c.jsx)("p",{className:"text-xs text-slate-500",children:"Select tags to include in your filter."})]}),d.length>0&&(0,c.jsx)("button",{onClick:()=>a("tagIds",[]),className:"text-[11px] font-medium text-red-600 hover:bg-red-50 px-2 py-1 rounded transition-colors",children:"Clear selection"})]}),(0,c.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,c.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-lg self-start",children:[(0,c.jsx)("button",{type:"button",onClick:()=>a("tagMatch","any"),className:"px-3 py-1 text-[11px] font-medium rounded-md transition-all ".concat("any"===t.tagMatch?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"),children:"Match Any"}),(0,c.jsx)("button",{type:"button",onClick:()=>a("tagMatch","all"),className:"px-3 py-1 text-[11px] font-medium rounded-md transition-all ".concat("all"===t.tagMatch?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"),children:"Match All"})]}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(n.A,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),(0,c.jsx)("input",{value:r,onChange:e=>o(e.target.value),placeholder:"Search tags...",className:"w-full pl-9 pr-4 py-2 text-xs rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-colors"})]})]})]}),(0,c.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:l?(0,c.jsxs)("div",{className:"py-8 text-center text-xs text-slate-500",children:[(0,c.jsx)(te.A,{className:"h-4 w-4 mx-auto mb-2 animate-spin text-slate-400"}),"Loading tags..."]}):0===m.length?(0,c.jsx)("div",{className:"py-8 text-center text-xs text-slate-500",children:"No tags found."}):(0,c.jsx)("div",{className:"flex flex-wrap gap-2",children:m.map((e=>{const t=String(e.id),a=d.includes(t);return(0,c.jsxs)("button",{type:"button",onClick:()=>i(t),className:"group relative flex items-center pr-3 pl-2.5 py-1.5 rounded-md border text-[11px] font-medium transition-all ".concat(a?"bg-emerald-50 border-emerald-200 text-emerald-900":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,c.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(a?"ring-2 ring-emerald-100":""),style:{backgroundColor:e.colorHex||"#10B981"}}),e.name,a&&(0,c.jsx)(ae.A,{className:"ml-2 h-3 w-3 text-emerald-600"})]},t)}))})})]})}function he(e){let{title:t,presets:a,presetKey:s,from:l,to:n,onPreset:r,onFrom:o,onTo:i}=e;return(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsx)("div",{className:"flex items-center justify-between",children:(0,c.jsx)("label",{className:"text-xs font-bold text-slate-700 uppercase tracking-wider",children:t})}),(0,c.jsx)("div",{className:"grid grid-cols-4 gap-2",children:a.map((e=>(0,c.jsx)("button",{type:"button",onClick:()=>r(e.key),className:"px-3 py-2 text-[11px] font-medium rounded-lg border transition-all ".concat(s===e.key?"bg-emerald-600 border-emerald-600 text-white":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"),children:e.label},e.key)))}),(0,c.jsxs)("div",{className:"flex items-center gap-3 bg-slate-50 p-3 rounded-lg border border-slate-200",children:[(0,c.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,c.jsx)("span",{className:"text-[10px] uppercase text-slate-400 font-semibold pl-1",children:"From"}),(0,c.jsx)("input",{type:"date",value:l||"",onChange:o,className:"w-full text-xs bg-white border border-slate-200 rounded px-2 py-1.5 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"})]}),(0,c.jsx)("div",{className:"pt-4 text-slate-400",children:"\u2192"}),(0,c.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,c.jsx)("span",{className:"text-[10px] uppercase text-slate-400 font-semibold pl-1",children:"To"}),(0,c.jsx)("input",{type:"date",value:n||"",onChange:i,className:"w-full text-xs bg-white border border-slate-200 rounded px-2 py-1.5 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"})]})]})]})}function pe(e){let{filters:t,setFilters:a,attributeDefs:s,loadingAttributes:l}=e;const n=(e,t)=>{a((a=>{const s=Array.isArray(a.attributes)?[...a.attributes]:[];return s[e]=(0,m.A)((0,m.A)({},s[e]),t),(0,m.A)((0,m.A)({},a),{},{attributes:s})}))};return(0,c.jsxs)("div",{className:"flex flex-col h-full animate-in fade-in zoom-in-95 duration-200",children:[(0,c.jsxs)("div",{className:"flex-none mb-4",children:[(0,c.jsx)("h3",{className:"text-sm font-medium text-slate-900 mb-1",children:"Custom Attributes"}),(0,c.jsx)("p",{className:"text-xs text-slate-500",children:"Construct advanced queries based on custom fields."})]}),(0,c.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:l?(0,c.jsxs)("div",{className:"py-8 text-center text-xs text-slate-500",children:[(0,c.jsx)(te.A,{className:"h-4 w-4 mx-auto mb-2 animate-spin text-slate-400"}),"Loading definitions..."]}):0===s.length?(0,c.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center text-slate-500 bg-slate-50 rounded-lg border border-dashed border-slate-200",children:[(0,c.jsx)(X,{className:"h-8 w-8 text-slate-300 mb-2"}),(0,c.jsx)("p",{className:"text-xs",children:"No attribute definitions found."}),(0,c.jsx)("p",{className:"text-[10px] mt-1 text-slate-400",children:"Create custom fields in CRM settings first."})]}):(0,c.jsxs)("div",{className:"space-y-3",children:[(t.attributes||[]).map(((e,l)=>(0,c.jsxs)("div",{className:"group relative flex items-start gap-2 p-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-emerald-200 hover:shadow-md transition-all sm:items-center",children:[l>0&&(0,c.jsx)("div",{className:"absolute -top-5 left-8 px-1.5 py-0.5 bg-slate-100 text-[9px] font-bold text-slate-500 rounded border border-slate-200 z-10",children:"or"===e.join?"OR":"AND"}),(0,c.jsxs)("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-12 gap-2",children:[(0,c.jsx)("div",{className:"sm:col-span-5",children:(0,c.jsxs)("select",{value:e.fieldId||"",onChange:e=>n(l,{fieldId:e.target.value}),className:"w-full text-xs bg-slate-50 border-0 rounded-lg px-2 py-2 font-medium text-slate-700 focus:ring-1 focus:ring-emerald-500",children:[(0,c.jsx)("option",{value:"",disabled:!0,children:"Select Attribute..."}),s.map((e=>(0,c.jsx)("option",{value:e.id,children:e.label||e.key},e.id)))]})}),(0,c.jsx)("div",{className:"sm:col-span-3",children:(0,c.jsxs)("select",{value:e.op||"is",onChange:e=>n(l,{op:e.target.value}),className:"w-full text-xs bg-slate-50 border-0 rounded-lg px-2 py-2 text-slate-600 focus:ring-1 focus:ring-emerald-500 text-center",children:[(0,c.jsx)("option",{value:"is",children:"is exactly"}),(0,c.jsx)("option",{value:"contains",children:"contains"})]})}),(0,c.jsx)("div",{className:"sm:col-span-4",children:(0,c.jsx)("input",{value:e.value||"",onChange:e=>n(l,{value:e.target.value}),placeholder:"Enter value...",className:"w-full text-xs bg-white border border-slate-200 rounded-lg px-3 py-2 text-slate-900 placeholder:text-slate-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none"})})]}),(0,c.jsx)("button",{type:"button",onClick:()=>{return e=l,void a((t=>{const a=Array.isArray(t.attributes)?[...t.attributes]:[];return a.splice(e,1),(0,m.A)((0,m.A)({},t),{},{attributes:a})}));var e},className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:(0,c.jsx)(se.A,{className:"h-4 w-4"})}),l<(t.attributes||[]).length-1&&(0,c.jsxs)("select",{value:e.join||"and",onChange:e=>n(l,{join:e.target.value}),className:"absolute -bottom-3 right-4 h-6 text-[10px] font-bold uppercase bg-slate-50 border border-slate-200 rounded px-1 text-slate-500 focus:outline-none focus:border-emerald-500",children:[(0,c.jsx)("option",{value:"and",children:"AND"}),(0,c.jsx)("option",{value:"or",children:"OR"})]})]},l))),(0,c.jsxs)("button",{type:"button",onClick:()=>{a((e=>(0,m.A)((0,m.A)({},e),{},{attributes:[...Array.isArray(e.attributes)?e.attributes:[],{fieldId:"",op:"is",value:"",join:"and"}]})))},className:"flex items-center gap-2 px-3 py-2 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 rounded-lg border border-emerald-200 border-dashed w-full justify-center transition-colors",children:[(0,c.jsx)(d.A,{className:"h-3.5 w-3.5"}),"Add Condition"]})]})})]})}function ve(e){let{isOpen:t,initialFilters:a,onClose:l,onApply:n,onClear:r}=e;const[o,i]=(0,s.useState)(a||ce),[d,u]=(0,s.useState)("dates"),[x,p]=(0,s.useState)([]),[g,b]=(0,s.useState)(!1),[f,y]=(0,s.useState)([]),[j,N]=(0,s.useState)(!1),[w,S]=(0,s.useState)("");s.useEffect((()=>{t&&(i(a||ce),S(""),u("dates"))}),[t,a]),s.useEffect((()=>{t&&(async()=>{b(!0);try{const e=await async function(){try{const e=re(await v.default.get("/tags"));if(e.length>0)return e}catch(e){}return re(await v.default.get("/tags/get-tags"))}();p(e)}catch(e){h.oR.error("Failed to load tags."),p([])}finally{b(!1)}})()}),[t]),s.useEffect((()=>{t&&(async()=>{N(!0);try{const e=await(0,E.cC)({entityType:"Contact"});y(Array.isArray(e)?e:[])}catch(e){y([])}finally{N(!1)}})()}),[t]);const C=(e,t)=>{i((a=>(0,m.A)((0,m.A)({},a),{},{[e]:t})))},A=(e,t)=>{const{from:a,to:s}=function(e){const t=new Date;if("24h"===e){const e=new Date(t);return e.setHours(e.getHours()-24),{from:e,to:t}}if("week"===e){const e=new Date(t);return e.setDate(e.getDate()-7),{from:e,to:t}}if("month"===e){const e=new Date(t);return e.setMonth(e.getMonth()-1),{from:e,to:t}}return"today"===e?{from:oe(t),to:ie(t)}:{from:null,to:null}}(t),l="lastSeen"===e?"lastSeen":"created";i((e=>(0,m.A)((0,m.A)({},e),{},{["".concat(l,"Preset")]:t,["".concat(l,"From")]:de(a),["".concat(l,"To")]:de(s)})))};if(!t)return null;const k=e=>{let t=0;var a,s;("status"===e&&(o.optedIn&&"all"!==o.optedIn&&t++,o.incomingBlocked&&"all"!==o.incomingBlocked&&t++),"tags"===e)&&((null===(a=o.tagIds)||void 0===a?void 0:a.length)>0&&(t+=o.tagIds.length));("dates"===e&&((o.lastSeenFrom||o.lastSeenTo)&&t++,(o.createdFrom||o.createdTo)&&t++),"attributes"===e)&&((null===(s=o.attributes)||void 0===s?void 0:s.length)>0&&(t+=o.attributes.length));return t},I=k("status")+k("tags")+k("dates")+k("attributes");return(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 sm:p-6",onMouseDown:l,children:(0,c.jsxs)("div",{className:"w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[600px] max-h-[90vh]",onMouseDown:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"flex-none px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-white",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)("div",{className:"h-10 w-10 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center border border-emerald-100",children:(0,c.jsx)(le.A,{className:"h-5 w-5"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Filters"}),(0,c.jsx)("p",{className:"text-xs text-slate-500",children:"Refine your contact list with advanced conditions."})]})]}),(0,c.jsx)("button",{onClick:l,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-lg transition-colors",children:(0,c.jsx)(se.A,{className:"h-5 w-5"})})]}),(0,c.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,c.jsx)("div",{className:"w-56 bg-slate-50 border-r border-slate-100 p-3 flex flex-col gap-1 overflow-y-auto",children:ue.map((e=>{const t=d===e.id,a=k(e.id),s=e.icon;return(0,c.jsxs)("button",{onClick:()=>u(e.id),className:"flex items-center justify-between px-3 py-2.5 rounded-lg text-xs font-medium transition-all group ".concat(t?"bg-white text-emerald-700 shadow-sm ring-1 ring-slate-200":"text-slate-600 hover:bg-slate-100 hover:text-slate-900"),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)(s,{className:"h-4 w-4 ".concat(t?"text-emerald-500":"text-slate-400 group-hover:text-slate-500")}),e.label]}),a>0&&(0,c.jsx)("span",{className:"flex items-center justify-center h-5 min-w-[20px] px-1 rounded-full bg-emerald-100 text-emerald-700 text-[10px] font-bold",children:a})]},e.id)}))}),(0,c.jsxs)("div",{className:"flex-1 p-6 bg-white overflow-y-auto relative",children:["status"===d&&(0,c.jsx)(me,{filters:o,setField:C}),"tags"===d&&(0,c.jsx)(xe,{filters:o,setField:C,tags:x,loadingTags:g,tagQuery:w,setTagQuery:S,toggleTag:e=>{i((t=>{const a=Array.isArray(t.tagIds)?t.tagIds:[],s=String(e),l=a.includes(s)?a.filter((e=>e!==s)):[...a,s];return(0,m.A)((0,m.A)({},t),{},{tagIds:l})}))}}),"dates"===d&&(0,c.jsxs)("div",{className:"space-y-8 animate-in fade-in zoom-in-95 duration-200",children:[(0,c.jsx)(he,{title:"Last Seen",presetKey:o.lastSeenPreset,presets:[{key:"24h",label:"Last 24h"},{key:"week",label:"Last 7 Days"},{key:"month",label:"Last 30 Days"}],onPreset:e=>A("lastSeen",e),from:o.lastSeenFrom,to:o.lastSeenTo,onFrom:e=>{C("lastSeenPreset",""),C("lastSeenFrom",e.target.value)},onTo:e=>{C("lastSeenPreset",""),C("lastSeenTo",e.target.value)}}),(0,c.jsx)("div",{className:"h-px bg-slate-100"}),(0,c.jsx)(he,{title:"Created Date",presetKey:o.createdPreset,presets:[{key:"today",label:"Today"},{key:"week",label:"Last 7 Days"},{key:"month",label:"Last 30 Days"}],onPreset:e=>A("created",e),from:o.createdFrom,to:o.createdTo,onFrom:e=>{C("createdPreset",""),C("createdFrom",e.target.value)},onTo:e=>{C("createdPreset",""),C("createdTo",e.target.value)}})]}),"attributes"===d&&(0,c.jsx)(pe,{filters:o,setFilters:i,attributeDefs:f,loadingAttributes:j})]})]}),(0,c.jsxs)("div",{className:"flex-none px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center gap-4",children:[(0,c.jsxs)("button",{onClick:()=>{i(ce),S(""),null===r||void 0===r||r()},disabled:0===I,className:"group flex items-center gap-2 text-xs font-semibold text-slate-500 hover:text-red-600 disabled:opacity-50 disabled:hover:text-slate-500 transition-colors",children:[(0,c.jsx)(ne.A,{className:"h-4 w-4 group-hover:text-red-600 transition-colors"}),"Reset All"]}),I>0&&(0,c.jsxs)("span",{className:"text-xs text-slate-400",children:[I," filter",1!==I?"s":""," active"]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)("button",{onClick:l,className:"px-4 py-2 text-xs font-semibold text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors shadow-sm",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{null===n||void 0===n||n(o),null===l||void 0===l||l()},className:"px-6 py-2 text-xs font-semibold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 shadow-sm shadow-emerald-200 hover:shadow-emerald-300 transition-all active:scale-[0.98]",children:"Apply Filters"})]})]})]})})}function ge(){const[e,t]=(0,s.useState)(!1),[a,n]=(0,s.useState)(null),[r,o]=(0,s.useState)(0),[i,d]=(0,s.useState)("all"),[m,x]=(0,s.useState)(""),[h,p]=(0,s.useState)([]),[v,g]=(0,s.useState)(1),[b,f]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),[S,C]=(0,s.useState)(ce),A=()=>{o((e=>e+1))};return(0,c.jsx)("div",{className:"min-h-[calc(100vh-80px)] bg-[#f5f6f7]",children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-5 sm:px-6 pt-6 pb-8",children:[(0,c.jsx)("div",{className:"mb-5",children:(0,c.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,c.jsxs)("div",{className:"flex items-start gap-3",children:[(0,c.jsx)("div",{className:"hidden sm:flex h-12 w-12 items-center justify-center rounded-2xl bg-white border border-emerald-200/60 shadow-sm",children:(0,c.jsx)("div",{className:"h-10 w-10 rounded-2xl bg-emerald-100 flex items-center justify-center",children:(0,c.jsx)(l.A,{className:"h-5 w-5 text-emerald-800"})})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"mt-1.5 text-xl font-semibold text-slate-900",children:"Contacts"}),(0,c.jsx)("p",{className:"mt-1 text-sm text-slate-600 max-w-2xl",children:"Organize leads, segment customers, and run bulk actions."}),(0,c.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,c.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-emerald-50 text-emerald-800 border border-emerald-200/60",children:[(0,c.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-600"}),"Active tab: ",i]}),(0,c.jsxs)("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-white text-slate-700 border border-slate-200",children:["Selected: ",h.length]})]})]})]})})}),(0,c.jsxs)("div",{className:"bg-white/90 backdrop-blur rounded-2xl border border-slate-100 shadow-sm overflow-hidden",children:[(0,c.jsxs)("div",{className:"bg-white",children:[(0,c.jsx)("div",{className:"border-b border-slate-100",children:(0,c.jsx)(u,{onAddClick:()=>{n(null),t(!0)},onSearchChange:x,activeTab:i,onTabChange:e=>{d(e),g(1),p([])},searchTerm:m,onFilterClick:()=>w(!0),onImportClick:()=>{b||j(!0)},importing:b,onDownloadSample:()=>{const e=e=>{const t=String(null!==e&&void 0!==e?e:"").trim();if(!t)return"";return/^[+]?\d{10,15}$/.test(t)?"'".concat(t):t},t=[["Rahul Sharma",e("9876543210"),"rahul@example.com","Facebook","Interested in pricing, follow up next week"],["Ananya Gupta",e("+919123456789"),"ananya.gupta@example.com","Website Form","Requested onboarding details"],["Vikram Singh",e("9988776655"),"vikram.singh@example.com","Referral","Met at trade show"]],a=e=>{const t=String(null!==e&&void 0!==e?e:"");return/[",\n]/.test(t)?'"'.concat(t.replace(/"/g,'""'),'"'):t},s=[["Name","PhoneNumber","Email","LeadSource","Notes"],...t].map((e=>e.map(a).join(","))).join("\r\n"),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(l),r=document.createElement("a");r.href=n,r.download="xbytechat_contacts_sample.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}})}),h.length>0&&(0,c.jsx)("div",{className:"border-b border-slate-100 bg-emerald-50/50",children:(0,c.jsx)(U,{selectedIds:h,onClearSelection:()=>{p([])},onRefresh:A})})]}),(0,c.jsx)("div",{className:"bg-white",children:(0,c.jsx)("div",{children:(0,c.jsx)(P,{onEdit:e=>{n(e),t(!0)},refreshTrigger:r,activeTab:i,onSelectionChange:e=>{p(e||[])},selectedIds:h,searchTerm:m,filters:S,currentPage:v,setCurrentPage:g})})})]}),(0,c.jsx)(ve,{isOpen:N,initialFilters:S,onClose:()=>w(!1),onApply:e=>{C(e||ce),g(1),p([]),o((e=>e+1))},onClear:()=>{C(ce),g(1),p([]),o((e=>e+1))}}),(0,c.jsx)(W,{isOpen:e,onClose:()=>{t(!1),n(null)},contact:a,onSaveComplete:()=>{o((e=>e+1))}}),(0,c.jsx)(Y,{isOpen:y,onClose:()=>{j(!1)},onRefresh:A,onImportingChange:f})]})})}},86204:(e,t,a)=>{a.d(t,{GW:()=>b,JH:()=>x,Nv:()=>i,Wd:()=>v,cC:()=>m,cp:()=>h,jB:()=>g,uT:()=>p});var s=a(35870);const l="Contact",n=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];for(const s of t)if(void 0!==s&&null!==s)return s;return null},r=e=>String(e||"").trim(),o=e=>r(e)||l,i=e=>({options:Array.isArray(e)?e.map((e=>r(e))).filter((e=>e.length>0)):[]}),d=e=>{var t;const a=n(null===e||void 0===e?void 0:e.optionsJson,null===e||void 0===e?void 0:e.OptionsJson),s=(e=>{if(!e)return[];try{var t,a,s,l;const n="string"===typeof e?JSON.parse(e):e,o=null!==(t=null!==(a=null!==(s=null!==(l=null===n||void 0===n?void 0:n.options)&&void 0!==l?l:null===n||void 0===n?void 0:n.Options)&&void 0!==s?s:null===n||void 0===n?void 0:n.values)&&void 0!==a?a:null===n||void 0===n?void 0:n.Values)&&void 0!==t?t:n;return Array.isArray(o)?o.map((e=>r(e))).filter((e=>e.length>0)):[]}catch(n){return[]}})(null!==(t=null!==a&&void 0!==a?a:null===e||void 0===e?void 0:e.options)&&void 0!==t?t:null===e||void 0===e?void 0:e.Options);return{id:n(null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.fieldId,null===e||void 0===e?void 0:e.FieldId,null===e||void 0===e?void 0:e.definitionId,null===e||void 0===e?void 0:e.DefinitionId,null===e||void 0===e?void 0:e.customFieldDefinitionId),entityType:n(null===e||void 0===e?void 0:e.entityType,null===e||void 0===e?void 0:e.EntityType,l),key:n(null===e||void 0===e?void 0:e.key,null===e||void 0===e?void 0:e.Key,""),label:n(null===e||void 0===e?void 0:e.label,null===e||void 0===e?void 0:e.Label,""),dataType:n(null===e||void 0===e?void 0:e.dataType,null===e||void 0===e?void 0:e.DataType,""),options:s,isRequired:Boolean(n(null===e||void 0===e?void 0:e.isRequired,null===e||void 0===e?void 0:e.IsRequired,!1)),isActive:!1!==n(null===e||void 0===e?void 0:e.isActive,null===e||void 0===e?void 0:e.IsActive,!0),sortOrder:Number(n(null===e||void 0===e?void 0:e.sortOrder,null===e||void 0===e?void 0:e.SortOrder,0))||0}},c=e=>(Array.isArray(e)?e:[]).map(d).sort(((e,t)=>e.sortOrder!==t.sortOrder?e.sortOrder-t.sortOrder:e.label.localeCompare(t.label))),u=e=>{var t,a,s,l,r,o,i,d,u,m,x,h;const p=null!==(t=null!==(a=null===e||void 0===e?void 0:e.data)&&void 0!==a?a:e)&&void 0!==t?t:{},v=null!==(s=null!==(l=null!==(r=null!==(o=null!==(i=null!==(d=p.definitions)&&void 0!==d?d:p.Definitions)&&void 0!==i?i:p.schema)&&void 0!==o?o:p.Schema)&&void 0!==r?r:p.fields)&&void 0!==l?l:p.Fields)&&void 0!==s?s:[],g=null!==(u=null!==(m=null!==(x=null!==(h=p.values)&&void 0!==h?h:p.Values)&&void 0!==x?x:p.fieldValues)&&void 0!==m?m:p.FieldValues)&&void 0!==u?u:[],b=c(v),f={};return Array.isArray(g)&&g.forEach((e=>{var t;const a=n(null===e||void 0===e?void 0:e.fieldId,null===e||void 0===e?void 0:e.FieldId,null===e||void 0===e?void 0:e.definitionId,null===e||void 0===e?void 0:e.DefinitionId);if(!a)return;const s=n(null===e||void 0===e?void 0:e.valueJson,null===e||void 0===e?void 0:e.ValueJson,null===e||void 0===e?void 0:e.json),l=(e=>{if(void 0===e||null===e||""===e)return null;if("string"!==typeof e)return e&&"object"===typeof e&&"value"in e?e.value:e;try{const t=JSON.parse(e);return t&&"object"===typeof t&&"value"in t?t.value:t}catch(t){return e}})(null!==(t=null!==s&&void 0!==s?s:null===e||void 0===e?void 0:e.value)&&void 0!==t?t:null===e||void 0===e?void 0:e.Value);f[a]=l})),{definitions:b,valuesMap:f}},m=async function(){var e,t,a;let{entityType:n=l,includeInactive:r=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=o(n),d=await s.default.get("/customfields/definitions",{params:{entityType:i,includeInactive:r}}),u=null!==(e=null!==(t=null===d||void 0===d||null===(a=d.data)||void 0===a?void 0:a.data)&&void 0!==t?t:null===d||void 0===d?void 0:d.data)&&void 0!==e?e:[];return c(u)},x=async e=>s.default.post("/customfields/definitions",e),h=async(e,t)=>s.default.put("/customfields/definitions/".concat(e),t),p=async e=>s.default.delete("/customfields/definitions/".concat(e)),v=async function(){let{entityType:e=l,entityId:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=o(e),n=await s.default.get("/customfields/schema-with-values",{params:{entityType:a,entityId:t}});return u(null===n||void 0===n?void 0:n.data)},g=async e=>s.default.put("/customfields/values",e),b=["Text","Number","Date","Boolean","SingleSelect","MultiSelect"]}}]);
//# sourceMappingURL=953.c505d9ff.chunk.js.map