"use strict";(self.webpackChunkxbytechat_ui=self.webpackChunkxbytechat_ui||[]).push([[498],{15498:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var a=n(73216),l=n(65043),s=n(89379),o=n(57488),c=n(35870),i=n(70579);const r={title:"",content:"",createdBy:"",source:"CRM",isPinned:!1,isInternal:!1};const d=function(e){let{contactId:t,selectedNote:n,onSaveComplete:a}=e;const[d,u]=(0,l.useState)(r),[x,h]=(0,l.useState)(!1);(0,l.useEffect)((()=>{var e,t,a,l;null!==n&&void 0!==n&&n.id?u({title:null!==(e=n.title)&&void 0!==e?e:"",content:null!==(t=n.content)&&void 0!==t?t:"",createdBy:null!==(a=n.createdBy)&&void 0!==a?a:"",source:null!==(l=n.source)&&void 0!==l?l:"CRM",isPinned:!!n.isPinned,isInternal:!!n.isInternal}):u(r)}),[n]);const p=e=>{const{name:t,value:n,type:a,checked:l}=e.target;u((e=>(0,s.A)((0,s.A)({},e),{},{[t]:"checkbox"===a?l:n})))};return(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t){h(!0);try{const e=(0,s.A)((0,s.A)({},d),{},{contactId:t});null!==n&&void 0!==n&&n.id?(await c.default.put("/notes/".concat(n.id),e),o.oR.info("\ud83d\udcdd Note updated.")):(await c.default.post("/notes",e),o.oR.success("\u2705 Note added.")),null===a||void 0===a||a()}catch(r){var l,i;console.error("\u274c Failed to save note:",r),o.oR.error((null===r||void 0===r||null===(l=r.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.message)||"Failed to save note.")}finally{h(!1)}}else o.oR.error("ContactId missing. Open notes from a contact.")},className:"space-y-3",children:[(0,i.jsx)("input",{name:"title",value:d.title,onChange:p,placeholder:"Note Title",className:"w-full border rounded-lg px-3 py-2"}),(0,i.jsx)("textarea",{name:"content",value:d.content,onChange:p,placeholder:"Write your note here.",rows:5,className:"w-full border rounded-lg px-3 py-2"}),(0,i.jsx)("input",{name:"createdBy",value:d.createdBy,onChange:p,placeholder:"Created by (optional)",className:"w-full border rounded-lg px-3 py-2"}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",name:"isPinned",checked:d.isPinned,onChange:p,className:"mr-2"}),"Pin Note"]}),(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",name:"isInternal",checked:d.isInternal,onChange:p,className:"mr-2"}),"Internal Only"]})]}),(0,i.jsx)("button",{type:"submit",disabled:x,className:"bg-purple-600 hover:bg-purple-700 disabled:opacity-60 text-white px-4 py-2 rounded-lg",children:x?"Saving...":n?"Update Note":"Add Note"})]})};const u=function(e){let{contactId:t,onEdit:n,refreshKey:a}=e;const[s,r]=(0,l.useState)([]),[d,u]=(0,l.useState)(!1),x=(0,l.useCallback)((async()=>{if(t){u(!0);try{var e,n;const a=await c.default.get("/notes/contact/".concat(t)),l=null!==(e=null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.data)&&void 0!==e?e:[];r(Array.isArray(l)?l:[])}catch(a){console.error("\u274c Failed to fetch notes:",a),o.oR.error("Failed to load notes."),r([])}finally{u(!1)}}}),[t]);return(0,l.useEffect)((()=>{x()}),[x,a]),t?(0,i.jsxs)("div",{className:"grid gap-4",children:[d&&(0,i.jsx)("div",{className:"text-gray-500 text-center py-6",children:"Loading notes\u2026"}),!d&&0===s.length&&(0,i.jsx)("div",{className:"text-gray-500 text-center py-6",children:"No notes found for this contact."}),s.map((e=>(0,i.jsxs)("div",{className:"border p-4 rounded-xl shadow-sm relative bg-white hover:shadow-md transition-all ".concat(e.isPinned?"border-purple-500":"border-gray-200"),children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("h3",{className:"font-semibold text-lg text-purple-700 flex gap-2 items-center",children:[e.title||"Untitled",e.isPinned&&(0,i.jsx)("span",{title:"Pinned",className:"text-purple-500",children:"\ud83d\udccc"}),e.isInternal&&(0,i.jsx)("span",{title:"Internal Note",className:"text-gray-400",children:"\ud83d\udd12"})]}),(0,i.jsxs)("div",{className:"flex gap-2 text-sm",children:[(0,i.jsx)("button",{onClick:()=>null===n||void 0===n?void 0:n(e),className:"text-blue-600 hover:underline",children:"Edit"}),(0,i.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Delete this note?"))try{await c.default.delete("/notes/".concat(e)),o.oR.info("\ud83d\uddd1\ufe0f Note deleted."),x()}catch(t){console.error("\u274c Failed to delete note:",t),o.oR.error("Failed to delete note.")}})(e.id),className:"text-red-500 hover:underline",children:"Delete"})]})]}),(0,i.jsx)("p",{className:"text-sm text-gray-800 mt-2 whitespace-pre-line",children:e.content}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["Created by ",(0,i.jsx)("b",{children:e.createdBy||"\u2014"})," \xb7"," ",e.createdAt?new Date(e.createdAt).toLocaleString():"\u2014"]})]},e.id)))]}):(0,i.jsx)("div",{className:"text-gray-500 text-center py-6",children:"Open a contact to view notes."})};const x=function(e){let{contactId:t}=e;const[n,a]=(0,l.useState)(null),[s,o]=(0,l.useState)(!1),[c,r]=(0,l.useState)(0);return(0,i.jsxs)("div",{className:"p-4 relative bg-[#f5f6f7] min-h-[calc(100vh-80px)]",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold text-purple-700",children:"\ud83d\udcdd Notes"}),(0,i.jsx)("button",{onClick:()=>{a(null),o(!0)},className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow",children:"\u2795 Add Note"})]}),(0,i.jsx)(u,{contactId:t,onEdit:e=>{a(e),o(!0)},refreshKey:c}),s&&(0,i.jsxs)("div",{className:"fixed top-0 right-0 w-full max-w-md h-full bg-white shadow-2xl z-50 transition-transform duration-300 border-l overflow-y-auto",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,i.jsx)("h2",{className:"text-lg font-bold",children:n?"Edit Note":"Add Note"}),(0,i.jsx)("button",{onClick:()=>o(!1),className:"text-gray-500 text-xl",children:"\xd7"})]}),(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(d,{contactId:t,selectedNote:n,onSaveComplete:()=>{a(null),o(!1),r((e=>e+1))}})})]})]})};const h=function(){const{contactId:e}=(0,a.g)();return(0,i.jsx)(x,{contactId:e})}}}]);
//# sourceMappingURL=498.14de533b.chunk.js.map