{"version":3,"file":"static/js/953.c505d9ff.chunk.js","mappings":"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","sources":["pages/CRM/Contacts/components/ContactsTopBar.jsx","pages/CRM/Contacts/components/checkbox.jsx","pages/CRM/Contacts/components/dropdown-menu.jsx","pages/CRM/Contacts/components/ContactTagModal.jsx","pages/CRM/Contacts/components/ContactsTable.jsx","pages/CRM/Tags/TagSelector.jsx","pages/CustomFields/CustomFieldsEditor.jsx","pages/CRM/Contacts/components/ContactFormModal.jsx","pages/CRM/Contacts/components/BulkActionsBar.jsx","pages/CRM/Contacts/CsvUploadModal.jsx","../node_modules/lucide-react/src/icons/hash.ts","pages/CRM/Contacts/components/ContactsFilterModal.jsx","pages/CRM/Contacts/Contacts.jsx","pages/CustomFields/customFieldsApi.js"],"sourcesContent":["import { Download, Search, Plus, SlidersHorizontal, Upload } from \"lucide-react\";\r\n\r\nexport default function ContactsTopBar({\r\n  onAddClick,\r\n  onSearchChange,\r\n  activeTab,\r\n  onTabChange,\r\n  searchTerm,\r\n  onFilterClick,\r\n  onImportClick,\r\n  onDownloadSample,\r\n  importing = false,\r\n  activeFiltersCount = 0,\r\n}) {\r\n  const tabs = [\r\n    { key: \"all\", label: \"All\" },\r\n    { key: \"favourites\", label: \"Favourites\" },\r\n    { key: \"archived\", label: \"Archived\" },\r\n    { key: \"groups\", label: \"Groups\" },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-3 px-4 py-3\">\r\n      <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3\">\r\n        <div className=\"relative flex-1 max-w-xl\">\r\n          <Search\r\n            size={16}\r\n            className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\"\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search by name, phone, or email\"\r\n            value={searchTerm}\r\n            onChange={e => onSearchChange?.(e.target.value)}\r\n            className=\"w-full rounded-lg border border-slate-200 bg-white pl-9 pr-3 py-2 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-200\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2 justify-end\">\r\n          <button\r\n            onClick={onFilterClick}\r\n            className={`inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border transition-all ${\r\n              activeFiltersCount > 0\r\n                ? 'bg-emerald-50 border-emerald-300 text-emerald-900 hover:bg-emerald-100'\r\n                : 'border-slate-200 text-slate-700 hover:bg-slate-50'\r\n            }`}\r\n          >\r\n            <SlidersHorizontal size={16} /> \r\n            Filters\r\n            {activeFiltersCount > 0 && (\r\n              <span className=\"inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded-full bg-emerald-600 text-white text-[11px] font-bold\">\r\n                {activeFiltersCount}\r\n              </span>\r\n            )}\r\n          </button>\r\n          <button\r\n            onClick={onDownloadSample}\r\n            className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border border-slate-200 text-slate-700 hover:bg-slate-50\"\r\n          >\r\n            <Download size={16} /> Download Sample CSV\r\n          </button>\r\n          <button\r\n            onClick={onImportClick}\r\n            disabled={importing}\r\n            className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm border border-slate-200 text-slate-700 hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed\"\r\n          >\r\n            <Upload size={16} /> {importing ? \"Importing...\" : \"Import CSV\"}\r\n          </button>\r\n          <button\r\n            onClick={onAddClick}\r\n            className=\"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm bg-emerald-600 hover:bg-emerald-700 text-white shadow-sm\"\r\n          >\r\n            <Plus size={16} /> Add contact\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-wrap gap-2 text-sm font-medium\">\r\n        {tabs.map(tab => {\r\n          const isActive = activeTab === tab.key;\r\n          return (\r\n            <button\r\n              key={tab.key}\r\n              onClick={() => onTabChange?.(tab.key)}\r\n              className={`px-3 py-1.5 rounded-full border transition-colors ${\r\n                isActive\r\n                  ? \"bg-emerald-50 border-emerald-200 text-emerald-900\"\r\n                  : \"bg-white border-slate-200 text-slate-600 hover:bg-slate-50\"\r\n              }`}\r\n            >\r\n              {tab.label}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","//  File: src/pages/Contacts/components/checkbox.jsx\r\n\r\nimport React from \"react\";\r\n\r\nexport const Checkbox = React.forwardRef(\r\n  ({ className = \"\", checked, onCheckedChange, ...props }, ref) => {\r\n    return (\r\n      <input\r\n        type=\"checkbox\"\r\n        ref={ref}\r\n        checked={checked}\r\n        className={`w-4 h-4 text-emerald-600 border-slate-300 rounded focus:ring-emerald-500 ${className}`}\r\n        {...props}\r\n        onChange={e => onCheckedChange?.(e.target.checked)}\r\n      />\r\n    );\r\n  }\r\n);\r\n\r\nCheckbox.displayName = \"Checkbox\";\r\n","//  File: src/pages/Contacts/components/dropdown-menu.jsx\r\nimport {\r\n  Menu,\r\n  MenuButton,\r\n  MenuItems,\r\n  MenuItem,\r\n  Transition,\r\n} from \"@headlessui/react\";\r\nimport { Fragment } from \"react\";\r\n\r\nexport function DropdownMenu({ children }) {\r\n  return (\r\n    <Menu as=\"div\" className=\"relative inline-block text-left\">\r\n      {children}\r\n    </Menu>\r\n  );\r\n}\r\n\r\nexport const DropdownMenuTrigger = ({ asChild, children }) => (\r\n  <MenuButton as={Fragment}>{children}</MenuButton>\r\n);\r\n\r\nexport const DropdownMenuContent = ({ children, className = \"\" }) => (\n  <Transition\n    as={Fragment}\n    enter=\"transition ease-out duration-100\"\n    enterFrom=\"transform opacity-0 scale-95\"\n    enterTo=\"transform opacity-100 scale-100\"\n    leave=\"transition ease-in duration-75\"\n    leaveFrom=\"transform opacity-100 scale-100\"\n    leaveTo=\"transform opacity-0 scale-95\"\n  >\n    <MenuItems\n      className={`absolute right-0 z-10 mt-2 w-48 origin-top-right overflow-hidden rounded-lg border border-slate-200 bg-white shadow-lg focus:outline-none ${className}`}\n    >\n      {children}\n    </MenuItems>\n  </Transition>\n);\n\nexport const DropdownMenuItem = ({ children, onClick, className = \"\" }) => (\n  <MenuItem>\n    {({ active }) => (\n      <button\n        onClick={onClick}\n        className={`${\n          active ? \"bg-slate-50\" : \"\"\n        } w-full px-4 py-2 text-left text-sm text-slate-700 ${className}`}\n      >\n        {children}\n      </button>\n    )}\n  </MenuItem>\n);\n\r\n// //  File: src/pages/Contacts/components/dropdown-menu.jsx\r\n// import {\r\n//   Menu,\r\n//   MenuButton,\r\n//   MenuItems,\r\n//   MenuItem,\r\n//   Transition,\r\n// } from \"@headlessui/react\";\r\n// import { Fragment } from \"react\";\r\n\r\n// export function DropdownMenu({ children }) {\r\n//   return (\r\n//     <Menu as=\"div\" className=\"relative inline-block text-left\">\r\n//       {children}\r\n//     </Menu>\r\n//   );\r\n// }\r\n\r\n// export const DropdownMenuTrigger = ({ asChild, children }) => (\r\n//   <MenuButton as={Fragment}>{children}</MenuButton>\r\n// );\r\n\r\n// export const DropdownMenuContent = ({ children, className = \"\" }) => (\r\n//   <Transition\r\n//     as={Fragment}\r\n//     enter=\"transition ease-out duration-100\"\r\n//     enterFrom=\"transform opacity-0 scale-95\"\r\n//     enterTo=\"transform opacity-100 scale-100\"\r\n//     leave=\"transition ease-in duration-75\"\r\n//     leaveFrom=\"transform opacity-100 scale-100\"\r\n//     leaveTo=\"transform opacity-0 scale-95\"\r\n//   >\r\n//     <MenuItems\r\n//       className={`absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none ${className}`}\r\n//     >\r\n//       {children}\r\n//     </MenuItems>\r\n//   </Transition>\r\n// );\r\n\r\n// export const DropdownMenuItem = ({ children, onClick, className = \"\" }) => (\r\n//   <MenuItem>\r\n//     {({ active }) => (\r\n//       <button\r\n//         onClick={onClick}\r\n//         className={`${\r\n//           active ? \"bg-gray-100\" : \"\"\r\n//         } w-full px-4 py-2 text-sm text-left ${className}`}\r\n//       >\r\n//         {children}\r\n//       </button>\r\n//     )}\r\n//   </MenuItem>\r\n// );\r\n","import React from \"react\";\nimport { toast } from \"react-toastify\";\n\nimport axiosClient from \"../../../../api/axiosClient\";\n\nfunction normalizeTagsResponse(res) {\n  const payload = res?.data?.data ?? res?.data;\n  return Array.isArray(payload) ? payload : [];\n}\n\nasync function fetchAllTags() {\n  try {\n    const res = await axiosClient.get(\"/tags\");\n    const tags = normalizeTagsResponse(res);\n    if (tags.length > 0) return tags;\n  } catch (_) {\n    // fallback below\n  }\n\n  const res = await axiosClient.get(\"/tags/get-tags\");\n  return normalizeTagsResponse(res);\n}\n\nfunction getContactTags(contact) {\n  return (\n    contact?.tags ||\n    contact?.contactTags ||\n    contact?.tagSummaries ||\n    contact?.tagList ||\n    []\n  );\n}\n\nexport default function ContactTagModal({\n  isOpen,\n  mode, // \"add\" | \"remove\"\n  contact,\n  onClose,\n  onUpdated,\n}) {\n  const [availableTags, setAvailableTags] = React.useState([]);\n  const [selectedTagId, setSelectedTagId] = React.useState(\"\");\n  const [loadingTags, setLoadingTags] = React.useState(false);\n  const [saving, setSaving] = React.useState(false);\n\n  const existingTags = React.useMemo(\n    () => getContactTags(contact),\n    [contact]\n  );\n\n  React.useEffect(() => {\n    if (!isOpen) return;\n\n    const load = async () => {\n      setLoadingTags(true);\n      try {\n        if (mode === \"remove\") {\n          const list = Array.isArray(existingTags) ? existingTags : [];\n          setAvailableTags(list);\n          const firstId = list?.[0]?.id ?? list?.[0]?.tagId ?? \"\";\n          setSelectedTagId(firstId ? String(firstId) : \"\");\n          return;\n        }\n\n        const all = await fetchAllTags();\n        const existingIds = new Set(\n          (existingTags || []).map(t => String(t?.id ?? t?.tagId)).filter(Boolean)\n        );\n        const filtered = (all || []).filter(t => !existingIds.has(String(t?.id)));\n        setAvailableTags(filtered);\n        setSelectedTagId(filtered?.[0]?.id ? String(filtered[0].id) : \"\");\n      } catch (error) {\n        toast.error(\"Failed to load tags.\");\n        setAvailableTags([]);\n        setSelectedTagId(\"\");\n      } finally {\n        setLoadingTags(false);\n      }\n    };\n\n    load();\n  }, [isOpen, mode, existingTags]);\n\n  const title = mode === \"remove\" ? \"Remove tag\" : \"Add tag\";\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!contact?.id) {\n      toast.error(\"No contact selected.\");\n      return;\n    }\n    if (!selectedTagId) {\n      toast.warn(\"Select a tag first.\");\n      return;\n    }\n    if (saving) return;\n\n    const tagId = Number.isFinite(Number(selectedTagId))\n      ? Number(selectedTagId)\n      : selectedTagId;\n\n    setSaving(true);\n    try {\n      if (mode === \"remove\") {\n        const body = { contactIds: [contact.id], tagId };\n\n        try {\n          await axiosClient.request({\n            url: \"/contacts/bulk-unassign-tag\",\n            method: \"DELETE\",\n            data: body,\n          });\n        } catch (err) {\n          const status = err?.response?.status;\n          if (status === 404 || status === 405) {\n            await axiosClient.post(\"/contacts/bulk-unassign-tag\", body);\n          } else {\n            throw err;\n          }\n        }\n\n        toast.success(\"Tag removed.\");\n      } else {\n        await axiosClient.post(\"/contacts/bulk-assign-tag\", {\n          contactIds: [contact.id],\n          tagId,\n        });\n        toast.success(\"Tag added.\");\n      }\n\n      onUpdated?.();\n      onClose?.();\n    } catch (error) {\n      toast.error(error?.response?.data?.message || \"Failed to update tag.\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const emptyText =\n    mode === \"remove\"\n      ? \"This contact has no tags to remove.\"\n      : \"No tags available to add. Create tags first.\";\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4\">\n      <div className=\"w-full max-w-sm overflow-hidden rounded-2xl bg-white shadow-xl ring-1 ring-black/5\">\n        <div className=\"border-b border-slate-100 px-5 py-4\">\n          <h2 className=\"text-sm font-semibold text-slate-900\">{title}</h2>\n          <p className=\"mt-1 text-xs text-slate-500\">\n            {contact?.name || \"Unnamed contact\"}\n          </p>\n        </div>\n\n        <div className=\"px-5 py-4\">\n          {loadingTags ? (\n            <p className=\"text-xs text-slate-500\">Loading tags...</p>\n          ) : availableTags.length === 0 ? (\n            <p className=\"text-xs text-slate-500\">{emptyText}</p>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"mb-1 block text-xs font-medium text-slate-600\">\n                  Select tag\n                </label>\n                <select\n                  className=\"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-200 disabled:opacity-60\"\n                  value={selectedTagId}\n                  onChange={e => setSelectedTagId(e.target.value)}\n                  disabled={saving}\n                >\n                  {availableTags.map(tag => {\n                    const id = tag?.id ?? tag?.tagId;\n                    const label = tag?.name ?? tag?.tagName ?? tag?.label ?? \"Tag\";\n                    return (\n                      <option key={String(id)} value={String(id)}>\n                        {label}\n                      </option>\n                    );\n                  })}\n                </select>\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-1\">\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  disabled={saving}\n                  className=\"rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-60 disabled:cursor-not-allowed\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={saving || !selectedTagId}\n                  className={`rounded-lg px-4 py-1.5 text-xs font-semibold text-white disabled:opacity-60 disabled:cursor-not-allowed ${\n                    mode === \"remove\"\n                      ? \"bg-rose-600 hover:bg-rose-700\"\n                      : \"bg-emerald-600 hover:bg-emerald-700\"\n                  }`}\n                >\n                  {saving ? \"Saving...\" : title}\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport { MoreVertical } from \"lucide-react\";\n\nimport axiosClient from \"../../../../api/axiosClient\";\nimport { Checkbox } from \"./checkbox\";\nimport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n} from \"./dropdown-menu\";\nimport ContactTagModal from \"./ContactTagModal\";\n\nfunction getInitials(name) {\n  if (!name) return \"\";\n  return name\n    .split(\" \")\n    .slice(0, 2)\n    .map(w => w[0])\n    .join(\" \")\n    .toUpperCase();\n}\n\nfunction getContactTags(contact) {\n  return (\n    contact.tags ||\n    contact.contactTags ||\n    contact.tagSummaries ||\n    contact.tagList ||\n    []\n  );\n}\n\nfunction parseDate(value) {\n  if (!value) return null;\n  const d = new Date(value);\n  if (Number.isNaN(d.getTime())) return null;\n  return d;\n}\n\nfunction dateRangeMatch(value, fromValue, toValue) {\n  const d = parseDate(value);\n  if (!d) return true;\n  const from = parseDate(fromValue);\n  const to = parseDate(toValue);\n  if (from && d < from) return false;\n  if (to) {\n    const end = new Date(to);\n    end.setHours(23, 59, 59, 999);\n    if (d > end) return false;\n  }\n  return true;\n}\n\nfunction matchesSearch(contact, q) {\n  const term = (q || \"\").trim().toLowerCase();\n  if (!term) return true;\n  const name = String(contact?.name || \"\").toLowerCase();\n  const email = String(contact?.email || \"\").toLowerCase();\n  const phone = String(contact?.phoneNumber || \"\").toLowerCase();\n  return name.includes(term) || email.includes(term) || phone.includes(term);\n}\n\nfunction coerceBool(value) {\n  if (value === true || value === false) return value;\n  if (typeof value === \"string\") {\n    const s = value.toLowerCase();\n    if (s === \"true\" || s === \"yes\") return true;\n    if (s === \"false\" || s === \"no\") return false;\n  }\n  return null;\n}\n\nfunction matchesStatus(contact, filters) {\n  const optedInFilter = filters?.optedIn;\n  if (optedInFilter === \"yes\" || optedInFilter === \"no\") {\n    const contactValue =\n      contact?.optedIn ?? contact?.isOptedIn ?? contact?.isOptIn;\n    const b = coerceBool(contactValue);\n    if (b !== null && b !== (optedInFilter === \"yes\")) return false;\n  }\n\n  const blockedFilter = filters?.incomingBlocked;\n  if (blockedFilter === \"yes\" || blockedFilter === \"no\") {\n    const contactValue =\n      contact?.incomingBlocked ??\n      contact?.isIncomingBlocked ??\n      contact?.isBlocked;\n    const b = coerceBool(contactValue);\n    if (b !== null && b !== (blockedFilter === \"yes\")) return false;\n  }\n\n  return true;\n}\n\nfunction matchesTagsClientSide(contact, filters) {\n  const filterTagIds = Array.isArray(filters?.tagIds)\n    ? filters.tagIds.map(String).filter(Boolean)\n    : [];\n  if (filterTagIds.length === 0) return true;\n\n  const tags = getContactTags(contact);\n  const contactIds = new Set(\n    (Array.isArray(tags) ? tags : [])\n      .map(t => String(t?.id ?? t?.tagId))\n      .filter(Boolean)\n  );\n\n  if (filters?.tagMatch === \"all\") {\n    return filterTagIds.every(id => contactIds.has(id));\n  }\n  return filterTagIds.some(id => contactIds.has(id));\n}\n\nfunction getComplianceBadges(contact) {\n  const optStatus = Number(contact?.optStatus);\n  const channelStatus = Number(contact?.channelStatus);\n  const badges = [];\n\n  if (optStatus === 2) {\n    badges.push({\n      key: \"opted-out\",\n      label: \"Opted out\",\n      className: \"border-amber-200 bg-amber-50 text-amber-700\",\n    });\n  }\n\n  if (channelStatus === 2) {\n    badges.push({\n      key: \"invalid\",\n      label: \"Invalid\",\n      className: \"border-rose-200 bg-rose-50 text-rose-700\",\n    });\n  } else if (channelStatus === 1) {\n    badges.push({\n      key: \"blocked\",\n      label: \"Blocked\",\n      className: \"border-orange-200 bg-orange-50 text-orange-700\",\n    });\n  }\n\n  return badges;\n}\n\nfunction applyLocalFilters(list, { searchTerm, filters }) {\n  const all = Array.isArray(list) ? list : [];\n\n  return all.filter(contact => {\n    const createdAt = contact?.createdAt ?? contact?.created_at;\n    const lastSeenAt =\n      contact?.lastSeenAt ?? contact?.last_seen_at ?? contact?.lastSeen;\n\n    return (\n      matchesSearch(contact, searchTerm) &&\n      dateRangeMatch(createdAt, filters?.createdFrom, filters?.createdTo) &&\n      dateRangeMatch(lastSeenAt, filters?.lastSeenFrom, filters?.lastSeenTo) &&\n      matchesStatus(contact, filters) &&\n      matchesTagsClientSide(contact, filters)\n    );\n  });\n}\n\nexport default function ContactsTable({\n  onEdit,\n  refreshTrigger,\n  activeTab,\n  onSelectionChange,\n  selectedIds = [],\n  searchTerm,\n  filters,\n  currentPage,\n  setCurrentPage,\n}) {\n  const [contacts, setContacts] = useState([]);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalCount, setTotalCount] = useState(0);\n  const [pageSize, setPageSize] = useState(20);\n  const [tagModalOpen, setTagModalOpen] = useState(false);\n  const [tagModalMode, setTagModalMode] = useState(\"add\");\n  const [tagModalContact, setTagModalContact] = useState(null);\n  const clientSideFetchLimit = 1000;\n  const navigate = useNavigate();\n\n  const fetchContacts = useCallback(async () => {\n    try {\n      const effectiveFilters = filters || {};\n      const filterTagIds = Array.isArray(effectiveFilters.tagIds)\n        ? effectiveFilters.tagIds.map(String).filter(Boolean)\n        : [];\n\n      // When tag filtering is requested, prefer the existing POST endpoint.\n      if (filterTagIds.length > 0) {\n        const res = await axiosClient.post(\"/contacts/filter-by-tags\", filterTagIds);\n        const payload = res.data?.data ?? res.data;\n        const filtered = applyLocalFilters(payload, {\n          searchTerm,\n          filters: effectiveFilters,\n        });\n\n        const total = Math.max(1, Math.ceil(filtered.length / pageSize));\n        const safePage = Math.min(Math.max(1, currentPage), total);\n        if (safePage !== currentPage) setCurrentPage(safePage);\n\n        const start = (safePage - 1) * pageSize;\n        const pageItems = filtered.slice(start, start + pageSize);\n\n        setContacts(pageItems);\n        setTotalPages(total);\n        setTotalCount(filtered.length);\n        return;\n      }\n\n      const hasAdvancedFilters =\n        !!effectiveFilters.createdFrom ||\n        !!effectiveFilters.createdTo ||\n        !!effectiveFilters.lastSeenFrom ||\n        !!effectiveFilters.lastSeenTo ||\n        (Array.isArray(effectiveFilters.attributes) &&\n          effectiveFilters.attributes.length > 0) ||\n        effectiveFilters.optedIn === \"yes\" ||\n        effectiveFilters.optedIn === \"no\" ||\n        effectiveFilters.incomingBlocked === \"yes\" ||\n        effectiveFilters.incomingBlocked === \"no\";\n\n      // If filters are active but backend may not support them yet, fetch a larger slice\n      // and apply filters client-side for a predictable UX.\n      if (hasAdvancedFilters) {\n        const advancedParams = {};\n        if (effectiveFilters.createdFrom)\n          advancedParams.createdFrom = effectiveFilters.createdFrom;\n        if (effectiveFilters.createdTo)\n          advancedParams.createdTo = effectiveFilters.createdTo;\n        if (effectiveFilters.lastSeenFrom)\n          advancedParams.lastSeenFrom = effectiveFilters.lastSeenFrom;\n        if (effectiveFilters.lastSeenTo)\n          advancedParams.lastSeenTo = effectiveFilters.lastSeenTo;\n        if (effectiveFilters.tagMatch)\n          advancedParams.tagMatch = effectiveFilters.tagMatch;\n        if (\n          Array.isArray(effectiveFilters.attributes) &&\n          effectiveFilters.attributes.length > 0\n        ) {\n          advancedParams.attributes = JSON.stringify(effectiveFilters.attributes);\n        }\n        if (effectiveFilters.optedIn === \"yes\") advancedParams.optedIn = true;\n        if (effectiveFilters.optedIn === \"no\") advancedParams.optedIn = false;\n        if (effectiveFilters.incomingBlocked === \"yes\")\n          advancedParams.incomingBlocked = true;\n        if (effectiveFilters.incomingBlocked === \"no\")\n          advancedParams.incomingBlocked = false;\n\n        const res = await axiosClient.get(\"/contacts/\", {\n          params: {\n            tab: activeTab,\n            search: searchTerm,\n            page: 1,\n            pageSize: clientSideFetchLimit,\n            ...advancedParams,\n          },\n        });\n\n        const result = res.data?.data ?? res.data;\n        const items = Array.isArray(result?.items)\n          ? result.items\n          : Array.isArray(result?.Items)\n          ? result.Items\n          : Array.isArray(result)\n          ? result\n          : [];\n\n        const filtered = applyLocalFilters(items, {\n          searchTerm,\n          filters: effectiveFilters,\n        });\n        const total = Math.max(1, Math.ceil(filtered.length / pageSize));\n        const safePage = Math.min(Math.max(1, currentPage), total);\n        if (safePage !== currentPage) setCurrentPage(safePage);\n\n        const start = (safePage - 1) * pageSize;\n        const pageItems = filtered.slice(start, start + pageSize);\n\n        setContacts(pageItems);\n        setTotalPages(total);\n        setTotalCount(filtered.length);\n        return;\n      }\n\n      const params = {\n        tab: activeTab,\n        search: searchTerm,\n        page: currentPage,\n        pageSize,\n      };\n\n      if (effectiveFilters.createdFrom) params.createdFrom = effectiveFilters.createdFrom;\n      if (effectiveFilters.createdTo) params.createdTo = effectiveFilters.createdTo;\n      if (effectiveFilters.lastSeenFrom) params.lastSeenFrom = effectiveFilters.lastSeenFrom;\n      if (effectiveFilters.lastSeenTo) params.lastSeenTo = effectiveFilters.lastSeenTo;\n      if (effectiveFilters.tagMatch) params.tagMatch = effectiveFilters.tagMatch;\n\n      if (effectiveFilters.optedIn === \"yes\") params.optedIn = true;\n      if (effectiveFilters.optedIn === \"no\") params.optedIn = false;\n      if (effectiveFilters.incomingBlocked === \"yes\") params.incomingBlocked = true;\n      if (effectiveFilters.incomingBlocked === \"no\") params.incomingBlocked = false;\n\n      const res = await axiosClient.get(\"/contacts/\", { params });\n\n      const result = res.data?.data ?? res.data;\n      const items = Array.isArray(result?.items)\n        ? result.items\n        : Array.isArray(result?.Items)\n        ? result.Items\n        : Array.isArray(result)\n        ? result\n        : [];\n\n      setContacts(items);\n\n      const totalCount =\n        result?.totalCount ?? result?.TotalCount ?? items.length;\n      const resolvedPageSize = result?.pageSize ?? result?.PageSize ?? pageSize;\n      const totalFromPayload = result?.totalPages ?? result?.TotalPages;\n      const total =\n        typeof totalFromPayload === \"number\" && totalFromPayload > 0\n          ? totalFromPayload\n          : Math.max(1, Math.ceil(totalCount / resolvedPageSize));\n\n      setTotalPages(total);\n      setTotalCount(totalCount);\n    } catch (err) {\n      const message =\n        err.response?.data?.message || \"Failed to load contacts.\";\n      toast.error(message);\n    }\n  }, [\n    activeTab,\n    searchTerm,\n    currentPage,\n    pageSize,\n    filters,\n    setCurrentPage,\n  ]);\n\n  useEffect(() => {\n    fetchContacts();\n  }, [refreshTrigger, activeTab, searchTerm, currentPage, fetchContacts]);\n\n  const handleSelectAll = checked => {\n    const pageIds = contacts\n      .map(c => c.id)\n      .filter(id => id !== undefined && id !== null);\n\n    if (checked) {\n      const merged = Array.from(new Set([...selectedIds, ...pageIds]));\n      onSelectionChange?.(merged);\n      return;\n    }\n\n    const remaining = selectedIds.filter(id => !pageIds.includes(id));\n    onSelectionChange?.(remaining);\n  };\n\n  const handleRowCheckbox = (checked, id) => {\n    const updated = checked\n      ? selectedIds.includes(id)\n        ? selectedIds\n        : [...selectedIds, id]\n      : selectedIds.filter(i => i !== id);\n    onSelectionChange?.(updated);\n  };\n\n  const handleDelete = async id => {\n    if (!window.confirm(\"Are you sure you want to delete this contact?\"))\n      return;\n    try {\n      await axiosClient.delete(`/contacts/${id}`);\n      toast.success(\"Contact deleted.\");\n      fetchContacts();\n    } catch (err) {\n      const message =\n        err.response?.data?.message || \"Failed to delete contact.\";\n      toast.error(message);\n    }\n  };\n\n  const openTagModal = (mode, contact) => {\n    setTagModalMode(mode);\n    setTagModalContact(contact);\n    setTagModalOpen(true);\n  };\n\n  const closeTagModal = () => {\n    setTagModalOpen(false);\n    setTagModalContact(null);\n  };\n\n  const rowPadding = \"py-2\";\n  const nameGap = \"gap-2\";\n  const avatarSize = \"h-7 w-7 text-[10px]\";\n\n  return (\n    <div className=\"overflow-x-auto\">\n      <table className=\"w-full text-sm text-slate-900\">\n        <thead className=\"bg-slate-50\">\n          <tr>\n            <th className={`px-4 ${rowPadding} text-center w-6 border-b border-slate-200`}>\n              <Checkbox\n                checked={\n                  contacts.length > 0 &&\n                  contacts.every(c => selectedIds.includes(c.id))\n                }\n                onCheckedChange={handleSelectAll}\n                className=\"w-4 h-4\"\n              />\n            </th>\n            <th className={`px-4 ${rowPadding} text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700`}>\n              Name\n            </th>\n            <th className={`px-4 ${rowPadding} text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700`}>\n              Phone\n            </th>\n            <th className={`px-4 ${rowPadding} text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden md:table-cell`}>\n              Email\n            </th>\n            <th className={`px-4 ${rowPadding} text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden lg:table-cell`}>\n              Tags\n            </th>\n            <th className={`px-4 ${rowPadding} text-left border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700 hidden lg:table-cell`}>\n              Created\n            </th>\n            <th className={`px-4 ${rowPadding} text-center w-8 border-b border-slate-200 text-xs font-semibold uppercase tracking-wide text-slate-700`}>\n              Actions\n            </th>\n          </tr>\n        </thead>\n        <tbody className=\"divide-y divide-slate-100\">\n          {contacts.length === 0 ? (\n            <tr>\n              <td\n                colSpan={7}\n                className=\"px-6 py-12 text-center text-slate-600\"\n              >\n                <p className=\"text-sm font-semibold text-slate-900\">\n                  No contacts found\n                </p>\n                <p className=\"mt-1 text-sm text-slate-700\">\n                  Try a different search or add a new contact.\n                </p>\n              </td>\n            </tr>\n          ) : (\n            contacts.map((contact, idx) => (\n              <tr key={contact.id} className={`hover:bg-emerald-50/30 transition-colors ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/40'}`}>\n                <td className={`px-4 ${rowPadding} text-center align-middle`}>\n                  <Checkbox\n                    checked={selectedIds.includes(contact.id)}\n                    onCheckedChange={checked =>\n                      handleRowCheckbox(checked, contact.id)\n                    }\n                    className=\"w-4 h-4\"\n                  />\n                </td>\n                <td className={`px-4 ${rowPadding}`}>\n                  <div className=\"flex items-center gap-2 min-w-0\">\n                    <span className=\"font-semibold truncate text-sm text-slate-900\">\n                      {contact.name || \"Unnamed contact\"}\n                    </span>\n                    {getComplianceBadges(contact).map(badge => (\n                      <span\n                        key={badge.key}\n                        className={`inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-medium ${badge.className}`}\n                      >\n                        {badge.label}\n                      </span>\n                    ))}\n                  </div>\n                </td>\n\n                <td className={`px-4 ${rowPadding} truncate text-sm font-medium text-slate-800`}>\n                  {contact.phoneNumber || \"-\"}\n                </td>\n                <td className={`px-4 ${rowPadding} hidden md:table-cell truncate text-sm text-slate-800`}>\n                  {contact.email || \"-\"}\n                </td>\n                <td className={`px-4 ${rowPadding} hidden lg:table-cell`}>\n                  {getContactTags(contact).length === 0 ? (\n                    <span className=\"text-xs text-slate-400\">-</span>\n                  ) : (\n                    <div className=\"flex flex-wrap gap-1\">\n                      {getContactTags(contact)\n                        .slice(0, 2)\n                        .map(tag => {\n                          const key = tag.id || tag.tagId || tag.name;\n                          const label = tag.name || tag.label || tag.tagName;\n                          return (\n                            <span\n                              key={key}\n                              className=\"inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700\"\n                            >\n                              {label}\n                            </span>\n                          );\n                        })}\n                      {getContactTags(contact).length > 2 && (\n                        <span className=\"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] text-slate-600\">\n                          +{getContactTags(contact).length - 2}\n                        </span>\n                      )}\n                    </div>\n                  )}\n                </td>\n                <td className={`px-4 ${rowPadding} hidden lg:table-cell truncate text-sm text-slate-800`}>\n                  {contact.createdAt\n                    ? new Date(contact.createdAt).toLocaleDateString()\n                    : \"-\"}\n                </td>\n                <td className={`px-4 ${rowPadding} text-center`}>\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <button className=\"p-1.5 rounded-md hover:bg-slate-100 focus:outline-none\">\n                        <MoreVertical size={16} />\n                      </button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent className=\"w-48\">\n                      <DropdownMenuItem\n                        onClick={() => onEdit(contact)}\n                        className=\"px-3 py-2\"\n                      >\n                        Edit\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() => openTagModal(\"add\", contact)}\n                        className=\"px-3 py-2\"\n                      >\n                        Add tag\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() => openTagModal(\"remove\", contact)}\n                        className=\"px-3 py-2\"\n                      >\n                        Remove tag\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() => handleDelete(contact.id)}\n                        className=\"px-3 py-2 text-rose-700 hover:bg-rose-50\"\n                      >\n                        Delete\n                      </DropdownMenuItem>\n                      <DropdownMenuItem\n                        onClick={() =>\n                          navigate(`/dashboard/contacts/${contact.id}/notes`)\n                        }\n                        className=\"px-3 py-2\"\n                      >\n                        Notes\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </td>\n              </tr>\n            ))\n          )}\n        </tbody>\n      </table>\n\n      <ContactTagModal\n        isOpen={tagModalOpen}\n        mode={tagModalMode}\n        contact={tagModalContact}\n        onClose={closeTagModal}\n        onUpdated={fetchContacts}\n      />\n\n      <div className=\"flex flex-col sm:flex-row justify-between items-center gap-3 px-6 py-4 text-sm text-slate-600 bg-slate-50/50 border-t border-slate-100\">\n        <div className=\"flex items-center gap-4\">\n          <span className=\"text-xs font-medium text-slate-700\">\n            {totalCount > 0 ? (\n              <>\n                Showing{' '}\n                <span className=\"font-semibold text-emerald-700\">\n                  {((currentPage - 1) * pageSize) + 1}-{Math.min(currentPage * pageSize, totalCount)}\n                </span>\n                {' '}of{' '}\n                <span className=\"font-semibold text-slate-900\">{totalCount}</span>\n                {' '}contacts\n              </>\n            ) : (\n              'No contacts'\n            )}\n          </span>\n          <span className=\"hidden sm:inline text-xs text-slate-400\"></span>\n          <span className=\"text-xs text-slate-500\">\n            Page {currentPage} of {totalPages}\n          </span>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          {/* Page size selector */}\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={pageSize}\n              onChange={(e) => {\n                setPageSize(Number(e.target.value));\n                setCurrentPage(1);\n              }}\n              className=\"text-xs font-medium border border-slate-300 rounded-md px-2 py-1.5 bg-white hover:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-200 transition-all cursor-pointer\"\n            >\n              <option value={10}>10/page</option>\n              <option value={20}>20/page</option>\n              <option value={50}>50/page</option>\n              <option value={100}>100/page</option>\n            </select>\n          </div>\n          \n          {/* Pagination buttons */}\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => setCurrentPage(p => Math.max(p - 1, 1))}\n              disabled={currentPage === 1}\n              className=\"px-3 py-1.5 border border-slate-200 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-slate-300 transition-colors text-xs font-medium\"\n            >\n              Prev\n            </button>\n            <button\n              onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-1.5 border border-slate-200 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-slate-300 transition-colors text-xs font-medium\"\n            >\n              Next\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","//  src/pages/CRM/Tags/TagSelector.jsx\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport axiosClient from \"../../../api/axiosClient\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n/**\r\n * TagSelector - Chip-based selector for one or more tags.\r\n *\r\n * Props:\r\n * - selected: array of selected tag IDs\r\n * - onChange: (ids: Guid[]) => void\r\n * - multi: boolean (allow multiple selection or not)\r\n * - tags?: optional preloaded tags to avoid refetching\r\n */\r\nexport default function TagSelector({\r\n  selected = [],\r\n  onChange,\r\n  multi = true,\r\n  tags: tagsProp,\r\n}) {\r\n  const [tagsState, setTagsState] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (Array.isArray(tagsProp)) return;\r\n    fetchTags();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tagsProp]);\r\n\r\n  const fetchTags = async () => {\r\n    try {\r\n      const res = await axiosClient.get(\"/tags\");\r\n\r\n      let list = [];\r\n      if (Array.isArray(res.data)) {\r\n        list = res.data;\r\n      } else if (Array.isArray(res.data?.data)) {\r\n        list = res.data.data;\r\n      }\r\n\r\n      setTagsState(list);\r\n    } catch (err) {\r\n      console.error(\" Failed to load tags\", err);\r\n      toast.error(\"Failed to load tags\");\r\n      setTagsState([]);\r\n    }\r\n  };\r\n\r\n  const handleToggle = tagId => {\r\n    if (!onChange) return;\r\n\r\n    if (multi) {\r\n      const isSelected = selected.includes(tagId);\r\n      const updated = isSelected\r\n        ? selected.filter(id => id !== tagId)\r\n        : [...selected, tagId];\r\n      onChange(updated);\r\n    } else {\r\n      onChange([tagId]);\r\n    }\r\n  };\r\n\r\n  const safeTags = Array.isArray(tagsProp) ? tagsProp : tagsState;\r\n\r\n  if (!safeTags.length) {\r\n    return (\r\n      <p className=\"text-xs text-gray-500\">\r\n        No tags yet. Create tags in the Tags workspace.\r\n      </p>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-wrap gap-2\">\r\n      {safeTags.map(tag => {\r\n        const isSelected = selected.includes(tag.id);\r\n        return (\r\n          <button\r\n            key={tag.id}\r\n            type=\"button\"\r\n            onClick={() => handleToggle(tag.id)}\r\n            className={`px-3 py-1 rounded-full text-xs border transition-all duration-150 flex items-center ${\r\n              isSelected\r\n                ? \"bg-emerald-600 text-white border-emerald-600 shadow-sm\"\r\n                : \"bg-gray-50 text-gray-700 border-gray-300 hover:bg-emerald-50 hover:border-emerald-200 hover:text-emerald-800\"\r\n            }`}\r\n            title={tag.notes || tag.name}\r\n          >\r\n            <span\r\n              className=\"inline-block w-2 h-2 rounded-full mr-2\"\r\n              style={{ backgroundColor: tag.colorHex || \"#22C55E\" }}\r\n            ></span>\r\n            {tag.name}\r\n          </button>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\n// import React, { useEffect, useState } from \"react\";\r\n// import axios from \"axios\";\r\n\r\n// /**\r\n//  * TagSelector - A dropdown/select box to choose one or more tags.\r\n//  * Props:\r\n//  * - selected: array of selected tag IDs\r\n//  * - onChange: callback with updated tag array\r\n//  * - multi: boolean (allow multi-select or not)\r\n//  */\r\n// export default function TagSelector({ selected = [], onChange, multi = true }) {\r\n//   const [tags, setTags] = useState([]);\r\n\r\n//   useEffect(() => {\r\n//     fetchTags();\r\n//   }, []);\r\n\r\n//   const fetchTags = async () => {\r\n//     try {\r\n//       const res = await axios.get(\"/api/tags\");\r\n//       setTags(Array.isArray(res.data) ? res.data : []);\r\n//     } catch (err) {\r\n//       console.error(\" Failed to load tags\", err);\r\n//       setTags([]); // fallback to empty\r\n//     }\r\n//   };\r\n\r\n//   const handleToggle = tagId => {\r\n//     if (multi) {\r\n//       const isSelected = selected.includes(tagId);\r\n//       const updated = isSelected\r\n//         ? selected.filter(id => id !== tagId)\r\n//         : [...selected, tagId];\r\n//       onChange(updated);\r\n//     } else {\r\n//       onChange([tagId]);\r\n//     }\r\n//   };\r\n\r\n//   return (\r\n//     <div className=\"flex flex-wrap gap-2\">\r\n//       {(Array.isArray(tags) ? tags : []).map(tag => {\r\n//         const isSelected = selected.includes(tag.id);\r\n//         return (\r\n//           <button\r\n//             key={tag.id}\r\n//             onClick={() => handleToggle(tag.id)}\r\n//             className={`px-3 py-1 rounded-full text-sm border transition-all duration-150 ${\r\n//               isSelected\r\n//                 ? \"bg-purple-600 text-white border-purple-600\"\r\n//                 : \"bg-gray-100 text-gray-700 border-gray-300\"\r\n//             }`}\r\n//             title={tag.notes || tag.name}\r\n//           >\r\n//             <span\r\n//               className=\"inline-block w-2 h-2 rounded-full mr-2\"\r\n//               style={{ backgroundColor: tag.colorHex || \"#999\" }}\r\n//             ></span>\r\n//             {tag.name}\r\n//           </button>\r\n//         );\r\n//       })}\r\n//     </div>\r\n//   );\r\n// }\r\n","import React, { useEffect, useMemo, useState } from \"react\";\nimport { toast } from \"react-toastify\";\nimport {\n  getSchemaWithValues,\n  upsertCustomFieldValues,\n} from \"./customFieldsApi\";\n\nconst toDateInputValue = value => {\n  if (!value) return \"\";\n  if (value instanceof Date) return value.toISOString().slice(0, 10);\n  if (typeof value === \"string\") return value.slice(0, 10);\n  return \"\";\n};\n\nconst formatDisplayValue = (dataType, value) => {\n  if (value === null || value === undefined || value === \"\") return \"-\";\n  if (dataType === \"Boolean\") return value ? \"Yes\" : \"No\";\n  if (dataType === \"MultiSelect\" && Array.isArray(value)) {\n    return value.join(\", \") || \"-\";\n  }\n  if (dataType === \"Date\") {\n    try {\n      return new Date(value).toLocaleDateString();\n    } catch {\n      return value;\n    }\n  }\n  return String(value);\n};\n\nexport default function CustomFieldsEditor({\n  entityType = \"Contact\",\n  entityId,\n  mode = \"edit\",\n}) {\n  const [definitions, setDefinitions] = useState([]);\n  const [values, setValues] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n\n  const isViewMode = mode === \"view\";\n\n  const normalizedEntityType = useMemo(\n    () => {\n      const trimmed = String(entityType || \"Contact\").trim();\n      return trimmed || \"Contact\";\n    },\n    [entityType]\n  );\n\n  const loadSchema = async () => {\n    if (!entityId) return;\n    setLoading(true);\n    try {\n      const { definitions: defs, valuesMap } = await getSchemaWithValues({\n        entityType: normalizedEntityType,\n        entityId,\n      });\n\n      const normalizedValues = { ...(valuesMap || {}) };\n      defs.forEach(def => {\n        const raw = valuesMap?.[def.id];\n        if (def.dataType === \"Boolean\") {\n          normalizedValues[def.id] =\n            raw === true || raw === \"true\" || raw === 1 || raw === \"1\";\n        }\n        if (def.dataType === \"MultiSelect\") {\n          normalizedValues[def.id] = Array.isArray(raw)\n            ? raw\n            : raw\n            ? [raw]\n            : [];\n        }\n        if (def.dataType === \"Number\") {\n          normalizedValues[def.id] =\n            raw === null || raw === undefined ? \"\" : String(raw);\n        }\n        if (def.dataType === \"Date\") {\n          normalizedValues[def.id] = toDateInputValue(raw);\n        }\n      });\n\n      setDefinitions(defs);\n      setValues(normalizedValues);\n    } catch (error) {\n      toast.error(\n        error?.response?.data?.message || \"Failed to load attributes.\"\n      );\n      setDefinitions([]);\n      setValues({});\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadSchema();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [entityId, normalizedEntityType]);\n\n  const orderedDefinitions = useMemo(\n    () => definitions.slice().sort((a, b) => a.sortOrder - b.sortOrder),\n    [definitions]\n  );\n\n  const handleValueChange = (fieldId, nextValue) => {\n    setValues(prev => ({ ...prev, [fieldId]: nextValue }));\n  };\n\n  const handleMultiSelectToggle = (fieldId, option) => {\n    const current = Array.isArray(values[fieldId]) ? values[fieldId] : [];\n    if (current.includes(option)) {\n      handleValueChange(\n        fieldId,\n        current.filter(item => item !== option)\n      );\n      return;\n    }\n    handleValueChange(fieldId, [...current, option]);\n  };\n\n  const buildValuesPayload = () =>\n    orderedDefinitions.map(def => {\n      let value = values[def.id];\n      if (def.dataType === \"Number\") {\n        if (value === \"\" || value === null || value === undefined) {\n          value = null;\n        } else {\n          const parsed = Number(value);\n          value = Number.isFinite(parsed) ? parsed : null;\n        }\n      }\n      if (def.dataType === \"Date\") {\n        value = value ? new Date(value).toISOString() : null;\n      }\n      if (def.dataType === \"Boolean\") {\n        value = Boolean(value);\n      }\n      if (def.dataType === \"MultiSelect\") {\n        value = Array.isArray(value) ? value : [];\n      }\n      return { fieldId: def.id, value };\n    });\n\n  const handleSave = async () => {\n    if (!entityId) return;\n    setSaving(true);\n    try {\n      const payload = {\n        entityType: normalizedEntityType,\n        entityId,\n        values: buildValuesPayload(),\n      };\n      await upsertCustomFieldValues(payload);\n      toast.success(\"Attributes saved.\");\n      await loadSchema();\n    } catch (error) {\n      toast.error(\n        error?.response?.data?.message || \"Failed to save attributes.\"\n      );\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (!entityId) {\n    return (\n      <div className=\"rounded-md border border-slate-100 bg-slate-50 px-3 py-2 text-xs text-slate-500\">\n        Save contact first to set attributes.\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className=\"rounded-md border border-slate-100 bg-white px-3 py-3 text-xs text-slate-500\">\n        Loading attributes...\n      </div>\n    );\n  }\n\n  if (!orderedDefinitions.length) {\n    return (\n      <div className=\"rounded-md border border-dashed border-slate-200 bg-slate-50 px-3 py-3 text-xs text-slate-500\">\n        No attributes configured yet.\n      </div>\n    );\n  }\n\n  if (isViewMode) {\n    return (\n      <div className=\"space-y-3\">\n        {orderedDefinitions.map(def => (\n          <div\n            key={def.id}\n            className=\"rounded-md border border-slate-100 bg-white px-3 py-2\"\n          >\n            <p className=\"text-[11px] font-semibold text-slate-500\">\n              {def.label}\n            </p>\n            <p className=\"text-sm text-slate-800\">\n              {formatDisplayValue(def.dataType, values[def.id])}\n            </p>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {orderedDefinitions.map(def => (\n          <div key={def.id} className=\"space-y-1\">\n            <label className=\"text-xs font-semibold text-slate-600\">\n              {def.label}\n              {def.isRequired && (\n                <span className=\"ml-1 text-rose-500\">*</span>\n              )}\n            </label>\n\n            {def.dataType === \"Text\" && (\n              <input\n                type=\"text\"\n                value={values[def.id] ?? \"\"}\n                onChange={e => handleValueChange(def.id, e.target.value)}\n                className=\"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400\"\n              />\n            )}\n\n            {def.dataType === \"Number\" && (\n              <input\n                type=\"number\"\n                value={values[def.id] ?? \"\"}\n                onChange={e => handleValueChange(def.id, e.target.value)}\n                className=\"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400\"\n              />\n            )}\n\n            {def.dataType === \"Date\" && (\n              <input\n                type=\"date\"\n                value={toDateInputValue(values[def.id])}\n                onChange={e => handleValueChange(def.id, e.target.value)}\n                className=\"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400\"\n              />\n            )}\n\n            {def.dataType === \"Boolean\" && (\n              <label className=\"flex items-center gap-2 text-sm text-slate-600\">\n                <input\n                  type=\"checkbox\"\n                  checked={Boolean(values[def.id])}\n                  onChange={e => handleValueChange(def.id, e.target.checked)}\n                  className=\"h-4 w-4 rounded border-slate-300 text-purple-600 focus:ring-purple-500\"\n                />\n                {Boolean(values[def.id]) ? \"Yes\" : \"No\"}\n              </label>\n            )}\n\n            {def.dataType === \"SingleSelect\" && (\n              <select\n                value={values[def.id] ?? \"\"}\n                onChange={e => handleValueChange(def.id, e.target.value)}\n                className=\"w-full rounded-md border border-slate-200 px-3 py-2 text-sm focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400\"\n              >\n                <option value=\"\">Select...</option>\n                {def.options.map(option => (\n                  <option key={option} value={option}>\n                    {option}\n                  </option>\n                ))}\n              </select>\n            )}\n\n            {def.dataType === \"MultiSelect\" && (\n              <div className=\"rounded-md border border-slate-200 bg-slate-50 px-3 py-2\">\n                {def.options.length === 0 ? (\n                  <p className=\"text-xs text-slate-400\">No options.</p>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {def.options.map(option => (\n                      <label\n                        key={option}\n                        className=\"flex items-center gap-2 text-sm text-slate-600\"\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={\n                            Array.isArray(values[def.id]) &&\n                            values[def.id].includes(option)\n                          }\n                          onChange={() =>\n                            handleMultiSelectToggle(def.id, option)\n                          }\n                          className=\"h-4 w-4 rounded border-slate-300 text-purple-600 focus:ring-purple-500\"\n                        />\n                        {option}\n                      </label>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"flex justify-end\">\n        <button\n          type=\"button\"\n          onClick={handleSave}\n          disabled={saving}\n          className=\"rounded-md bg-purple-600 px-4 py-2 text-sm font-semibold text-white hover:bg-purple-700 disabled:bg-purple-300\"\n        >\n          {saving ? \"Saving...\" : \"Save Attributes\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\r\nimport axiosClient from \"../../../../api/axiosClient\";\nimport { toast } from \"react-toastify\";\nimport TagSelector from \"../../Tags/TagSelector\";\nimport CustomFieldsEditor from \"../../../CustomFields/CustomFieldsEditor\";\n\r\nconst leadSources = [\n  \"Manual\",\n  \"Website Form\",\n  \"Google Search\",\n  \"Facebook Ad\",\n  \"LinkedIn\",\n  \"Referral\",\n  \"Trade Show\",\n  \"Cold Call\",\n  \"Other\",\n];\n\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nfunction ContactFormModal({ isOpen, onClose, contact, onSaveComplete }) {\n  const [formData, setFormData] = useState({\n    name: \"\",\n    phoneNumber: \"\",\n    email: \"\",\r\n    leadSource: \"Manual\",\r\n    notes: \"\",\r\n    tagIds: [],\r\n  });\n  const [allTags, setAllTags] = useState([]);\n  const [isSaving, setIsSaving] = useState(false);\n  const [touched, setTouched] = useState({\n    phoneNumber: false,\n    email: false,\n  });\n  const [submitAttempted, setSubmitAttempted] = useState(false);\n\n  const normalizePhoneValue = value => {\n    let digits = value.replace(/\\D/g, \"\");\n    if (digits.length > 10 && digits.startsWith(\"91\")) {\n      digits = digits.slice(2);\n    }\n    if (digits.length > 10 && digits.startsWith(\"0\")) {\n      digits = digits.slice(1);\n    }\n    return digits.slice(0, 10);\n  };\n\n  const getPhoneError = value => {\n    if (!value) return \"Mobile number is required.\";\n    if (value.length !== 10) {\n      return \"Mobile number must be exactly 10 digits.\";\n    }\n    return \"\";\n  };\n\n  const getEmailError = value => {\n    if (!value) return \"\";\n    return emailRegex.test(value)\n      ? \"\"\n      : \"Please enter a valid email address.\";\n  };\n\n  const phoneError = getPhoneError(formData.phoneNumber);\n  const emailError = getEmailError(formData.email);\n  const canSubmit = !phoneError && !emailError;\n\n  useEffect(() => {\n    const fetchTags = async () => {\n      try {\n        const res = await axiosClient.get(\"/tags\");\n        const list = Array.isArray(res.data)\r\n          ? res.data\r\n          : Array.isArray(res.data?.data)\r\n          ? res.data.data\r\n          : [];\r\n        setAllTags(list);\r\n      } catch (error) {\r\n        console.error(\"Failed to load tags:\", error);\r\n        toast.error(\"Failed to load tags.\");\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      fetchTags();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  useEffect(() => {\r\n    if (contact) {\n      const existing =\n        contact.tags ||\n        contact.contactTags ||\n        contact.tagSummaries ||\n        contact.tagList ||\n        [];\n      const tagIds = Array.isArray(existing)\r\n        ? existing.map(t => t.tagId || t.id).filter(Boolean)\r\n        : [];\r\n      setFormData({\n        name: contact.name || \"\",\n        phoneNumber: normalizePhoneValue(contact.phoneNumber || \"\"),\n        email: contact.email || \"\",\n        leadSource: contact.leadSource || \"Manual\",\n        notes: contact.notes || \"\",\n        tagIds,\n      });\n    } else {\n      setFormData({\n        name: \"\",\n        phoneNumber: \"\",\n        email: \"\",\n        leadSource: \"Manual\",\n        notes: \"\",\n        tagIds: [],\n      });\n    }\n    setTouched({ phoneNumber: false, email: false });\n    setSubmitAttempted(false);\n  }, [contact, isOpen]);\n\n  const handleChange = e => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handlePhoneChange = e => {\n    const normalizedValue = normalizePhoneValue(e.target.value);\n    setFormData(prev => ({ ...prev, phoneNumber: normalizedValue }));\n    setTouched(prev => ({ ...prev, phoneNumber: true }));\n  };\n\n  const handleEmailChange = e => {\n    const { value } = e.target;\n    setFormData(prev => ({ ...prev, email: value }));\n    setTouched(prev => ({ ...prev, email: true }));\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setSubmitAttempted(true);\n\n    if (!canSubmit) {\n      toast.error(phoneError || emailError);\n      return;\n    }\n\n    setIsSaving(true);\n\r\n    const payload = {\r\n      ...formData,\r\n      tagIds: formData.tagIds,\r\n    };\r\n\r\n    try {\r\n      if (contact?.id) {\r\n        await axiosClient.put(`/contacts/${contact.id}`, payload); // Assuming PUT doesn't need \"add\"\r\n        toast.success(\" Contact updated successfully!\");\r\n      } else {\r\n        //  FIX #1: Using the correct endpoint for creating a contact.\r\n        await axiosClient.post(\"/contacts/create\", payload);\r\n        toast.success(\" Contact created successfully!\");\r\n      }\r\n      onSaveComplete?.();\r\n      onClose();\r\n    } catch (err) {\r\n      //  FIX #2: Specific error handling for duplicate contacts.\r\n      if (err.response && err.response.status === 409) {\r\n        // 409 Conflict status means the contact already exists.\r\n        toast.warn(\r\n          err.response.data.message ||\r\n            \"Contact with this phone number already exists.\"\r\n        );\r\n      } else {\r\n        // Handle all other errors (like 404 Not Found, 500 Server Error, etc.)\r\n        const errorMessage =\r\n          err.response?.data?.message || \"Failed to save contact.\";\r\n        toast.error(errorMessage);\r\n      }\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl relative\">\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl\"\r\n        >\r\n          &times;\r\n        </button>\r\n\r\n        <h2 className=\"text-xl font-bold mb-4\">\r\n          {contact?.id ? \"Edit Contact\" : \"Add New Contact\"}\r\n        </h2>\r\n\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\r\n        >\r\n          <input\n            name=\"name\"\n            value={formData.name}\n            onChange={handleChange}\n            placeholder=\"Full Name *\"\n            required\n            className=\"border px-3 py-2 rounded w-full\"\n          />\n          <div className=\"space-y-1\">\n            <input\n              type=\"tel\"\n              name=\"phoneNumber\"\n              value={formData.phoneNumber}\n              onChange={handlePhoneChange}\n              placeholder=\"Phone Number *\"\n              required\n              maxLength={10}\n              inputMode=\"numeric\"\n              autoComplete=\"tel\"\n              className=\"border px-3 py-2 rounded w-full\"\n            />\n            {(touched.phoneNumber || submitAttempted) && phoneError && (\n              <p className=\"text-[11px] text-rose-600\">{phoneError}</p>\n            )}\n          </div>\n          <div className=\"space-y-1\">\n            <input\n              type=\"email\"\n              name=\"email\"\n              value={formData.email}\n              onChange={handleEmailChange}\n              placeholder=\"Email\"\n              className=\"border px-3 py-2 rounded w-full\"\n            />\n            {(touched.email || submitAttempted) && emailError && (\n              <p className=\"text-[11px] text-rose-600\">{emailError}</p>\n            )}\n          </div>\n          <select\n            name=\"leadSource\"\n            value={formData.leadSource}\n            onChange={handleChange}\n            className=\"border px-3 py-2 rounded w-full\"\n          >\r\n            {leadSources.map(source => (\r\n              <option key={source} value={source}>\r\n                {source}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          <div className=\"md:col-span-2 space-y-1\">\n            <label className=\"text-sm font-medium text-slate-700\">\n              Tags (optional)\n            </label>\n            {allTags.length === 0 ? (\r\n              <div className=\"text-xs text-slate-600 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 flex items-center justify-between gap-3\">\r\n                <span>\r\n                  No tags yet. Create a tag first to segment contacts.\r\n                </span>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => window.open(\"/app/crm/tags\", \"_blank\")}\r\n                  className=\"text-emerald-700 font-semibold hover:text-emerald-800 whitespace-nowrap\"\r\n                >\r\n                  Create tag\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <TagSelector\r\n                tags={allTags}\r\n                selected={formData.tagIds}\r\n                onChange={ids =>\r\n                  setFormData(prev => ({ ...prev, tagIds: ids }))\r\n                }\r\n                multi\r\n              />\r\n            )}\r\n            {!contact?.id && allTags.length > 0 && (\n              <p className=\"text-[11px] text-slate-500\">\n                Tags are optional. You can add them now or later.\n              </p>\n            )}\n          </div>\r\n          <textarea\n            name=\"notes\"\n            value={formData.notes}\n            onChange={handleChange}\n            placeholder=\"Notes...\"\n            className=\"md:col-span-2 border px-3 py-2 rounded w-full min-h-[80px]\"\n          ></textarea>\n\n          <div className=\"md:col-span-2 space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-sm font-semibold text-slate-700\">\n                Attributes\n              </h3>\n              <span className=\"text-[11px] text-slate-400\">\n                CRM contact attributes\n              </span>\n            </div>\n\n            {contact?.id ? (\n              <CustomFieldsEditor\n                entityType=\"Contact\"\n                entityId={contact.id}\n                mode=\"edit\"\n              />\n            ) : (\n              <div className=\"rounded-lg border border-slate-100 bg-slate-50 px-3 py-2 text-xs text-slate-500\">\n                Save contact first to set attributes.\n              </div>\n            )}\n          </div>\n          <div className=\"md:col-span-2 flex justify-end gap-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"bg-gray-200 text-gray-800 px-6 py-2 rounded hover:bg-gray-300\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\n              type=\"submit\"\n              disabled={isSaving || !canSubmit}\n              className=\"bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 disabled:bg-emerald-300\"\n            >\n              {isSaving\r\n                ? \"Saving...\"\r\n                : contact?.id\r\n                ? \"Update Contact\"\r\n                : \"Add Contact\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ContactFormModal;\r\n\r\n// import React, { useEffect, useState } from \"react\";\r\n// import axiosClient from \"../../../api/axiosClient\";\r\n// import { toast } from \"react-toastify\";\r\n\r\n// //  FIX #1: Define the list of lead sources.\r\n// const leadSources = [\r\n//   \"Manual\",\r\n//   \"Website Form\",\r\n//   \"Google Search\",\r\n//   \"Facebook Ad\",\r\n//   \"LinkedIn\",\r\n//   \"Referral\",\r\n//   \"Trade Show\",\r\n//   \"Cold Call\",\r\n//   \"Other\",\r\n// ];\r\n\r\n// function ContactFormModal({ isOpen, onClose, contact, onSaveComplete }) {\r\n//   const [formData, setFormData] = useState({\r\n//     name: \"\",\r\n//     phoneNumber: \"\",\r\n//     email: \"\",\r\n//     //  FIX #2: Set the default leadSource to \"Manual\".\r\n//     leadSource: \"Manual\",\r\n//     notes: \"\",\r\n//     tagId: \"\",\r\n//   });\r\n//   const [allTags, setAllTags] = useState([]);\r\n//   const [isSaving, setIsSaving] = useState(false);\r\n\r\n//   useEffect(() => {\r\n//     const fetchTags = async () => {\r\n//       try {\r\n//         const res = await axiosClient.get(\"/tags/get-tags\");\r\n//         setAllTags(res.data.data || []);\r\n//       } catch (error) {\r\n//         console.error(\"Failed to load tags:\", error);\r\n//         toast.error(\" Failed to load tags\");\r\n//       }\r\n//     };\r\n\r\n//     if (isOpen) {\r\n//       fetchTags();\r\n//     }\r\n//   }, [isOpen]);\r\n\r\n//   useEffect(() => {\r\n//     if (contact) {\r\n//       setFormData({\r\n//         name: contact.name || \"\",\r\n//         phoneNumber: contact.phoneNumber || \"\",\r\n//         email: contact.email || \"\",\r\n//         leadSource: contact.leadSource || \"Manual\",\r\n//         notes: contact.notes || \"\",\r\n//         tagId: contact.tags?.[0]?.tagId || \"\",\r\n//       });\r\n//     } else {\r\n//       // Reset form for a new contact\r\n//       setFormData({\r\n//         name: \"\",\r\n//         phoneNumber: \"\",\r\n//         email: \"\",\r\n//         leadSource: \"Manual\",\r\n//         notes: \"\",\r\n//         tagId: \"\",\r\n//       });\r\n//     }\r\n//   }, [contact, isOpen]);\r\n\r\n//   const handleChange = e => {\r\n//     const { name, value } = e.target;\r\n//     setFormData(prev => ({ ...prev, [name]: value }));\r\n//   };\r\n\r\n//   const handleSubmit = async e => {\r\n//     e.preventDefault();\r\n//     setIsSaving(true);\r\n\r\n//     const payload = {\r\n//       ...formData,\r\n//       tagIds: formData.tagId ? [formData.tagId] : [],\r\n//     };\r\n//     delete payload.tagId;\r\n\r\n//     try {\r\n//       if (contact?.id) {\r\n//         await axiosClient.put(`/contacts/add/${contact.id}`, payload);\r\n//         toast.success(\" Contact updated successfully!\");\r\n//       } else {\r\n//         await axiosClient.post(\"/contacts\", payload);\r\n//         toast.success(\" Contact created successfully!\");\r\n//       }\r\n//       onSaveComplete?.();\r\n//       onClose();\r\n//     } catch (err) {\r\n//       const errorMessage =\r\n//         err.response?.data?.message || \" Failed to save contact.\";\r\n//       toast.error(errorMessage);\r\n//     } finally {\r\n//       setIsSaving(false);\r\n//     }\r\n//   };\r\n\r\n//   if (!isOpen) return null;\r\n\r\n//   return (\r\n//     <div className=\"fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4\">\r\n//       <div className=\"bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl relative\">\r\n//         <button\r\n//           onClick={onClose}\r\n//           className=\"absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl\"\r\n//         >\r\n//           &times;\r\n//         </button>\r\n\r\n//         <h2 className=\"text-xl font-bold mb-4\">\r\n//           {contact?.id ? \"Edit Contact\" : \"Add New Contact\"}\r\n//         </h2>\r\n\r\n//         <form\r\n//           onSubmit={handleSubmit}\r\n//           className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\r\n//         >\r\n//           <input\r\n//             name=\"name\"\r\n//             value={formData.name}\r\n//             onChange={handleChange}\r\n//             placeholder=\"Full Name *\"\r\n//             required\r\n//             className=\"border px-3 py-2 rounded w-full\"\r\n//           />\r\n//           <input\r\n//             name=\"phoneNumber\"\r\n//             value={formData.phoneNumber}\r\n//             onChange={handleChange}\r\n//             placeholder=\"Phone Number *\"\r\n//             required\r\n//             className=\"border px-3 py-2 rounded w-full\"\r\n//           />\r\n//           <input\r\n//             type=\"email\"\r\n//             name=\"email\"\r\n//             value={formData.email}\r\n//             onChange={handleChange}\r\n//             placeholder=\"Email\"\r\n//             className=\"border px-3 py-2 rounded w-full\"\r\n//           />\r\n\r\n//           {/*  FIX #3: Replaced the text input with a select dropdown. */}\r\n//           <select\r\n//             name=\"leadSource\"\r\n//             value={formData.leadSource}\r\n//             onChange={handleChange}\r\n//             className=\"border px-3 py-2 rounded w-full\"\r\n//           >\r\n//             {leadSources.map(source => (\r\n//               <option key={source} value={source}>\r\n//                 {source}\r\n//               </option>\r\n//             ))}\r\n//           </select>\r\n\r\n//           <select\r\n//             name=\"tagId\"\r\n//             value={formData.tagId}\r\n//             onChange={handleChange}\r\n//             className=\"md:col-span-2 border px-3 py-2 rounded w-full\"\r\n//           >\r\n//             <option value=\"\">-- No Tag --</option>\r\n//             {allTags.map(tag => (\r\n//               <option key={tag.id} value={tag.id}>\r\n//                 {tag.name}\r\n//               </option>\r\n//             ))}\r\n//           </select>\r\n\r\n//           <textarea\r\n//             name=\"notes\"\r\n//             value={formData.notes}\r\n//             onChange={handleChange}\r\n//             placeholder=\"Notes...\"\r\n//             className=\"md:col-span-2 border px-3 py-2 rounded w-full min-h-[80px]\"\r\n//           ></textarea>\r\n\r\n//           <div className=\"md:col-span-2 flex justify-end gap-3\">\r\n//             <button\r\n//               type=\"button\"\r\n//               onClick={onClose}\r\n//               className=\"bg-gray-200 text-gray-800 px-6 py-2 rounded hover:bg-gray-300\"\r\n//             >\r\n//               Cancel\r\n//             </button>\r\n//             <button\r\n//               type=\"submit\"\r\n//               disabled={isSaving}\r\n//               className=\"bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 disabled:bg-purple-300\"\r\n//             >\r\n//               {isSaving\r\n//                 ? \"Saving...\"\r\n//                 : contact?.id\r\n//                 ? \"Update Contact\"\r\n//                 : \"Add Contact\"}\r\n//             </button>\r\n//           </div>\r\n//         </form>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// export default ContactFormModal;\r\n","import React, { useEffect, useState } from \"react\";\nimport { toast } from \"react-toastify\";\n\nimport axiosClient from \"../../../../api/axiosClient\";\n\nfunction BulkActionsBar({ selectedIds = [], onClearSelection, onRefresh }) {\n  const [availableTags, setAvailableTags] = useState([]);\n  const [selectedTagId, setSelectedTagId] = useState(\"\");\n  const [isSaving, setIsSaving] = useState(false);\n\n  useEffect(() => {\n    if (selectedIds.length > 0) {\n      fetchTags();\n    }\n  }, [selectedIds.length]);\n\n  const fetchTags = async () => {\n    try {\n      const normalize = res => {\n        const payload = res.data?.data ?? res.data;\n        return Array.isArray(payload) ? payload : [];\n      };\n\n      try {\n        const res = await axiosClient.get(\"/tags\");\n        const tags = normalize(res);\n        if (tags.length > 0) {\n          setAvailableTags(tags);\n          return;\n        }\n      } catch (_) {\n        // fallback below\n      }\n\n      const res = await axiosClient.get(\"/tags/get-tags\");\n      setAvailableTags(normalize(res));\n    } catch (error) {\n      toast.error(\"Failed to load tags.\");\n    }\n  };\n\n  const handleApplyTag = async () => {\n    if (!selectedTagId) {\n      toast.warn(\"Select a tag first.\");\n      return;\n    }\n\n    try {\n      if (isSaving) return;\n      setIsSaving(true);\n\n      const res = await axiosClient.post(\"/contacts/bulk-assign-tag\", {\n        contactIds: selectedIds,\n        tagId: Number.isFinite(Number(selectedTagId))\n          ? Number(selectedTagId)\n          : selectedTagId,\n      });\n\n      toast.success(res?.data?.message || \"Tag applied to selected contacts.\");\n      onClearSelection?.();\n      setSelectedTagId(\"\");\n      onRefresh?.();\n    } catch (error) {\n      const message =\n        error.response?.data?.message || \"Failed to apply tag.\";\n      toast.error(message);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleRemoveTag = async () => {\n    if (!selectedTagId) {\n      toast.warn(\"Select a tag first.\");\n      return;\n    }\n\n    try {\n      if (isSaving) return;\n      setIsSaving(true);\n\n      const resolvedTagId = Number.isFinite(Number(selectedTagId))\n        ? Number(selectedTagId)\n        : selectedTagId;\n\n      const body = {\n        contactIds: selectedIds,\n        tagId: resolvedTagId,\n        // Some backends expect an array (even for single-tag operations)\n        tagIds: [resolvedTagId],\n      };\n\n      // Some backends enforce DELETE for unassign; others accept POST only.\n      // If the bulk endpoint isn't implemented, fallback to per-contact delete.\n      let res = null;\n      try {\n        res = await axiosClient.request({\n          url: \"/contacts/bulk-unassign-tag\",\n          method: \"DELETE\",\n          data: body,\n        });\n      } catch (err) {\n        const status = err?.response?.status;\n        if (status === 400 || status === 404 || status === 405 || status === 415) {\n          try {\n            res = await axiosClient.post(\"/contacts/bulk-unassign-tag\", body);\n          } catch (postErr) {\n            const postStatus = postErr?.response?.status;\n            if (postStatus === 404) {\n              // Fallback: backend supports single-contact tag removal\n              const results = await Promise.allSettled(\n                selectedIds.map(contactId =>\n                  axiosClient.delete(`/contacts/${contactId}/tags/${resolvedTagId}`)\n                )\n              );\n\n              const succeeded = results.filter(r => {\n                if (r.status === \"fulfilled\") return true;\n                const s = r.reason?.response?.status;\n                return s === 404; // already removed\n              }).length;\n\n              const failed = results.length - succeeded;\n              if (failed === 0) {\n                toast.success(`Tag removed from ${succeeded} contact(s).`);\n              } else {\n                toast.warn(\n                  `Removed from ${succeeded} contact(s), failed for ${failed}.`\n                );\n              }\n\n              onClearSelection?.();\n              setSelectedTagId(\"\");\n              onRefresh?.();\n              return;\n            }\n            throw postErr;\n          }\n        } else {\n          throw err;\n        }\n      }\n\n      toast.success(res?.data?.message || \"Tag removed from selected contacts.\");\n      onClearSelection?.();\n      setSelectedTagId(\"\");\n      onRefresh?.();\n    } catch (error) {\n      const message =\n        error.response?.data?.message || \"Failed to remove tag.\";\n      toast.error(message);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  if (selectedIds.length === 0) return null;\n\n  return (\n    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 py-3 bg-emerald-50/60 border border-emerald-200/70\">\n      <p className=\"text-sm text-slate-700 font-medium\">\n        {selectedIds.length} selected\n      </p>\n\n      <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto\">\n        <select\n          value={selectedTagId}\n          onChange={e => setSelectedTagId(e.target.value)}\n          disabled={isSaving}\n          className=\"w-full sm:w-60 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-200 disabled:opacity-60\"\n        >\n          <option value=\"\">Select tag</option>\n          {availableTags.map(tag => (\n            <option key={tag.id} value={tag.id}>\n              {tag.name}\n            </option>\n          ))}\n        </select>\n\n        <button\n          onClick={handleApplyTag}\n          disabled={!selectedTagId || isSaving}\n          className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n        >\n          {isSaving ? \"Saving...\" : \"Apply tag\"}\n        </button>\n\n        <button\n          onClick={handleRemoveTag}\n          disabled={!selectedTagId || isSaving}\n          className=\"rounded-lg bg-rose-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-rose-700 disabled:opacity-60 disabled:cursor-not-allowed\"\n        >\n          Remove tag\n        </button>\n\n        <button\n          onClick={onClearSelection}\n          disabled={isSaving}\n          className=\"text-sm font-medium text-slate-600 hover:text-slate-900 disabled:opacity-60 disabled:cursor-not-allowed\"\n        >\n          Clear selection\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default BulkActionsBar;\n","import React, { useMemo, useState } from \"react\";\nimport Papa from \"papaparse\";\nimport { toast } from \"react-toastify\";\n\nimport axiosClient from \"../../../api/axiosClient\";\n\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nconst normalizePhone = value => {\n  const digits = String(value ?? \"\").replace(/\\D/g, \"\");\n  if (!digits) return \"\";\n  if (digits.length === 12 && digits.startsWith(\"91\")) {\n    return digits.slice(2);\n  }\n  if (digits.length === 11 && digits.startsWith(\"0\")) {\n    return digits.slice(1);\n  }\n  return digits.length === 10 ? digits : \"\";\n};\n\nconst normalizeHeader = header =>\n  String(header || \"\")\n    .trim()\n    .toLowerCase()\n    .replace(/[^a-z0-9]/g, \"\");\n\nconst getRowValue = (row, keys) => {\n  for (const key of keys) {\n    if (row[key] !== undefined) return row[key];\n  }\n  return \"\";\n};\n\nexport default function CsvUploadModal({\n  isOpen,\n  onClose,\n  onRefresh,\n  onImportingChange,\n}) {\n  const [file, setFile] = useState(null);\n  const [validating, setValidating] = useState(false);\n  const [checkingExisting, setCheckingExisting] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [rowReports, setRowReports] = useState([]);\n  const [hasValidated, setHasValidated] = useState(false);\n  const [skipInvalid, setSkipInvalid] = useState(true);\n  const [skipDuplicates, setSkipDuplicates] = useState(true);\n  const [skipExisting, setSkipExisting] = useState(true);\n  const [confirmOpen, setConfirmOpen] = useState(false);\n\n  const errorRows = useMemo(\n    () => rowReports.filter(row => row.errors.length > 0),\n    [rowReports]\n  );\n  const duplicateRows = useMemo(\n    () => rowReports.filter(row => row.isDuplicate),\n    [rowReports]\n  );\n  const existingRows = useMemo(\n    () => rowReports.filter(row => row.existsInCrm),\n    [rowReports]\n  );\n\n  const importableRows = useMemo(() => {\n    return rowReports.filter(row => {\n      if (row.errors.length > 0) return false;\n      if (skipDuplicates && row.isDuplicate) return false;\n      if (skipExisting && row.existsInCrm) return false;\n      return true;\n    });\n  }, [rowReports, skipDuplicates, skipExisting]);\n\n  const totalRows = rowReports.length;\n  const validRows = totalRows - errorRows.length;\n  const skippedRows = Math.max(0, totalRows - importableRows.length);\n\n  const blockingReasons = useMemo(() => {\n    const reasons = [];\n    if (!hasValidated) return reasons;\n    if (errorRows.length > 0 && !skipInvalid) {\n      reasons.push(\"Validation errors found. Enable Skip invalid rows.\");\n    }\n    if (duplicateRows.length > 0 && !skipDuplicates) {\n      reasons.push(\"Duplicate phones found. Enable Skip duplicates.\");\n    }\n    if (existingRows.length > 0 && !skipExisting) {\n      reasons.push(\"Existing contacts found. Enable Skip existing contacts.\");\n    }\n    if (importableRows.length === 0) {\n      reasons.push(\"No importable rows after applying filters.\");\n    }\n    return reasons;\n  }, [\n    hasValidated,\n    errorRows.length,\n    duplicateRows.length,\n    existingRows.length,\n    skipInvalid,\n    skipDuplicates,\n    skipExisting,\n    importableRows.length,\n  ]);\n\n  const canImport =\n    hasValidated &&\n    blockingReasons.length === 0 &&\n    !validating &&\n    !checkingExisting &&\n    !uploading;\n\n  const resetState = () => {\n    setFile(null);\n    setValidating(false);\n    setCheckingExisting(false);\n    setUploading(false);\n    setRowReports([]);\n    setHasValidated(false);\n    setSkipInvalid(true);\n    setSkipDuplicates(true);\n    setSkipExisting(true);\n    setConfirmOpen(false);\n    onImportingChange?.(false);\n  };\n\n  const handleClose = () => {\n    if (uploading) return;\n    resetState();\n    onClose?.();\n  };\n\n  const handleFileChange = e => {\n    setFile(e.target.files?.[0] || null);\n    setRowReports([]);\n    setHasValidated(false);\n    setSkipInvalid(true);\n    setSkipDuplicates(true);\n    setSkipExisting(true);\n    setConfirmOpen(false);\n  };\n\n  const checkExistingContacts = async reports => {\n    const phones = Array.from(\n      new Set(reports.map(row => row.normalizedPhone).filter(Boolean))\n    );\n    if (phones.length === 0) return;\n\n    const existing = new Set();\n    setCheckingExisting(true);\n\n    for (const phone of phones) {\n      try {\n        const res = await axiosClient.get(\"/contacts/\", {\n          params: {\n            tab: \"all\",\n            search: phone,\n            page: 1,\n            pageSize: 10,\n          },\n        });\n        const result = res.data?.data ?? res.data;\n        const items = Array.isArray(result?.items)\n          ? result.items\n          : Array.isArray(result?.Items)\n          ? result.Items\n          : Array.isArray(result)\n          ? result\n          : [];\n        const match = items.some(contact => {\n          const normalized = normalizePhone(contact.phoneNumber);\n          const isActive =\n            contact.isActive !== undefined\n              ? contact.isActive\n              : contact.IsActive !== undefined\n              ? contact.IsActive\n              : true;\n          return normalized && normalized === phone && isActive !== false;\n        });\n        if (match) existing.add(phone);\n      } catch (err) {\n        console.error(\"Failed to check existing contacts\", err);\n      }\n    }\n\n    setRowReports(prev =>\n      prev.map(row => ({\n        ...row,\n        existsInCrm: existing.has(row.normalizedPhone),\n      }))\n    );\n    setCheckingExisting(false);\n  };\n\n  const handleValidate = () => {\n    if (!file) {\n      toast.warn(\"Please select a CSV file.\");\n      return;\n    }\n    if (!file.name.toLowerCase().endsWith(\".csv\")) {\n      toast.warn(\"Please upload a .csv file.\");\n      return;\n    }\n\n    setValidating(true);\n    setHasValidated(false);\n    setRowReports([]);\n\n    Papa.parse(file, {\n      header: true,\n      skipEmptyLines: true,\n      transformHeader: normalizeHeader,\n      complete: results => {\n        const rows = Array.isArray(results.data) ? results.data : [];\n        const reports = [];\n\n        rows.forEach((row, index) => {\n          const name = getRowValue(row, [\"name\"]);\n          const phoneRaw = getRowValue(row, [\n            \"phonenumber\",\n            \"phone\",\n            \"mobile\",\n            \"mobilenumber\",\n          ]);\n          const email = getRowValue(row, [\"email\"]);\n          const leadSource = getRowValue(row, [\"leadsource\", \"source\"]);\n          const notes = getRowValue(row, [\"notes\", \"note\"]);\n\n          const hasAnyValue = [name, phoneRaw, email, leadSource, notes].some(\n            value => String(value ?? \"\").trim()\n          );\n          if (!hasAnyValue) return;\n\n          const errors = [];\n          if (!String(name ?? \"\").trim()) {\n            errors.push(\"Name is required.\");\n          }\n\n          const normalizedPhone = normalizePhone(phoneRaw);\n          if (!String(phoneRaw ?? \"\").trim()) {\n            errors.push(\"Phone number is required.\");\n          } else if (!normalizedPhone) {\n            errors.push(\n              \"Phone number must be 10 digits after removing +91 or leading 0.\"\n            );\n          }\n\n          const emailValue = String(email ?? \"\").trim();\n          if (emailValue && !emailRegex.test(emailValue)) {\n            errors.push(\"Email format is invalid.\");\n          }\n\n          reports.push({\n            rowNumber: index + 2,\n            name: String(name ?? \"\").trim(),\n            phoneRaw: String(phoneRaw ?? \"\").trim(),\n            normalizedPhone,\n            email: emailValue,\n            leadSource: String(leadSource ?? \"\").trim(),\n            notes: String(notes ?? \"\").trim(),\n            errors,\n            isDuplicate: false,\n            existsInCrm: false,\n          });\n        });\n\n        const seenPhones = new Set();\n        reports.forEach(report => {\n          if (!report.normalizedPhone) return;\n          if (seenPhones.has(report.normalizedPhone)) {\n            report.isDuplicate = true;\n          } else {\n            seenPhones.add(report.normalizedPhone);\n          }\n        });\n\n        setRowReports(reports);\n        setHasValidated(true);\n        setValidating(false);\n\n        if (reports.length === 0) {\n          toast.warn(\"No valid data rows found in the CSV.\");\n          return;\n        }\n\n        checkExistingContacts(reports);\n      },\n      error: () => {\n        toast.error(\"Failed to read the CSV file.\");\n        setValidating(false);\n      },\n    });\n  };\n\n  const handleOpenConfirm = () => {\n    if (!canImport) return;\n    setConfirmOpen(true);\n  };\n\n  const handleConfirmImport = async () => {\n    if (!file || importableRows.length === 0) return;\n    setUploading(true);\n    onImportingChange?.(true);\n\n    const exportRows = importableRows.map(row => ({\n      Name: row.name,\n      PhoneNumber: row.normalizedPhone,\n      Email: row.email,\n      LeadSource: row.leadSource,\n      Notes: row.notes,\n    }));\n    const csv = Papa.unparse(exportRows, {\n      columns: [\"Name\", \"PhoneNumber\", \"Email\", \"LeadSource\", \"Notes\"],\n    });\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n\n    const formData = new FormData();\n    formData.append(\"file\", blob, file.name);\n\n    try {\n      await axiosClient.post(\"/contacts/bulk-import\", formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n      });\n      toast.success(\"Contacts imported successfully.\");\n      onRefresh?.();\n      resetState();\n      onClose?.();\n    } catch (err) {\n      const message =\n        err.response?.data?.message ||\n        \"Failed to import contacts. Please check the CSV.\";\n      toast.error(message);\n    } finally {\n      setUploading(false);\n      onImportingChange?.(false);\n      setConfirmOpen(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white p-6 rounded-xl shadow-md w-full max-w-md space-y-4 relative\">\n        <h2 className=\"text-xl font-bold text-emerald-700\">\n          Import Contacts CSV\n        </h2>\n\n        <input type=\"file\" accept=\".csv\" onChange={handleFileChange} />\n\n        {hasValidated && (\n          <div className=\"rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-700 space-y-1\">\n            <div className=\"font-semibold text-slate-800\">\n              Validation summary\n            </div>\n            <div>Total rows: {totalRows}</div>\n            <div>Valid rows: {validRows}</div>\n            <div>Invalid rows: {errorRows.length}</div>\n            <div>Duplicates in file: {duplicateRows.length}</div>\n            <div>Existing in CRM: {existingRows.length}</div>\n            <div>Ready to import: {importableRows.length}</div>\n            {checkingExisting && (\n              <div className=\"text-[11px] text-slate-500\">\n                Checking existing contacts...\n              </div>\n            )}\n          </div>\n        )}\n\n        {hasValidated && (\n          <div className=\"space-y-2 text-xs text-slate-700\">\n            <label className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={skipInvalid}\n                onChange={e => setSkipInvalid(e.target.checked)}\n              />\n              Skip rows with validation errors\n            </label>\n            <label className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={skipDuplicates}\n                onChange={e => setSkipDuplicates(e.target.checked)}\n              />\n              Skip duplicate phone numbers in file\n            </label>\n            <label className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={skipExisting}\n                onChange={e => setSkipExisting(e.target.checked)}\n              />\n              Skip contacts that already exist in CRM\n            </label>\n          </div>\n        )}\n\n        {errorRows.length > 0 && (\n          <div className=\"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700 max-h-40 overflow-auto\">\n            <div className=\"font-semibold text-rose-800 mb-1\">Row issues</div>\n            <ul className=\"space-y-1\">\n              {errorRows.map((row, index) => (\n                <li key={`${row.rowNumber}-err-${index}`}>\n                  <span className=\"font-semibold\">\n                    Row {row.rowNumber}:\n                  </span>{\" \"}\n                  {row.errors.join(\" \")}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {duplicateRows.length > 0 && (\n          <div className=\"rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700 max-h-32 overflow-auto\">\n            <div className=\"font-semibold text-amber-800 mb-1\">\n              Duplicate rows\n            </div>\n            <ul className=\"space-y-1\">\n              {duplicateRows.map((row, index) => (\n                <li key={`${row.rowNumber}-dup-${index}`}>\n                  Row {row.rowNumber}: {row.phoneRaw || row.normalizedPhone}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {existingRows.length > 0 && (\n          <div className=\"rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700 max-h-32 overflow-auto\">\n            <div className=\"font-semibold text-amber-800 mb-1\">\n              Already in CRM\n            </div>\n            <ul className=\"space-y-1\">\n              {existingRows.map((row, index) => (\n                <li key={`${row.rowNumber}-exist-${index}`}>\n                  Row {row.rowNumber}: {row.phoneRaw || row.normalizedPhone}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {blockingReasons.length > 0 && (\n          <div className=\"rounded-md border border-slate-200 bg-white px-3 py-2 text-xs text-slate-600\">\n            {blockingReasons.map((reason, index) => (\n              <div key={`${reason}-${index}`}>{reason}</div>\n            ))}\n          </div>\n        )}\n\n        <div className=\"flex justify-end gap-3 mt-4\">\n          <button\n            onClick={handleClose}\n            disabled={uploading}\n            className=\"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm disabled:opacity-60\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleValidate}\n            disabled={!file || validating || uploading}\n            className=\"px-4 py-2 rounded border border-emerald-200 text-emerald-700 hover:bg-emerald-50 text-sm disabled:opacity-60\"\n          >\n            {validating ? \"Validating...\" : \"Validate\"}\n          </button>\n          <button\n            onClick={handleOpenConfirm}\n            disabled={!canImport}\n            className=\"px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700 text-sm disabled:bg-emerald-300\"\n          >\n            Import\n          </button>\n        </div>\n\n        {confirmOpen && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[60] p-4\">\n            <div className=\"bg-white rounded-xl shadow-lg max-w-sm w-full p-5 space-y-4\">\n              <h3 className=\"text-lg font-semibold text-slate-900\">\n                Confirm import\n              </h3>\n              <p className=\"text-sm text-slate-600\">\n                {importableRows.length} contacts will be imported. Continue?\n              </p>\n              {skippedRows > 0 && (\n                <p className=\"text-xs text-slate-500\">\n                  Skipping {skippedRows} row{skippedRows === 1 ? \"\" : \"s\"} due\n                  to filters.\n                </p>\n              )}\n              <div className=\"flex justify-end gap-3\">\n                <button\n                  onClick={() => setConfirmOpen(false)}\n                  disabled={uploading}\n                  className=\"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm disabled:opacity-60\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleConfirmImport}\n                  disabled={uploading}\n                  className=\"px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700 text-sm disabled:bg-emerald-300\"\n                >\n                  {uploading ? \"Importing...\" : \"Confirm Import\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['line', { x1: '4', x2: '20', y1: '9', y2: '9', key: '4lhtct' }],\n  ['line', { x1: '4', x2: '20', y1: '15', y2: '15', key: 'vyu0kd' }],\n  ['line', { x1: '10', x2: '8', y1: '3', y2: '21', key: '1ggp8o' }],\n  ['line', { x1: '16', x2: '14', y1: '3', y2: '21', key: 'weycgp' }],\n];\n\n/**\n * @component @name Hash\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8bGluZSB4MT0iNCIgeDI9IjIwIiB5MT0iOSIgeTI9IjkiIC8+CiAgPGxpbmUgeDE9IjQiIHgyPSIyMCIgeTE9IjE1IiB5Mj0iMTUiIC8+CiAgPGxpbmUgeDE9IjEwIiB4Mj0iOCIgeTE9IjMiIHkyPSIyMSIgLz4KICA8bGluZSB4MT0iMTYiIHgyPSIxNCIgeTE9IjMiIHkyPSIyMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/hash\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Hash = createLucideIcon('hash', __iconNode);\n\nexport default Hash;\n","import React, { useState } from \"react\";\nimport { toast } from \"react-toastify\";\nimport {\n  X,\n  Search,\n  Check,\n  Calendar,\n  Layers,\n  Tag,\n  Hash,\n  Filter,\n  Trash2,\n  Plus,\n  RefreshCw,\n  ChevronRight,\n} from \"lucide-react\";\n\nimport axiosClient from \"../../../../api/axiosClient\";\nimport { getCustomFieldDefinitions } from \"../../../CustomFields/customFieldsApi\";\n\n// \n// Utilities\n// \nfunction normalizeTagsResponse(res) {\n  const payload = res?.data?.data ?? res?.data;\n  return Array.isArray(payload) ? payload : [];\n}\n\nasync function fetchAllTags() {\n  try {\n    const res = await axiosClient.get(\"/tags\");\n    const tags = normalizeTagsResponse(res);\n    if (tags.length > 0) return tags;\n  } catch (_) {\n    // fallback below\n  }\n\n  const res = await axiosClient.get(\"/tags/get-tags\");\n  return normalizeTagsResponse(res);\n}\n\nfunction startOfDay(date) {\n  const d = new Date(date);\n  d.setHours(0, 0, 0, 0);\n  return d;\n}\n\nfunction endOfDay(date) {\n  const d = new Date(date);\n  d.setHours(23, 59, 59, 999);\n  return d;\n}\n\nfunction toDateInputValue(date) {\n  if (!date) return \"\";\n  const d = new Date(date);\n  if (Number.isNaN(d.getTime())) return \"\";\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction presetToRange(presetKey) {\n  const now = new Date();\n  if (presetKey === \"24h\") {\n    const from = new Date(now);\n    from.setHours(from.getHours() - 24);\n    return { from, to: now };\n  }\n  if (presetKey === \"week\") {\n    const from = new Date(now);\n    from.setDate(from.getDate() - 7);\n    return { from, to: now };\n  }\n  if (presetKey === \"month\") {\n    const from = new Date(now);\n    from.setMonth(from.getMonth() - 1);\n    return { from, to: now };\n  }\n  if (presetKey === \"today\") {\n    return { from: startOfDay(now), to: endOfDay(now) };\n  }\n  return { from: null, to: null };\n}\n\n// \n// Constants & Defaults\n// \nexport const DEFAULT_CONTACT_FILTERS = Object.freeze({\n  lastSeenPreset: \"\",\n  lastSeenFrom: \"\",\n  lastSeenTo: \"\",\n\n  createdPreset: \"\",\n  createdFrom: \"\",\n  createdTo: \"\",\n\n  optedIn: \"all\", // all | yes | no\n  incomingBlocked: \"all\", // all | yes | no\n\n  tagIds: [],\n  tagMatch: \"any\", // any | all\n\n  // Attribute conditions (requires backend support to filter server-side)\n  // { fieldId, op: \"is\"|\"contains\", value, join: \"and\"|\"or\" }\n  attributes: [],\n});\n\nconst SECTIONS = [\n  { id: \"dates\", label: \"Date Ranges\", icon: Calendar },\n  { id: \"tags\", label: \"Tags\", icon: Tag },\n  { id: \"attributes\", label: \"Attributes\", icon: Hash },\n  { id: \"status\", label: \"Status\", icon: Layers },\n];\n\n// \n// Components\n// \n\nfunction StatusTab({ filters, setField }) {\n  const RadioGroup = ({ label, value, onChange, options }) => (\n    <div className=\"space-y-3\">\n      <label className=\"text-xs font-semibold text-slate-700 uppercase tracking-wider\">\n        {label}\n      </label>\n      <div className=\"flex gap-2\">\n        {options.map((opt) => {\n          const isActive = value === opt.value;\n          return (\n            <button\n              key={opt.value}\n              type=\"button\"\n              onClick={() => onChange(opt.value)}\n              className={`flex-1 px-4 py-2.5 rounded-lg text-xs font-medium border transition-all ${\n                isActive\n                  ? \"bg-emerald-600 border-emerald-600 text-white shadow-sm ring-2 ring-emerald-100\"\n                  : \"bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300\"\n              }`}\n            >\n              {opt.label}\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"space-y-8 animate-in fade-in zoom-in-95 duration-200\">\n      <div>\n        <h3 className=\"text-sm font-medium text-slate-900 mb-1\">Status</h3>\n        <p className=\"text-xs text-slate-500\">\n          Filter contacts based on their opt-in status and availability.\n        </p>\n      </div>\n\n      <div className=\"space-y-6\">\n        <RadioGroup\n          label=\"Marketing Opt-in\"\n          value={filters.optedIn}\n          onChange={(v) => setField(\"optedIn\", v)}\n          options={[\n            { value: \"all\", label: \"All Contacts\" },\n            { value: \"yes\", label: \"Opted In\" },\n            { value: \"no\", label: \"Opted Out\" },\n          ]}\n        />\n        <div className=\"h-px bg-slate-100\" />\n        <RadioGroup\n          label=\"Incoming Messages\"\n          value={filters.incomingBlocked}\n          onChange={(v) => setField(\"incomingBlocked\", v)}\n          options={[\n            { value: \"all\", label: \"All Contacts\" },\n            { value: \"yes\", label: \"Incoming Blocked\" },\n            { value: \"no\", label: \"Allowed\" },\n          ]}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction TagsTab({\n  filters,\n  setField,\n  tags,\n  loadingTags,\n  tagQuery,\n  setTagQuery,\n  toggleTag,\n}) {\n  const selectedTagIds = Array.isArray(filters.tagIds) ? filters.tagIds : [];\n  const normalizedTagQuery = tagQuery.trim().toLowerCase();\n  const visibleTags =\n    normalizedTagQuery.length === 0\n      ? tags\n      : tags.filter((t) =>\n          String(t?.name || \"\")\n            .toLowerCase()\n            .includes(normalizedTagQuery)\n        );\n\n  return (\n    <div className=\"flex flex-col h-full animate-in fade-in zoom-in-95 duration-200\">\n      <div className=\"flex-none mb-4\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h3 className=\"text-sm font-medium text-slate-900 mb-1\">Tags</h3>\n            <p className=\"text-xs text-slate-500\">\n              Select tags to include in your filter.\n            </p>\n          </div>\n          {selectedTagIds.length > 0 && (\n            <button\n              onClick={() => setField(\"tagIds\", [])}\n              className=\"text-[11px] font-medium text-red-600 hover:bg-red-50 px-2 py-1 rounded transition-colors\"\n            >\n              Clear selection\n            </button>\n          )}\n        </div>\n\n        <div className=\"flex flex-col gap-3\">\n          {/* Match Mode */}\n          <div className=\"flex bg-slate-100 p-1 rounded-lg self-start\">\n            <button\n              type=\"button\"\n              onClick={() => setField(\"tagMatch\", \"any\")}\n              className={`px-3 py-1 text-[11px] font-medium rounded-md transition-all ${\n                filters.tagMatch === \"any\"\n                  ? \"bg-white text-slate-900 shadow-sm\"\n                  : \"text-slate-500 hover:text-slate-700\"\n              }`}\n            >\n              Match Any\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setField(\"tagMatch\", \"all\")}\n              className={`px-3 py-1 text-[11px] font-medium rounded-md transition-all ${\n                filters.tagMatch === \"all\"\n                  ? \"bg-white text-slate-900 shadow-sm\"\n                  : \"text-slate-500 hover:text-slate-700\"\n              }`}\n            >\n              Match All\n            </button>\n          </div>\n\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-slate-400\" />\n            <input\n              value={tagQuery}\n              onChange={(e) => setTagQuery(e.target.value)}\n              placeholder=\"Search tags...\"\n              className=\"w-full pl-9 pr-4 py-2 text-xs rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-colors\"\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto pr-2 -mr-2\">\n        {loadingTags ? (\n          <div className=\"py-8 text-center text-xs text-slate-500\">\n            <RefreshCw className=\"h-4 w-4 mx-auto mb-2 animate-spin text-slate-400\" />\n            Loading tags...\n          </div>\n        ) : visibleTags.length === 0 ? (\n          <div className=\"py-8 text-center text-xs text-slate-500\">\n            No tags found.\n          </div>\n        ) : (\n          <div className=\"flex flex-wrap gap-2\">\n            {visibleTags.map((tag) => {\n              const id = String(tag.id);\n              const isSelected = selectedTagIds.includes(id);\n              return (\n                <button\n                  key={id}\n                  type=\"button\"\n                  onClick={() => toggleTag(id)}\n                  className={`group relative flex items-center pr-3 pl-2.5 py-1.5 rounded-md border text-[11px] font-medium transition-all ${\n                    isSelected\n                      ? \"bg-emerald-50 border-emerald-200 text-emerald-900\"\n                      : \"bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50\"\n                  }`}\n                >\n                  <span\n                    className={`w-2 h-2 rounded-full mr-2 ${\n                      isSelected ? \"ring-2 ring-emerald-100\" : \"\"\n                    }`}\n                    style={{ backgroundColor: tag.colorHex || \"#10B981\" }}\n                  />\n                  {tag.name}\n                  {isSelected && (\n                    <Check className=\"ml-2 h-3 w-3 text-emerald-600\" />\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction DateRangeTab({\n  title,\n  presets,\n  presetKey,\n  from,\n  to,\n  onPreset,\n  onFrom,\n  onTo,\n}) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <label className=\"text-xs font-bold text-slate-700 uppercase tracking-wider\">\n          {title}\n        </label>\n      </div>\n\n      {/* Presets Grid */}\n      <div className=\"grid grid-cols-4 gap-2\">\n        {presets.map((p) => (\n          <button\n            key={p.key}\n            type=\"button\"\n            onClick={() => onPreset(p.key)}\n            className={`px-3 py-2 text-[11px] font-medium rounded-lg border transition-all ${\n              presetKey === p.key\n                ? \"bg-emerald-600 border-emerald-600 text-white\"\n                : \"bg-white border-slate-200 text-slate-600 hover:bg-slate-50\"\n            }`}\n          >\n            {p.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Custom Range */}\n      <div className=\"flex items-center gap-3 bg-slate-50 p-3 rounded-lg border border-slate-200\">\n        <div className=\"flex-1 space-y-1\">\n          <span className=\"text-[10px] uppercase text-slate-400 font-semibold pl-1\">\n            From\n          </span>\n          <input\n            type=\"date\"\n            value={from || \"\"}\n            onChange={onFrom}\n            className=\"w-full text-xs bg-white border border-slate-200 rounded px-2 py-1.5 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500\"\n          />\n        </div>\n        <div className=\"pt-4 text-slate-400\"></div>\n        <div className=\"flex-1 space-y-1\">\n          <span className=\"text-[10px] uppercase text-slate-400 font-semibold pl-1\">\n            To\n          </span>\n          <input\n            type=\"date\"\n            value={to || \"\"}\n            onChange={onTo}\n            className=\"w-full text-xs bg-white border border-slate-200 rounded px-2 py-1.5 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction AttributesTab({\n  filters,\n  setFilters,\n  attributeDefs,\n  loadingAttributes,\n}) {\n  const addRow = () => {\n    setFilters((prev) => ({\n      ...prev,\n      attributes: [\n        ...(Array.isArray(prev.attributes) ? prev.attributes : []),\n        { fieldId: \"\", op: \"is\", value: \"\", join: \"and\" },\n      ],\n    }));\n  };\n\n  const updateRow = (index, patch) => {\n    setFilters((prev) => {\n      const rows = Array.isArray(prev.attributes) ? [...prev.attributes] : [];\n      rows[index] = { ...rows[index], ...patch };\n      return { ...prev, attributes: rows };\n    });\n  };\n\n  const removeRow = (index) => {\n    setFilters((prev) => {\n      const rows = Array.isArray(prev.attributes) ? [...prev.attributes] : [];\n      rows.splice(index, 1);\n      return { ...prev, attributes: rows };\n    });\n  };\n\n  return (\n    <div className=\"flex flex-col h-full animate-in fade-in zoom-in-95 duration-200\">\n      <div className=\"flex-none mb-4\">\n        <h3 className=\"text-sm font-medium text-slate-900 mb-1\">\n          Custom Attributes\n        </h3>\n        <p className=\"text-xs text-slate-500\">\n          Construct advanced queries based on custom fields.\n        </p>\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto pr-2 -mr-2\">\n        {loadingAttributes ? (\n          <div className=\"py-8 text-center text-xs text-slate-500\">\n            <RefreshCw className=\"h-4 w-4 mx-auto mb-2 animate-spin text-slate-400\" />\n            Loading definitions...\n          </div>\n        ) : attributeDefs.length === 0 ? (\n          <div className=\"py-12 flex flex-col items-center justify-center text-slate-500 bg-slate-50 rounded-lg border border-dashed border-slate-200\">\n            <Hash className=\"h-8 w-8 text-slate-300 mb-2\" />\n            <p className=\"text-xs\">No attribute definitions found.</p>\n            <p className=\"text-[10px] mt-1 text-slate-400\">\n              Create custom fields in CRM settings first.\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {(filters.attributes || []).map((row, idx) => (\n              <div\n                key={idx}\n                className=\"group relative flex items-start gap-2 p-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-emerald-200 hover:shadow-md transition-all sm:items-center\"\n              >\n                {/* Join Operator (AND/OR) */}\n                {idx > 0 && (\n                  <div className=\"absolute -top-5 left-8 px-1.5 py-0.5 bg-slate-100 text-[9px] font-bold text-slate-500 rounded border border-slate-200 z-10\">\n                    {row.join === \"or\" ? \"OR\" : \"AND\"}\n                  </div>\n                )}\n\n                <div className=\"flex-1 grid grid-cols-1 sm:grid-cols-12 gap-2\">\n                  {/* Field Select */}\n                  <div className=\"sm:col-span-5\">\n                    <select\n                      value={row.fieldId || \"\"}\n                      onChange={(e) => updateRow(idx, { fieldId: e.target.value })}\n                      className=\"w-full text-xs bg-slate-50 border-0 rounded-lg px-2 py-2 font-medium text-slate-700 focus:ring-1 focus:ring-emerald-500\"\n                    >\n                      <option value=\"\" disabled>\n                        Select Attribute...\n                      </option>\n                      {attributeDefs.map((def) => (\n                        <option key={def.id} value={def.id}>\n                          {def.label || def.key}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n\n                  {/* Operator */}\n                  <div className=\"sm:col-span-3\">\n                    <select\n                      value={row.op || \"is\"}\n                      onChange={(e) => updateRow(idx, { op: e.target.value })}\n                      className=\"w-full text-xs bg-slate-50 border-0 rounded-lg px-2 py-2 text-slate-600 focus:ring-1 focus:ring-emerald-500 text-center\"\n                    >\n                      <option value=\"is\">is exactly</option>\n                      <option value=\"contains\">contains</option>\n                    </select>\n                  </div>\n\n                  {/* Value Input */}\n                  <div className=\"sm:col-span-4\">\n                    <input\n                      value={row.value || \"\"}\n                      onChange={(e) => updateRow(idx, { value: e.target.value })}\n                      placeholder=\"Enter value...\"\n                      className=\"w-full text-xs bg-white border border-slate-200 rounded-lg px-3 py-2 text-slate-900 placeholder:text-slate-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none\"\n                    />\n                  </div>\n                </div>\n\n                {/* Remove Button */}\n                <button\n                  type=\"button\"\n                  onClick={() => removeRow(idx)}\n                  className=\"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </button>\n\n                {/* Join Toggle (Bottom) */}\n                {idx < (filters.attributes || []).length - 1 && (\n                  <select\n                    value={row.join || \"and\"}\n                    onChange={(e) => updateRow(idx, { join: e.target.value })}\n                    className=\"absolute -bottom-3 right-4 h-6 text-[10px] font-bold uppercase bg-slate-50 border border-slate-200 rounded px-1 text-slate-500 focus:outline-none focus:border-emerald-500\"\n                  >\n                    <option value=\"and\">AND</option>\n                    <option value=\"or\">OR</option>\n                  </select>\n                )}\n              </div>\n            ))}\n\n            <button\n              type=\"button\"\n              onClick={addRow}\n              className=\"flex items-center gap-2 px-3 py-2 text-xs font-medium text-emerald-700 bg-emerald-50 hover:bg-emerald-100 rounded-lg border border-emerald-200 border-dashed w-full justify-center transition-colors\"\n            >\n              <Plus className=\"h-3.5 w-3.5\" />\n              Add Condition\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// \n// Main Modal Container\n// \n\nexport default function ContactsFilterModal({\n  isOpen,\n  initialFilters,\n  onClose,\n  onApply,\n  onClear,\n}) {\n  const [filters, setFilters] = useState(\n    initialFilters || DEFAULT_CONTACT_FILTERS\n  );\n  const [activeSection, setActiveSection] = useState(\"dates\");\n  const [tags, setTags] = useState([]);\n  const [loadingTags, setLoadingTags] = useState(false);\n  const [attributeDefs, setAttributeDefs] = useState([]);\n  const [loadingAttributes, setLoadingAttributes] = useState(false);\n  const [tagQuery, setTagQuery] = useState(\"\");\n\n  //  Reset when opening\n  React.useEffect(() => {\n    if (!isOpen) return;\n    setFilters(initialFilters || DEFAULT_CONTACT_FILTERS);\n    setTagQuery(\"\");\n    setActiveSection(\"dates\");\n  }, [isOpen, initialFilters]);\n\n  //  Load Tags\n  React.useEffect(() => {\n    if (!isOpen) return;\n    (async () => {\n      setLoadingTags(true);\n      try {\n        const list = await fetchAllTags();\n        setTags(list);\n      } catch {\n        toast.error(\"Failed to load tags.\");\n        setTags([]);\n      } finally {\n        setLoadingTags(false);\n      }\n    })();\n  }, [isOpen]);\n\n  //  Load Attributes\n  React.useEffect(() => {\n    if (!isOpen) return;\n    (async () => {\n      setLoadingAttributes(true);\n      try {\n        const defs = await getCustomFieldDefinitions({ entityType: \"Contact\" });\n        setAttributeDefs(Array.isArray(defs) ? defs : []);\n      } catch {\n        setAttributeDefs([]);\n      } finally {\n        setLoadingAttributes(false);\n      }\n    })();\n  }, [isOpen]);\n\n  //  Helpers\n  const setField = (key, value) => {\n    setFilters((prev) => ({ ...prev, [key]: value }));\n  };\n\n  const toggleTag = (tagId) => {\n    setFilters((prev) => {\n      const current = Array.isArray(prev.tagIds) ? prev.tagIds : [];\n      const id = String(tagId);\n      const updated = current.includes(id)\n        ? current.filter((t) => t !== id)\n        : [...current, id];\n      return { ...prev, tagIds: updated };\n    });\n  };\n\n  const applyPreset = (section, presetKey) => {\n    const { from, to } = presetToRange(presetKey);\n    const prefix = section === \"lastSeen\" ? \"lastSeen\" : \"created\";\n    setFilters((prev) => ({\n      ...prev,\n      [`${prefix}Preset`]: presetKey,\n      [`${prefix}From`]: toDateInputValue(from),\n      [`${prefix}To`]: toDateInputValue(to),\n    }));\n  };\n\n  const handleClearAll = () => {\n    setFilters(DEFAULT_CONTACT_FILTERS);\n    setTagQuery(\"\");\n    onClear?.();\n  };\n\n  if (!isOpen) return null;\n\n  //  Count Logic\n  const getSectionCount = (id) => {\n    let c = 0;\n    if (id === \"status\") {\n      if (filters.optedIn && filters.optedIn !== \"all\") c++;\n      if (filters.incomingBlocked && filters.incomingBlocked !== \"all\") c++;\n    }\n    if (id === \"tags\") {\n      if (filters.tagIds?.length > 0) c += filters.tagIds.length;\n    }\n    if (id === \"dates\") {\n      if (filters.lastSeenFrom || filters.lastSeenTo) c++;\n      if (filters.createdFrom || filters.createdTo) c++;\n    }\n    if (id === \"attributes\") {\n      if (filters.attributes?.length > 0) c += filters.attributes.length;\n    }\n    return c;\n  };\n\n  const totalApplied =\n    getSectionCount(\"status\") +\n    getSectionCount(\"tags\") +\n    getSectionCount(\"dates\") +\n    getSectionCount(\"attributes\");\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 sm:p-6\"\n      onMouseDown={onClose}\n    >\n      <div\n        className=\"w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[600px] max-h-[90vh]\"\n        onMouseDown={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex-none px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-white\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-xl bg-emerald-50 text-emerald-600 flex items-center justify-center border border-emerald-100\">\n              <Filter className=\"h-5 w-5\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-semibold text-slate-900\">Filters</h2>\n              <p className=\"text-xs text-slate-500\">\n                Refine your contact list with advanced conditions.\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-lg transition-colors\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        {/* Body (Sidebar + Content) */}\n        <div className=\"flex-1 flex overflow-hidden\">\n          {/* Sidebar */}\n          <div className=\"w-56 bg-slate-50 border-r border-slate-100 p-3 flex flex-col gap-1 overflow-y-auto\">\n            {SECTIONS.map((section) => {\n              const isActive = activeSection === section.id;\n              const count = getSectionCount(section.id);\n              const Icon = section.icon;\n\n              return (\n                <button\n                  key={section.id}\n                  onClick={() => setActiveSection(section.id)}\n                  className={`flex items-center justify-between px-3 py-2.5 rounded-lg text-xs font-medium transition-all group ${\n                    isActive\n                      ? \"bg-white text-emerald-700 shadow-sm ring-1 ring-slate-200\"\n                      : \"text-slate-600 hover:bg-slate-100 hover:text-slate-900\"\n                  }`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Icon\n                      className={`h-4 w-4 ${\n                        isActive ? \"text-emerald-500\" : \"text-slate-400 group-hover:text-slate-500\"\n                      }`}\n                    />\n                    {section.label}\n                  </div>\n                  {count > 0 && (\n                    <span className=\"flex items-center justify-center h-5 min-w-[20px] px-1 rounded-full bg-emerald-100 text-emerald-700 text-[10px] font-bold\">\n                      {count}\n                    </span>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n\n          {/* Content Panel */}\n          <div className=\"flex-1 p-6 bg-white overflow-y-auto relative\">\n            {activeSection === \"status\" && (\n              <StatusTab filters={filters} setField={setField} />\n            )}\n\n            {activeSection === \"tags\" && (\n              <TagsTab\n                filters={filters}\n                setField={setField}\n                tags={tags}\n                loadingTags={loadingTags}\n                tagQuery={tagQuery}\n                setTagQuery={setTagQuery}\n                toggleTag={toggleTag}\n              />\n            )}\n\n            {activeSection === \"dates\" && (\n              <div className=\"space-y-8 animate-in fade-in zoom-in-95 duration-200\">\n                <DateRangeTab\n                  title=\"Last Seen\"\n                  presetKey={filters.lastSeenPreset}\n                  presets={[\n                    { key: \"24h\", label: \"Last 24h\" },\n                    { key: \"week\", label: \"Last 7 Days\" },\n                    { key: \"month\", label: \"Last 30 Days\" },\n                  ]}\n                  onPreset={(k) => applyPreset(\"lastSeen\", k)}\n                  from={filters.lastSeenFrom}\n                  to={filters.lastSeenTo}\n                  onFrom={(e) => {\n                    setField(\"lastSeenPreset\", \"\");\n                    setField(\"lastSeenFrom\", e.target.value);\n                  }}\n                  onTo={(e) => {\n                    setField(\"lastSeenPreset\", \"\");\n                    setField(\"lastSeenTo\", e.target.value);\n                  }}\n                />\n\n                <div className=\"h-px bg-slate-100\" />\n\n                <DateRangeTab\n                  title=\"Created Date\"\n                  presetKey={filters.createdPreset}\n                  presets={[\n                    { key: \"today\", label: \"Today\" },\n                    { key: \"week\", label: \"Last 7 Days\" },\n                    { key: \"month\", label: \"Last 30 Days\" },\n                  ]}\n                  onPreset={(k) => applyPreset(\"created\", k)}\n                  from={filters.createdFrom}\n                  to={filters.createdTo}\n                  onFrom={(e) => {\n                    setField(\"createdPreset\", \"\");\n                    setField(\"createdFrom\", e.target.value);\n                  }}\n                  onTo={(e) => {\n                    setField(\"createdPreset\", \"\");\n                    setField(\"createdTo\", e.target.value);\n                  }}\n                />\n              </div>\n            )}\n\n            {activeSection === \"attributes\" && (\n              <AttributesTab\n                filters={filters}\n                setFilters={setFilters}\n                attributeDefs={attributeDefs}\n                loadingAttributes={loadingAttributes}\n              />\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex-none px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <button\n              onClick={handleClearAll}\n              disabled={totalApplied === 0}\n              className=\"group flex items-center gap-2 text-xs font-semibold text-slate-500 hover:text-red-600 disabled:opacity-50 disabled:hover:text-slate-500 transition-colors\"\n            >\n              <Trash2 className=\"h-4 w-4 group-hover:text-red-600 transition-colors\" />\n              Reset All\n            </button> \n            {totalApplied > 0 && (\n              <span className=\"text-xs text-slate-400\">\n                {totalApplied} filter{totalApplied !== 1 ? \"s\" : \"\"} active\n              </span>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 text-xs font-semibold text-slate-700 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors shadow-sm\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={() => {\n                onApply?.(filters);\n                onClose?.();\n              }}\n              className=\"px-6 py-2 text-xs font-semibold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 shadow-sm shadow-emerald-200 hover:shadow-emerald-300 transition-all active:scale-[0.98]\"\n            >\n              Apply Filters\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","//  src/pages/CRM/Contacts/Contacts.jsx\r\n\r\nimport React, { useState } from \"react\";\r\nimport { User } from \"lucide-react\";\r\n\r\nimport ContactsTopBar from \"./components/ContactsTopBar\";\r\nimport ContactsTable from \"./components/ContactsTable\";\r\nimport ContactFormModal from \"./components/ContactFormModal\";\r\nimport BulkActionsBar from \"./components/BulkActionsBar\";\r\nimport CsvUploadModal from \"./CsvUploadModal\";\r\nimport ContactsFilterModal, {\r\n  DEFAULT_CONTACT_FILTERS,\r\n} from \"./components/ContactsFilterModal\";\r\n\r\nexport default function Contacts() {\r\n  //  UI state\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [editingContact, setEditingContact] = useState(null);\r\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n  const [activeTab, setActiveTab] = useState(\"all\");\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [selectedIds, setSelectedIds] = useState([]);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [isImporting, setIsImporting] = useState(false);\r\n  const [isImportModalOpen, setIsImportModalOpen] = useState(false);\r\n  const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);\r\n  const [filters, setFilters] = useState(DEFAULT_CONTACT_FILTERS);\r\n\r\n  // \r\n  // Handlers\r\n  // \r\n  const handleAddClick = () => {\r\n    setEditingContact(null);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleEditContact = contact => {\r\n    setEditingContact(contact);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleModalClose = () => {\r\n    setIsModalOpen(false);\r\n    setEditingContact(null);\r\n  };\r\n\r\n  const handleSaveComplete = () => {\r\n    setRefreshTrigger(prev => prev + 1);\r\n  };\r\n\r\n  const handleSelectionChange = ids => {\r\n    setSelectedIds(ids || []);\r\n  };\r\n\r\n  const handleTabChange = tab => {\r\n    setActiveTab(tab);\r\n    setCurrentPage(1);\r\n    setSelectedIds([]);\r\n  };\r\n\r\n  const handleClearSelection = () => {\r\n    setSelectedIds([]);\r\n  };\r\n\r\n  const handleRefreshList = () => {\r\n    setRefreshTrigger(prev => prev + 1);\r\n  };\r\n\r\n  const handleApplyFilters = nextFilters => {\r\n    setFilters(nextFilters || DEFAULT_CONTACT_FILTERS);\r\n    setCurrentPage(1);\r\n    setSelectedIds([]);\r\n    setRefreshTrigger(prev => prev + 1);\r\n  };\r\n\r\n  const handleClearFilters = () => {\r\n    setFilters(DEFAULT_CONTACT_FILTERS);\r\n    setCurrentPage(1);\r\n    setSelectedIds([]);\r\n    setRefreshTrigger(prev => prev + 1);\r\n  };\r\n\r\n  const handleImportClick = () => {\r\n    if (isImporting) return;\r\n    setIsImportModalOpen(true);\r\n  };\r\n\r\n  const handleImportModalClose = () => {\r\n    setIsImportModalOpen(false);\r\n  };\r\n\r\n    const handleDownloadSample = () => {\r\n    const headers = [\"Name\", \"PhoneNumber\", \"Email\", \"LeadSource\", \"Notes\"];\r\n    const formatPhoneForCsv = value => {\r\n      const text = String(value ?? \"\").trim();\r\n      if (!text) return \"\";\r\n      const looksNumeric = /^[+]?\\d{10,15}$/.test(text);\r\n      return looksNumeric ? `'${text}` : text;\r\n    };\r\n    const rows = [\r\n      [\r\n        \"Rahul Sharma\",\r\n        formatPhoneForCsv(\"9876543210\"),\r\n        \"rahul@example.com\",\r\n        \"Facebook\",\r\n        \"Interested in pricing, follow up next week\",\r\n      ],\r\n      [\r\n        \"Ananya Gupta\",\r\n        formatPhoneForCsv(\"+919123456789\"),\r\n        \"ananya.gupta@example.com\",\r\n        \"Website Form\",\r\n        \"Requested onboarding details\",\r\n      ],\r\n      [\r\n        \"Vikram Singh\",\r\n        formatPhoneForCsv(\"9988776655\"),\r\n        \"vikram.singh@example.com\",\r\n        \"Referral\",\r\n        \"Met at trade show\",\r\n      ],\r\n    ];\r\n\r\n    const escapeCsv = value => {\r\n      const text = String(value ?? \"\");\r\n      if (/[\",\\n]/.test(text)) {\r\n        return `\"${text.replace(/\"/g, '\"\"')}\"`;\r\n      }\r\n      return text;\r\n    };\r\n\r\n    const csv = [headers, ...rows]\r\n      .map(row => row.map(escapeCsv).join(\",\"))\r\n      .join(\"\\r\\n\");\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement(\"a\");\r\n    link.href = url;\r\n    link.download = \"xbytechat_contacts_sample.csv\";\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n\r\n\r\n  // \r\n  // Render\r\n  // \r\n  return (\r\n    <div className=\"min-h-[calc(100vh-80px)] bg-[#f5f6f7]\">\r\n      <div className=\"max-w-7xl mx-auto px-5 sm:px-6 pt-6 pb-8\">\r\n        {/* Workspace header */}\n        <div className=\"mb-5\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"hidden sm:flex h-12 w-12 items-center justify-center rounded-2xl bg-white border border-emerald-200/60 shadow-sm\">\n                <div className=\"h-10 w-10 rounded-2xl bg-emerald-100 flex items-center justify-center\">\n                  <User className=\"h-5 w-5 text-emerald-800\" />\n                </div>\n              </div>\n\n              <div>\n                <h1 className=\"mt-1.5 text-xl font-semibold text-slate-900\">\n                  Contacts\n                </h1>\n\n                <p className=\"mt-1 text-sm text-slate-600 max-w-2xl\">\n                  Organize leads, segment customers, and run bulk actions.\n                </p>\n\n                <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n                  <span className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-emerald-50 text-emerald-800 border border-emerald-200/60\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-600\" />\n                    Active tab: {activeTab}\n                  </span>\n\n                  <span className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-white text-slate-700 border border-slate-200\">\n                    Selected: {selectedIds.length}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\r\n        {/* Main module card */}\r\n        <div className=\"bg-white/90 backdrop-blur rounded-2xl border border-slate-100 shadow-sm overflow-hidden\">\r\n          <div className=\"bg-white\">\r\n            <div className=\"border-b border-slate-100\">\r\n              <ContactsTopBar\r\n                onAddClick={handleAddClick}\r\n                onSearchChange={setSearchTerm}\r\n                activeTab={activeTab}\r\n                onTabChange={handleTabChange}\r\n                searchTerm={searchTerm}\r\n                onFilterClick={() => setIsFilterModalOpen(true)}\r\n                onImportClick={handleImportClick}\r\n                importing={isImporting}\r\n                onDownloadSample={handleDownloadSample}\r\n              />\r\n            </div>\r\n\r\n            {selectedIds.length > 0 && (\r\n              <div className=\"border-b border-slate-100 bg-emerald-50/50\">\r\n                <BulkActionsBar\r\n                  selectedIds={selectedIds}\r\n                  onClearSelection={handleClearSelection}\r\n                  onRefresh={handleRefreshList}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"bg-white\">\r\n            <div>\r\n              <ContactsTable\r\n                onEdit={handleEditContact}\r\n                refreshTrigger={refreshTrigger}\r\n                activeTab={activeTab}\r\n                onSelectionChange={handleSelectionChange}\r\n                selectedIds={selectedIds}\r\n                searchTerm={searchTerm}\r\n                filters={filters}\r\n                currentPage={currentPage}\r\n                setCurrentPage={setCurrentPage}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <ContactsFilterModal\r\n          isOpen={isFilterModalOpen}\r\n          initialFilters={filters}\r\n          onClose={() => setIsFilterModalOpen(false)}\r\n          onApply={handleApplyFilters}\r\n          onClear={handleClearFilters}\r\n        />\r\n\r\n        <ContactFormModal\r\n          isOpen={isModalOpen}\r\n          onClose={handleModalClose}\r\n          contact={editingContact}\r\n          onSaveComplete={handleSaveComplete}\r\n        />\r\n        <CsvUploadModal\r\n          isOpen={isImportModalOpen}\r\n          onClose={handleImportModalClose}\r\n          onRefresh={handleRefreshList}\r\n          onImportingChange={setIsImporting}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// //  src/pages/CRM/Contacts/Contacts.jsx\r\n\r\n// import React, { useEffect, useMemo, useState } from \"react\";\r\n// import { useLocation } from \"react-router-dom\";\r\n// import {\r\n//   User,\r\n//   Tag,\r\n//   Clock,\r\n//   StickyNote,\r\n//   Bell,\r\n//   Activity,\r\n//   Filter,\r\n// } from \"lucide-react\";\r\n// import { toast } from \"react-toastify\";\r\n\r\n// import axiosClient from \"../../../api/axiosClient\";\r\n\r\n// import ContactsTopBar from \"./components/ContactsTopBar\";\r\n// import ContactsTable from \"./components/ContactsTable\";\r\n// import ContactFormModal from \"./components/ContactFormModal\";\r\n// import BulkActionsBar from \"./components/BulkActionsBar\";\r\n\r\n// function formatDateTime(value) {\r\n//   if (!value) return \"-\";\r\n//   try {\r\n//     return new Date(value).toLocaleString();\r\n//   } catch {\r\n//     return String(value);\r\n//   }\r\n// }\r\n\r\n// export default function Contacts() {\r\n//   /**\r\n//    *  Product decision (for now):\r\n//    * Keep Contact 360 code intact, but hide it from the UI until we finalize Inbox CRM panel integration.\r\n//    */\r\n//   const SHOW_CONTACT_360_PANEL = false;\r\n\r\n//   //  UI state for list side\r\n//   const [isModalOpen, setIsModalOpen] = useState(false);\r\n//   const [editingContact, setEditingContact] = useState(null);\r\n//   const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n//   const [activeTab, setActiveTab] = useState(\"all\");\r\n//   const [searchTerm, setSearchTerm] = useState(\"\");\r\n//   const [selectedIds, setSelectedIds] = useState([]);\r\n//   const [currentPage, setCurrentPage] = useState(1);\r\n//   const [density, setDensity] = useState(() => {\r\n//     try {\r\n//       return localStorage.getItem(\"crm.contacts.density\") || \"comfortable\";\r\n//     } catch {\r\n//       return \"comfortable\";\r\n//     }\r\n//   });\r\n\r\n//   //  URL -> contactId (for deep-link from Chat Inbox)\r\n//   const location = useLocation();\r\n//   const [focusedContactId, setFocusedContactId] = useState(null);\r\n\r\n//   //  Contact 360 summary data (kept for later)\r\n//   const [contactSummary, setContactSummary] = useState(null);\r\n//   const [isSummaryLoading, setIsSummaryLoading] = useState(false);\r\n\r\n//   // \r\n//   // 1) Hydrate focusedContactId from URL (?contactId=...)\r\n//   // \r\n//   useEffect(() => {\r\n//     const params = new URLSearchParams(location.search);\r\n//     const idFromUrl = params.get(\"contactId\");\r\n\r\n//     if (idFromUrl) {\r\n//       setFocusedContactId(idFromUrl);\r\n\r\n//       // Keep selection aligned so bulk actions make sense\r\n//       setSelectedIds(prev =>\r\n//         prev && prev.length > 0 && prev.includes(idFromUrl) ? prev : [idFromUrl]\r\n//       );\r\n//     }\r\n//   }, [location.search]);\r\n\r\n//   // \r\n//   // 2) Selection -> focus logic (kept for future 360 usage)\r\n//   // \r\n//   useEffect(() => {\r\n//     const params = new URLSearchParams(location.search);\r\n//     const idFromUrl = params.get(\"contactId\");\r\n\r\n//     if (idFromUrl) return;\r\n\r\n//     if (!selectedIds || selectedIds.length === 0) {\r\n//       setFocusedContactId(null);\r\n//       setContactSummary(null);\r\n//       return;\r\n//     }\r\n\r\n//     if (selectedIds.length === 1) {\r\n//       setFocusedContactId(selectedIds[0]);\r\n//       return;\r\n//     }\r\n//   }, [selectedIds, location.search]);\r\n\r\n//   // \r\n//   // 3) Handlers\r\n//   // \r\n//   const handleAddClick = () => {\r\n//     setEditingContact(null);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleEditContact = contact => {\r\n//     setEditingContact(contact);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleModalClose = () => {\r\n//     setIsModalOpen(false);\r\n//     setEditingContact(null);\r\n//   };\r\n\r\n//   const handleSaveComplete = () => {\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   const handleSelectionChange = ids => {\r\n//     setSelectedIds(ids || []);\r\n//   };\r\n\r\n//   const handleTabChange = tab => {\r\n//     setActiveTab(tab);\r\n//     setCurrentPage(1);\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleClearSelection = () => {\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleRefreshList = () => {\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   const handleDensityChange = next => {\r\n//     setDensity(next);\r\n//     try {\r\n//       localStorage.setItem(\"crm.contacts.density\", next);\r\n//     } catch {\r\n//       // ignore storage errors\r\n//     }\r\n//   };\r\n\r\n//   // \r\n//   // 4) Fetch Contact 360 summary (disabled while panel hidden)\r\n//   // \r\n//   useEffect(() => {\r\n//     if (!SHOW_CONTACT_360_PANEL) return;\r\n\r\n//     const contactId = focusedContactId;\r\n//     if (!contactId) return;\r\n\r\n//     let cancelled = false;\r\n\r\n//     const loadSummary = async () => {\r\n//       try {\r\n//         setIsSummaryLoading(true);\r\n//         const response = await axiosClient.get(\r\n//           `/crm/contact-summary/${contactId}`\r\n//         );\r\n//         if (cancelled) return;\r\n//         setContactSummary(response.data || null);\r\n//       } catch (error) {\r\n//         if (cancelled) return;\r\n//         console.error(\"Failed to load contact summary\", error);\r\n//         toast.error(\r\n//           error?.response?.data?.message ||\r\n//             \"Failed to load Contact 360 summary.\"\r\n//         );\r\n//         setContactSummary(null);\r\n//       } finally {\r\n//         if (!cancelled) setIsSummaryLoading(false);\r\n//       }\r\n//     };\r\n\r\n//     loadSummary();\r\n\r\n//     return () => {\r\n//       cancelled = true;\r\n//     };\r\n//   }, [focusedContactId, SHOW_CONTACT_360_PANEL]);\r\n\r\n//   // \r\n//   // 5) Derived CRM slices (kept for later)\r\n//   // \r\n//   const tagsList = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     if (Array.isArray(contactSummary.tags)) return contactSummary.tags;\r\n//     if (Array.isArray(contactSummary.contactTags))\r\n//       return contactSummary.contactTags;\r\n//     if (Array.isArray(contactSummary.tagSummaries))\r\n//       return contactSummary.tagSummaries;\r\n//     if (Array.isArray(contactSummary.tagList)) return contactSummary.tagList;\r\n//     return [];\r\n//   }, [contactSummary]);\r\n\r\n//   const recentNotes = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const notes =\r\n//       contactSummary.recentNotes ||\r\n//       contactSummary.notes ||\r\n//       contactSummary.lastNotes ||\r\n//       [];\r\n//     return Array.isArray(notes) ? notes.slice(0, 3) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const nextReminder = useMemo(() => {\r\n//     if (!contactSummary) return null;\r\n//     return (\r\n//       contactSummary.nextReminder ||\r\n//       contactSummary.upcomingReminder ||\r\n//       contactSummary.reminder ||\r\n//       null\r\n//     );\r\n//   }, [contactSummary]);\r\n\r\n//   const recentTimeline = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const items =\r\n//       contactSummary.recentTimeline ||\r\n//       contactSummary.timeline ||\r\n//       contactSummary.events ||\r\n//       [];\r\n//     return Array.isArray(items) ? items.slice(0, 5) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const basic =\r\n//     contactSummary?.contact ||\r\n//     contactSummary?.contactBasic ||\r\n//     contactSummary?.contactInfo ||\r\n//     contactSummary ||\r\n//     null;\r\n\r\n//   const displayName =\r\n//     basic?.fullName ||\r\n//     basic?.name ||\r\n//     basic?.contactName ||\r\n//     \"Unnamed contact\";\r\n//   const displayPhone =\r\n//     basic?.phoneNumber || basic?.whatsappNumber || basic?.phone || \"\";\r\n//   const displayEmail = basic?.email || basic?.emailAddress || \"\";\r\n//   const displayStatus =\r\n//     basic?.status || basic?.lifecycleStage || basic?.stage || null;\r\n//   const createdAt =\r\n//     basic?.createdAt ||\r\n//     basic?.createdOn ||\r\n//     basic?.firstSeenAt ||\r\n//     basic?.createdDate;\r\n//   const lastInbound =\r\n//     basic?.lastInboundAt ||\r\n//     basic?.lastInboundMessageAt ||\r\n//     basic?.lastIncomingAt;\r\n//   const lastOutbound =\r\n//     basic?.lastOutboundAt ||\r\n//     basic?.lastOutboundMessageAt ||\r\n//     basic?.lastOutgoingAt;\r\n\r\n//   const multipleSelected = selectedIds.length > 1;\r\n\r\n//   // \r\n//   //  Redesigned layout (emerald-only, premium spacing + hierarchy)\r\n//   // \r\n//   return (\r\n//     <div className=\"min-h-[calc(100vh-80px)] bg-gradient-to-b from-slate-50 via-white to-slate-50\">\r\n//       {/* Soft top spacing so it never feels glued to topbar */}\r\n//       <div className=\"max-w-7xl mx-auto px-5 sm:px-6 pt-6 pb-8\">\r\n//         {/* Workspace header */}\r\n//         <div className=\"mb-5\">\r\n//           <div className=\"flex items-start justify-between gap-4\">\r\n//             <div>\r\n//               <div className=\"flex flex-wrap items-center gap-2\">\r\n//                 <span className=\"text-[11px] font-semibold uppercase tracking-wide text-emerald-700\">\r\n//                   CRM Workspace\r\n//                 </span>\r\n//                 <span className=\"text-slate-300\">/</span>\r\n//                 <span className=\"text-[11px] font-medium text-slate-500\">\r\n//                   Contacts\r\n//                 </span>\r\n//               </div>\r\n\r\n//               <h1 className=\"mt-1.5 text-xl font-semibold text-slate-900\">\r\n//                 Contacts\r\n//               </h1>\r\n\r\n//               <p className=\"mt-1 text-sm text-slate-600 max-w-2xl\">\r\n//                 Organize leads, segment customers, and keep context ready for\r\n//                 Inbox actions.\r\n//               </p>\r\n\r\n//               {/* Meta chips (subtle, premium) */}\r\n//               <div className=\"mt-3 flex flex-wrap items-center gap-2\">\r\n//                 <span className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-emerald-50 text-emerald-800 border border-emerald-200/60\">\r\n//                   <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-600\" />\r\n//                   Active tab: {activeTab}\r\n//                 </span>\r\n\r\n//                 <span className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full text-[11px] font-semibold bg-white text-slate-700 border border-slate-200\">\r\n//                   Selected: {selectedIds.length}\r\n//                 </span>\r\n//               </div>\r\n//             </div>\r\n\r\n//             {/* Brand icon tile */}\r\n//             <div className=\"hidden sm:flex h-12 w-12 items-center justify-center rounded-2xl bg-white border border-emerald-200/60 shadow-sm\">\r\n//               <div className=\"h-10 w-10 rounded-2xl bg-emerald-100 flex items-center justify-center\">\r\n//                 <User className=\"h-5 w-5 text-emerald-800\" />\r\n//               </div>\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//         {/* Main module card */}\r\n//         <div className=\"bg-white/90 backdrop-blur rounded-2xl border border-slate-100 shadow-sm overflow-hidden\">\r\n//           {/* Top controls zone */}\r\n//           <div className=\"bg-white\">\r\n//             <div className=\"border-b border-slate-100\">\r\n//               <ContactsTopBar\r\n//                 onAddClick={handleAddClick}\r\n//                 onSearchChange={setSearchTerm}\r\n//                 activeTab={activeTab}\r\n//                 onTabChange={handleTabChange}\r\n//                 searchTerm={searchTerm}\r\n//                 density={density}\r\n//                 onDensityChange={handleDensityChange}\r\n//                 onFilterClick={() =>\r\n//                   toast.info(\"Advanced filters will come in a later phase.\")\r\n//                 }\r\n//               />\r\n//             </div>\r\n\r\n//             {/* Bulk actions bar */}\r\n//             {selectedIds.length > 0 && (\r\n//               <div className=\"border-b border-slate-100 bg-emerald-50/50\">\r\n//                 <BulkActionsBar\r\n//                   selectedIds={selectedIds}\r\n//                   onClearSelection={handleClearSelection}\r\n//                   onRefresh={handleRefreshList}\r\n//                 />\r\n//               </div>\r\n//             )}\r\n//           </div>\r\n\r\n//           {/* Table stage (gives the table a clean canvas) */}\r\n//           <div className=\"bg-white\">\r\n//             <div className=\"min-h-[560px]\">\r\n//               <ContactsTable\r\n//                 onEdit={handleEditContact}\r\n//                 refreshTrigger={refreshTrigger}\r\n//                 activeTab={activeTab}\r\n//                 onSelectionChange={handleSelectionChange}\r\n//                 searchTerm={searchTerm}\r\n//                 currentPage={currentPage}\r\n//                 setCurrentPage={setCurrentPage}\r\n//                 density={density}\r\n//               />\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//         {/* Contact create/edit modal */}\r\n//         <ContactFormModal\r\n//           isOpen={isModalOpen}\r\n//           onClose={handleModalClose}\r\n//           contact={editingContact}\r\n//           onSaveComplete={handleSaveComplete}\r\n//         />\r\n//       </div>\r\n\r\n//       {/*  Contact 360 stays in code, but hidden */}\r\n//       {SHOW_CONTACT_360_PANEL && (\r\n//         <div className=\"hidden\">\r\n//           {/* Keeping the panel code alive for later decision */}\r\n//           <div className=\"hidden lg:flex w-[360px] xl:w-[380px] flex-col bg-gradient-to-b from-emerald-50/80 via-white to-emerald-50/40\">\r\n//             <div className=\"border-b border-emerald-100 px-4 py-3 bg-white/90 backdrop-blur\">\r\n//               <div className=\"flex items-center justify-between\">\r\n//                 <div>\r\n//                   <p className=\"text-[11px] font-semibold uppercase tracking-wide text-emerald-600\">\r\n//                     Contact 360\r\n//                   </p>\r\n//                   <p className=\"text-xs text-slate-500\">\r\n//                     Quick CRM snapshot for the selected contact\r\n//                   </p>\r\n//                 </div>\r\n//                 <div className=\"h-8 w-8 rounded-2xl bg-emerald-100 flex items-center justify-center\">\r\n//                   <User className=\"h-4 w-4 text-emerald-700\" />\r\n//                 </div>\r\n//               </div>\r\n//             </div>\r\n\r\n//             <div className=\"flex-1 overflow-y-auto px-4 py-3 space-y-4\">\r\n//               {!focusedContactId && !isSummaryLoading && !multipleSelected && (\r\n//                 <div className=\"mt-10 text-center text-slate-500 text-sm\">\r\n//                   <div className=\"mx-auto mb-3 flex h-11 w-11 items-center justify-center rounded-2xl bg-emerald-50\">\r\n//                     <Filter className=\"h-4 w-4 text-emerald-600\" />\r\n//                   </div>\r\n//                   <p className=\"font-medium text-slate-800\">\r\n//                     No contact selected yet\r\n//                   </p>\r\n//                   <p className=\"mt-1 text-xs text-slate-500\">\r\n//                     Select a contact from the list (or open this page from Chat\r\n//                     Inbox) to see their full CRM profile.\r\n//                   </p>\r\n//                 </div>\r\n//               )}\r\n\r\n//               {multipleSelected && (\r\n//                 <div className=\"mt-10 text-center text-slate-500 text-sm\">\r\n//                   <div className=\"mx-auto mb-3 flex h-11 w-11 items-center justify-center rounded-2xl bg-emerald-50\">\r\n//                     <Activity className=\"h-4 w-4 text-emerald-600\" />\r\n//                   </div>\r\n//                   <p className=\"font-medium text-slate-800\">\r\n//                     Multiple contacts selected\r\n//                   </p>\r\n//                   <p className=\"mt-1 text-xs text-slate-500\">\r\n//                     Use the bulk actions bar for mass updates. Contact 360 is\r\n//                     available when exactly one contact is selected.\r\n//                   </p>\r\n//                 </div>\r\n//               )}\r\n\r\n//               {focusedContactId && !multipleSelected && isSummaryLoading && (\r\n//                 <div className=\"mt-6 space-y-3\">\r\n//                   <div className=\"animate-pulse space-y-3\">\r\n//                     <div className=\"h-5 w-32 rounded bg-emerald-100/70\" />\r\n//                     <div className=\"h-16 rounded-xl bg-emerald-50/80\" />\r\n//                     <div className=\"h-10 rounded-xl bg-emerald-50/70\" />\r\n//                     <div className=\"h-24 rounded-xl bg-emerald-50/60\" />\r\n//                   </div>\r\n//                 </div>\r\n//               )}\r\n\r\n//               {focusedContactId &&\r\n//                 !multipleSelected &&\r\n//                 !isSummaryLoading &&\r\n//                 contactSummary && (\r\n//                   <>\r\n//                     <div className=\"rounded-2xl border border-emerald-100 bg-white px-3 py-3 shadow-sm\">\r\n//                       <div className=\"flex items-start justify-between gap-2\">\r\n//                         <div>\r\n//                           <div className=\"text-sm font-semibold text-slate-900\">\r\n//                             {displayName}\r\n//                           </div>\r\n//                           {displayPhone && (\r\n//                             <div className=\"mt-0.5 text-xs text-slate-600 font-mono\">\r\n//                               {displayPhone}\r\n//                             </div>\r\n//                           )}\r\n//                           {displayEmail && (\r\n//                             <div className=\"mt-0.5 text-xs text-slate-500\">\r\n//                               {displayEmail}\r\n//                             </div>\r\n//                           )}\r\n//                         </div>\r\n//                         {displayStatus && (\r\n//                           <span className=\"inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-800\">\r\n//                             {displayStatus}\r\n//                           </span>\r\n//                         )}\r\n//                       </div>\r\n\r\n//                       <div className=\"mt-3 grid grid-cols-2 gap-3 text-[11px] text-slate-600\">\r\n//                         <div>\r\n//                           <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                             Created\r\n//                           </p>\r\n//                           <p className=\"mt-0.5 font-medium\">\r\n//                             {formatDateTime(createdAt)}\r\n//                           </p>\r\n//                         </div>\r\n//                         <div>\r\n//                           <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                             Last inbound\r\n//                           </p>\r\n//                           <p className=\"mt-0.5 font-medium\">\r\n//                             {formatDateTime(lastInbound)}\r\n//                           </p>\r\n//                         </div>\r\n//                         <div>\r\n//                           <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                             Last outbound\r\n//                           </p>\r\n//                           <p className=\"mt-0.5 font-medium\">\r\n//                             {formatDateTime(lastOutbound)}\r\n//                           </p>\r\n//                         </div>\r\n//                       </div>\r\n//                     </div>\r\n\r\n//                     {/* Tags / Reminders / Notes / Timeline remain unchanged */}\r\n//                     {/* (kept here intentionally for later reuse in Inbox CRM panel) */}\r\n//                   </>\r\n//                 )}\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// //  src/pages/CRM/Contacts/Contacts.jsx\r\n\r\n// import React, { useEffect, useMemo, useState } from \"react\";\r\n// import { useLocation } from \"react-router-dom\";\r\n// import {\r\n//   User,\r\n//   Tag,\r\n//   Clock,\r\n//   StickyNote,\r\n//   Bell,\r\n//   Activity,\r\n//   Filter,\r\n// } from \"lucide-react\";\r\n// import { toast } from \"react-toastify\";\r\n\r\n// import axiosClient from \"../../../api/axiosClient\";\r\n\r\n// import ContactsTopBar from \"./components/ContactsTopBar\";\r\n// import ContactsTable from \"./components/ContactsTable\";\r\n// import ContactFormModal from \"./components/ContactFormModal\";\r\n// import BulkActionsBar from \"./components/BulkActionsBar\";\r\n\r\n// function formatDateTime(value) {\r\n//   if (!value) return \"\";\r\n//   try {\r\n//     return new Date(value).toLocaleString();\r\n//   } catch {\r\n//     return String(value);\r\n//   }\r\n// }\r\n\r\n// export default function Contacts() {\r\n//   //  UI state for list side\r\n//   const [isModalOpen, setIsModalOpen] = useState(false);\r\n//   const [editingContact, setEditingContact] = useState(null);\r\n//   const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n//   const [activeTab, setActiveTab] = useState(\"all\");\r\n//   const [searchTerm, setSearchTerm] = useState(\"\");\r\n//   const [selectedIds, setSelectedIds] = useState([]);\r\n//   const [currentPage, setCurrentPage] = useState(1);\r\n\r\n//   //  URL -> contactId (for when we deep-link from Chat Inbox)\r\n//   const location = useLocation();\r\n//   const [focusedContactId, setFocusedContactId] = useState(null);\r\n\r\n//   //  Contact 360 summary data\r\n//   const [contactSummary, setContactSummary] = useState(null);\r\n//   const [isSummaryLoading, setIsSummaryLoading] = useState(false);\r\n\r\n//   // \r\n//   // 1) Hydrate focusedContactId from URL (?contactId=...)\r\n//   // \r\n//   useEffect(() => {\r\n//     const params = new URLSearchParams(location.search);\r\n//     const idFromUrl = params.get(\"contactId\");\r\n\r\n//     if (idFromUrl) {\r\n//       setFocusedContactId(idFromUrl);\r\n\r\n//       // Keep selection in a reasonable state for BulkActionsBar\r\n//       setSelectedIds(prev =>\r\n//         prev && prev.length > 0 && prev.includes(idFromUrl) ? prev : [idFromUrl]\r\n//       );\r\n//     }\r\n//   }, [location.search]);\r\n\r\n//   // \r\n//   // 2) When user selects contacts via checkboxes,\r\n//   //    decide what Contact 360 should show\r\n//   // \r\n//   useEffect(() => {\r\n//     const params = new URLSearchParams(location.search);\r\n//     const idFromUrl = params.get(\"contactId\");\r\n\r\n//     // If there is a deep-link contactId in the URL, do not override it here.\r\n//     if (idFromUrl) return;\r\n\r\n//     if (!selectedIds || selectedIds.length === 0) {\r\n//       // Nothing selected  clear focus & summary\r\n//       setFocusedContactId(null);\r\n//       setContactSummary(null);\r\n//       return;\r\n//     }\r\n\r\n//     if (selectedIds.length === 1) {\r\n//       // Exactly one selected  that is our focused contact\r\n//       setFocusedContactId(selectedIds[0]);\r\n//       return;\r\n//     }\r\n\r\n//     // If multiple are selected, we keep the previous focusedContactId.\r\n//     // The right panel will switch to a \"multiple contacts selected\" state.\r\n//   }, [selectedIds]);\r\n\r\n//   // \r\n//   // 3) Handlers for list side\r\n//   // \r\n//   const handleAddClick = () => {\r\n//     setEditingContact(null);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleEditContact = contact => {\r\n//     setEditingContact(contact);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleModalClose = () => {\r\n//     setIsModalOpen(false);\r\n//     setEditingContact(null);\r\n//   };\r\n\r\n//   const handleSaveComplete = () => {\r\n//     // Modal will close itself via onClose; we just trigger refresh.\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   const handleSelectionChange = ids => {\r\n//     setSelectedIds(ids || []);\r\n//   };\r\n\r\n//   const handleTabChange = tab => {\r\n//     setActiveTab(tab);\r\n//     setCurrentPage(1);\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleClearSelection = () => {\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleRefreshList = () => {\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   // \r\n//   // 4) Fetch Contact 360 summary when focusedContactId changes\r\n//   // \r\n//   useEffect(() => {\r\n//     const contactId = focusedContactId;\r\n//     if (!contactId) return;\r\n\r\n//     let cancelled = false;\r\n\r\n//     const loadSummary = async () => {\r\n//       try {\r\n//         setIsSummaryLoading(true);\r\n//         const response = await axiosClient.get(\r\n//           `/crm/contact-summary/${contactId}`\r\n//         );\r\n//         if (cancelled) return;\r\n//         setContactSummary(response.data || null);\r\n//       } catch (error) {\r\n//         if (cancelled) return;\r\n//         console.error(\"Failed to load contact summary\", error);\r\n//         toast.error(\r\n//           error?.response?.data?.message ||\r\n//             \"Failed to load Contact 360 summary.\"\r\n//         );\r\n//         setContactSummary(null);\r\n//       } finally {\r\n//         if (!cancelled) {\r\n//           setIsSummaryLoading(false);\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     loadSummary();\r\n\r\n//     return () => {\r\n//       cancelled = true;\r\n//     };\r\n//   }, [focusedContactId]);\r\n\r\n//   // \r\n//   // 5) Derived CRM summary slices (tags, notes, reminder, timeline)\r\n//   // \r\n//   const tagsList = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     if (Array.isArray(contactSummary.tags)) return contactSummary.tags;\r\n//     if (Array.isArray(contactSummary.contactTags))\r\n//       return contactSummary.contactTags;\r\n//     if (Array.isArray(contactSummary.tagSummaries))\r\n//       return contactSummary.tagSummaries;\r\n//     if (Array.isArray(contactSummary.tagList)) return contactSummary.tagList;\r\n//     return [];\r\n//   }, [contactSummary]);\r\n\r\n//   const recentNotes = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const notes =\r\n//       contactSummary.recentNotes ||\r\n//       contactSummary.notes ||\r\n//       contactSummary.lastNotes ||\r\n//       [];\r\n//     return Array.isArray(notes) ? notes.slice(0, 3) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const nextReminder = useMemo(() => {\r\n//     if (!contactSummary) return null;\r\n//     return (\r\n//       contactSummary.nextReminder ||\r\n//       contactSummary.upcomingReminder ||\r\n//       contactSummary.reminder ||\r\n//       null\r\n//     );\r\n//   }, [contactSummary]);\r\n\r\n//   const recentTimeline = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const items =\r\n//       contactSummary.recentTimeline ||\r\n//       contactSummary.timeline ||\r\n//       contactSummary.events ||\r\n//       [];\r\n//     return Array.isArray(items) ? items.slice(0, 5) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const basic =\r\n//     contactSummary?.contact ||\r\n//     contactSummary?.contactBasic ||\r\n//     contactSummary?.contactInfo ||\r\n//     contactSummary ||\r\n//     null;\r\n\r\n//   const displayName =\r\n//     basic?.fullName || basic?.name || basic?.contactName || \"\";\r\n//   const displayPhone =\r\n//     basic?.phoneNumber || basic?.whatsappNumber || basic?.phone || \"\";\r\n//   const displayEmail = basic?.email || basic?.emailAddress || \"\";\r\n//   const displayStatus =\r\n//     basic?.status || basic?.lifecycleStage || basic?.stage || null;\r\n//   const createdAt =\r\n//     basic?.createdAt ||\r\n//     basic?.createdOn ||\r\n//     basic?.firstSeenAt ||\r\n//     basic?.createdDate;\r\n//   const lastInbound =\r\n//     basic?.lastInboundAt ||\r\n//     basic?.lastInboundMessageAt ||\r\n//     basic?.lastIncomingAt;\r\n//   const lastOutbound =\r\n//     basic?.lastOutboundAt ||\r\n//     basic?.lastOutboundMessageAt ||\r\n//     basic?.lastOutgoingAt;\r\n\r\n//   const multipleSelected = selectedIds.length > 1;\r\n\r\n//   // \r\n//   // 6) Render  green / XploreByte themed\r\n//   // \r\n//   return (\r\n//     <div className=\"flex h-full bg-gradient-to-r from-emerald-50 via-emerald-50/40 to-white\">\r\n//       {/* LEFT: Contacts list + workspace header + filters + bulk actions */}\r\n//       <div className=\"flex-1 flex flex-col border-r border-slate-200 bg-white/90 backdrop-blur\">\r\n//         {/* Workspace-style header */}\r\n//         <div className=\"border-b border-slate-200 bg-white/90\">\r\n//           <div className=\"px-5 pt-4 pb-3 flex items-center justify-between\">\r\n//             <div>\r\n//               <p className=\"text-[11px] font-semibold uppercase tracking-wide text-emerald-600\">\r\n//                 CRM Workspace\r\n//               </p>\r\n//               <h1 className=\"mt-1 text-lg font-semibold text-slate-900\">\r\n//                 Contacts\r\n//               </h1>\r\n//               <p className=\"mt-0.5 text-xs text-slate-500\">\r\n//                 Manage your leads and customers in one place.\r\n//               </p>\r\n//             </div>\r\n//             <div className=\"hidden sm:flex h-10 w-10 items-center justify-center rounded-2xl bg-emerald-100\">\r\n//               <User className=\"h-5 w-5 text-emerald-600\" />\r\n//             </div>\r\n//           </div>\r\n\r\n//           {/* Top bar: search + tabs + filters */}\r\n//           <div className=\"border-t border-slate-100\">\r\n//             <ContactsTopBar\r\n//               onAddClick={handleAddClick}\r\n//               onSearchChange={setSearchTerm}\r\n//               activeTab={activeTab}\r\n//               onTabChange={handleTabChange}\r\n//               searchTerm={searchTerm}\r\n//               onFilterClick={() =>\r\n//                 toast.info(\"Advanced filters will come in a later phase.\")\r\n//               }\r\n//             />\r\n//           </div>\r\n//         </div>\r\n\r\n//         {/* Bulk actions (only visible when something is selected) */}\r\n//         {selectedIds.length > 0 && (\r\n//           <BulkActionsBar\r\n//             selectedIds={selectedIds}\r\n//             onClearSelection={handleClearSelection}\r\n//             onRefresh={handleRefreshList}\r\n//           />\r\n//         )}\r\n\r\n//         {/* Contacts table */}\r\n//         <div className=\"flex-1 overflow-hidden\">\r\n//           <ContactsTable\r\n//             onEdit={handleEditContact}\r\n//             refreshTrigger={refreshTrigger}\r\n//             activeTab={activeTab}\r\n//             onSelectionChange={handleSelectionChange}\r\n//             searchTerm={searchTerm}\r\n//             currentPage={currentPage}\r\n//             setCurrentPage={setCurrentPage}\r\n//           />\r\n//         </div>\r\n\r\n//         {/* Contact create/edit modal */}\r\n//         <ContactFormModal\r\n//           isOpen={isModalOpen}\r\n//           onClose={handleModalClose}\r\n//           contact={editingContact}\r\n//           onSaveComplete={handleSaveComplete}\r\n//         />\r\n//       </div>\r\n\r\n//       {/* RIGHT: Contact 360 mini-CRM panel */}\r\n//       <div className=\"hidden lg:flex w-[360px] xl:w-[380px] flex-col bg-gradient-to-b from-emerald-50/80 via-white to-emerald-50/40\">\r\n//         {/* Header */}\r\n//         <div className=\"border-b border-emerald-100 px-4 py-3 bg-white/90 backdrop-blur\">\r\n//           <div className=\"flex items-center justify-between\">\r\n//             <div>\r\n//               <p className=\"text-[11px] font-semibold uppercase tracking-wide text-emerald-600\">\r\n//                 Contact 360\r\n//               </p>\r\n//               <p className=\"text-xs text-slate-500\">\r\n//                 Quick CRM snapshot for the selected contact\r\n//               </p>\r\n//             </div>\r\n//             <div className=\"h-8 w-8 rounded-2xl bg-emerald-100 flex items-center justify-center\">\r\n//               <User className=\"h-4 w-4 text-emerald-700\" />\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//         {/* Body */}\r\n//         <div className=\"flex-1 overflow-y-auto px-4 py-3 space-y-4\">\r\n//           {/* Empty state */}\r\n//           {!focusedContactId && !isSummaryLoading && !multipleSelected && (\r\n//             <div className=\"mt-10 text-center text-slate-500 text-sm\">\r\n//               <div className=\"mx-auto mb-3 flex h-11 w-11 items-center justify-center rounded-2xl bg-emerald-50\">\r\n//                 <Filter className=\"h-4 w-4 text-emerald-600\" />\r\n//               </div>\r\n//               <p className=\"font-medium text-slate-800\">\r\n//                 No contact selected yet\r\n//               </p>\r\n//               <p className=\"mt-1 text-xs text-slate-500\">\r\n//                 Select a contact from the list (or open this page from Chat\r\n//                 Inbox) to see their full CRM profile.\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n\r\n//           {/* Multiple selection state */}\r\n//           {multipleSelected && (\r\n//             <div className=\"mt-10 text-center text-slate-500 text-sm\">\r\n//               <div className=\"mx-auto mb-3 flex h-11 w-11 items-center justify-center rounded-2xl bg-emerald-50\">\r\n//                 <Activity className=\"h-4 w-4 text-emerald-600\" />\r\n//               </div>\r\n//               <p className=\"font-medium text-slate-800\">\r\n//                 Multiple contacts selected\r\n//               </p>\r\n//               <p className=\"mt-1 text-xs text-slate-500\">\r\n//                 Use the bulk actions bar for mass updates. Contact 360 is\r\n//                 available when exactly one contact is selected.\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n\r\n//           {/* Loading skeleton */}\r\n//           {focusedContactId && !multipleSelected && isSummaryLoading && (\r\n//             <div className=\"mt-6 space-y-3\">\r\n//               <div className=\"animate-pulse space-y-3\">\r\n//                 <div className=\"h-5 w-32 rounded bg-emerald-100/70\" />\r\n//                 <div className=\"h-16 rounded-xl bg-emerald-50/80\" />\r\n//                 <div className=\"h-10 rounded-xl bg-emerald-50/70\" />\r\n//                 <div className=\"h-24 rounded-xl bg-emerald-50/60\" />\r\n//               </div>\r\n//             </div>\r\n//           )}\r\n\r\n//           {/* Actual summary */}\r\n//           {focusedContactId &&\r\n//             !multipleSelected &&\r\n//             !isSummaryLoading &&\r\n//             contactSummary && (\r\n//               <>\r\n//                 {/* Basic info card */}\r\n//                 <div className=\"rounded-2xl border border-emerald-100 bg-white px-3 py-3 shadow-sm\">\r\n//                   <div className=\"flex items-start justify-between gap-2\">\r\n//                     <div>\r\n//                       <div className=\"text-sm font-semibold text-slate-900\">\r\n//                         {displayName}\r\n//                       </div>\r\n//                       {displayPhone && (\r\n//                         <div className=\"mt-0.5 text-xs text-slate-600 font-mono\">\r\n//                           {displayPhone}\r\n//                         </div>\r\n//                       )}\r\n//                       {displayEmail && (\r\n//                         <div className=\"mt-0.5 text-xs text-slate-500\">\r\n//                           {displayEmail}\r\n//                         </div>\r\n//                       )}\r\n//                     </div>\r\n//                     {displayStatus && (\r\n//                       <span className=\"inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700\">\r\n//                         {displayStatus}\r\n//                       </span>\r\n//                     )}\r\n//                   </div>\r\n\r\n//                   <div className=\"mt-3 grid grid-cols-2 gap-3 text-[11px] text-slate-600\">\r\n//                     <div>\r\n//                       <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                         Created\r\n//                       </p>\r\n//                       <p className=\"mt-0.5 font-medium\">\r\n//                         {formatDateTime(createdAt)}\r\n//                       </p>\r\n//                     </div>\r\n//                     <div>\r\n//                       <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                         Last inbound\r\n//                       </p>\r\n//                       <p className=\"mt-0.5 font-medium\">\r\n//                         {formatDateTime(lastInbound)}\r\n//                       </p>\r\n//                     </div>\r\n//                     <div>\r\n//                       <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                         Last outbound\r\n//                       </p>\r\n//                       <p className=\"mt-0.5 font-medium\">\r\n//                         {formatDateTime(lastOutbound)}\r\n//                       </p>\r\n//                     </div>\r\n//                   </div>\r\n//                 </div>\r\n\r\n//                 {/* Tags */}\r\n//                 <div className=\"rounded-2xl border border-slate-200 bg-white px-3 py-3 shadow-sm\">\r\n//                   <div className=\"flex items-center justify-between mb-2\">\r\n//                     <div className=\"flex items-center gap-2\">\r\n//                       <div className=\"h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center\">\r\n//                         <Tag className=\"h-3 w-3 text-emerald-700\" />\r\n//                       </div>\r\n//                       <p className=\"text-xs font-semibold text-slate-800\">\r\n//                         Tags\r\n//                       </p>\r\n//                     </div>\r\n//                   </div>\r\n//                   {tagsList.length === 0 ? (\r\n//                     <p className=\"text-xs text-slate-500\">\r\n//                       No tags yet. You can tag this contact from the main\r\n//                       Contacts view.\r\n//                     </p>\r\n//                   ) : (\r\n//                     <div className=\"flex flex-wrap gap-1.5\">\r\n//                       {tagsList.map(tag => (\r\n//                         <span\r\n//                           key={tag.id || tag.tagId || tag.name}\r\n//                           className=\"inline-flex items-center rounded-full border border-slate-200 bg-emerald-50/70 px-2 py-0.5 text-[11px] text-slate-800\"\r\n//                         >\r\n//                           {tag.color && (\r\n//                             <span\r\n//                               className=\"mr-1 h-2 w-2 rounded-full\"\r\n//                               style={{ backgroundColor: tag.color }}\r\n//                             />\r\n//                           )}\r\n//                           {tag.name || tag.label || tag.tagName}\r\n//                         </span>\r\n//                       ))}\r\n//                     </div>\r\n//                   )}\r\n//                 </div>\r\n\r\n//                 {/* Next Reminder */}\r\n//                 <div className=\"rounded-2xl border border-slate-200 bg-white px-3 py-3 shadow-sm\">\r\n//                   <div className=\"flex items-center gap-2 mb-2\">\r\n//                     <div className=\"h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center\">\r\n//                       <Bell className=\"h-3 w-3 text-emerald-700\" />\r\n//                     </div>\r\n//                     <p className=\"text-xs font-semibold text-slate-800\">\r\n//                       Next reminder\r\n//                     </p>\r\n//                   </div>\r\n//                   {!nextReminder ? (\r\n//                     <p className=\"text-xs text-slate-500\">\r\n//                       No upcoming reminder scheduled.\r\n//                     </p>\r\n//                   ) : (\r\n//                     <div className=\"space-y-1 text-xs text-slate-700\">\r\n//                       <p className=\"font-medium\">\r\n//                         {nextReminder.title ||\r\n//                           nextReminder.subject ||\r\n//                           \"Reminder\"}\r\n//                       </p>\r\n//                       {nextReminder.dueAt && (\r\n//                         <p className=\"flex items-center gap-1 text-slate-500\">\r\n//                           <Clock className=\"h-3 w-3\" />\r\n//                           {formatDateTime(\r\n//                             nextReminder.dueAt ||\r\n//                               nextReminder.dueDate ||\r\n//                               nextReminder.remindAt\r\n//                           )}\r\n//                         </p>\r\n//                       )}\r\n//                       {nextReminder.note && (\r\n//                         <p className=\"text-[11px] text-slate-500\">\r\n//                           {nextReminder.note}\r\n//                         </p>\r\n//                       )}\r\n//                     </div>\r\n//                   )}\r\n//                 </div>\r\n\r\n//                 {/* Recent Notes */}\r\n//                 <div className=\"rounded-2xl border border-slate-200 bg-white px-3 py-3 shadow-sm\">\r\n//                   <div className=\"flex items-center gap-2 mb-2\">\r\n//                     <div className=\"h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center\">\r\n//                       <StickyNote className=\"h-3 w-3 text-emerald-700\" />\r\n//                     </div>\r\n//                     <p className=\"text-xs font-semibold text-slate-800\">\r\n//                       Recent notes\r\n//                     </p>\r\n//                   </div>\r\n//                   {recentNotes.length === 0 ? (\r\n//                     <p className=\"text-xs text-slate-500\">\r\n//                       No notes yet. Use the Notes module in CRM to add context\r\n//                       for this lead.\r\n//                     </p>\r\n//                   ) : (\r\n//                     <div className=\"space-y-2\">\r\n//                       {recentNotes.map(note => (\r\n//                         <div\r\n//                           key={note.id || note.noteId}\r\n//                           className=\"rounded-lg border border-slate-100 bg-emerald-50/40 px-2 py-1.5\"\r\n//                         >\r\n//                           <p className=\"text-[11px] font-medium text-slate-800\">\r\n//                             {note.title || \"Note\"}\r\n//                           </p>\r\n//                           {note.content && (\r\n//                             <p className=\"mt-0.5 text-[11px] text-slate-600 line-clamp-2\">\r\n//                               {note.content}\r\n//                             </p>\r\n//                           )}\r\n//                           {note.createdAt && (\r\n//                             <p className=\"mt-0.5 text-[10px] text-slate-400\">\r\n//                               {formatDateTime(note.createdAt)}\r\n//                             </p>\r\n//                           )}\r\n//                         </div>\r\n//                       ))}\r\n//                     </div>\r\n//                   )}\r\n//                 </div>\r\n\r\n//                 {/* Recent Timeline */}\r\n//                 <div className=\"rounded-2xl border border-slate-200 bg-white px-3 py-3 mb-2 shadow-sm\">\r\n//                   <div className=\"flex items-center gap-2 mb-2\">\r\n//                     <div className=\"h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center\">\r\n//                       <Activity className=\"h-3 w-3 text-emerald-700\" />\r\n//                     </div>\r\n//                     <p className=\"text-xs font-semibold text-slate-800\">\r\n//                       Recent activity\r\n//                     </p>\r\n//                   </div>\r\n//                   {recentTimeline.length === 0 ? (\r\n//                     <p className=\"text-xs text-slate-500\">\r\n//                       No recent timeline events captured for this contact yet.\r\n//                     </p>\r\n//                   ) : (\r\n//                     <ol className=\"space-y-1.5 text-[11px] text-slate-700\">\r\n//                       {recentTimeline.map(item => (\r\n//                         <li\r\n//                           key={item.id || item.eventId || item.occurredAt}\r\n//                           className=\"flex items-start gap-2\"\r\n//                         >\r\n//                           <span className=\"mt-1 h-1.5 w-1.5 rounded-full bg-emerald-500 flex-shrink-0\" />\r\n//                           <div>\r\n//                             <p className=\"font-medium\">\r\n//                               {item.title || item.type || \"Event\"}\r\n//                             </p>\r\n//                             {item.description && (\r\n//                               <p className=\"text-[11px] text-slate-600 line-clamp-2\">\r\n//                                 {item.description}\r\n//                               </p>\r\n//                             )}\r\n//                             {item.occurredAt && (\r\n//                               <p className=\"text-[10px] text-slate-400 mt-0.5\">\r\n//                                 {formatDateTime(item.occurredAt)}\r\n//                               </p>\r\n//                             )}\r\n//                           </div>\r\n//                         </li>\r\n//                       ))}\r\n//                     </ol>\r\n//                   )}\r\n//                 </div>\r\n//               </>\r\n//             )}\r\n//         </div>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// //  src/pages/CRM/Contacts/Contacts.jsx\r\n\r\n// import React, { useEffect, useMemo, useState } from \"react\";\r\n// import { useLocation } from \"react-router-dom\";\r\n// import {\r\n//   User,\r\n//   Tag,\r\n//   Clock,\r\n//   StickyNote,\r\n//   Bell,\r\n//   Activity,\r\n//   Filter,\r\n// } from \"lucide-react\";\r\n// import { toast } from \"react-toastify\";\r\n\r\n// import axiosClient from \"../../../api/axiosClient\";\r\n\r\n// import ContactsTopBar from \"./components/ContactsTopBar\";\r\n// import ContactsTable from \"./components/ContactsTable\";\r\n// import ContactFormModal from \"./components/ContactFormModal\";\r\n// import BulkActionsBar from \"./components/BulkActionsBar\";\r\n\r\n// function formatDateTime(value) {\r\n//   if (!value) return \"\";\r\n//   try {\r\n//     return new Date(value).toLocaleString();\r\n//   } catch {\r\n//     return String(value);\r\n//   }\r\n// }\r\n\r\n// export default function Contacts() {\r\n//   //  UI state for list side\r\n//   const [isModalOpen, setIsModalOpen] = useState(false);\r\n//   const [editingContact, setEditingContact] = useState(null);\r\n//   const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n//   const [activeTab, setActiveTab] = useState(\"all\");\r\n//   const [searchTerm, setSearchTerm] = useState(\"\");\r\n//   const [selectedIds, setSelectedIds] = useState([]);\r\n//   const [currentPage, setCurrentPage] = useState(1);\r\n\r\n//   //  URL -> contactId (for when we deep-link from Chat Inbox)\r\n//   const location = useLocation();\r\n//   const [focusedContactId, setFocusedContactId] = useState(null);\r\n\r\n//   //  Contact 360 summary data\r\n//   const [contactSummary, setContactSummary] = useState(null);\r\n//   const [isSummaryLoading, setIsSummaryLoading] = useState(false);\r\n\r\n//   // \r\n//   // 1) Hydrate focusedContactId from URL (?contactId=...)\r\n//   // \r\n//   useEffect(() => {\r\n//     const params = new URLSearchParams(location.search);\r\n//     const idFromUrl = params.get(\"contactId\");\r\n\r\n//     if (idFromUrl) {\r\n//       setFocusedContactId(idFromUrl);\r\n\r\n//       // Keep selection in a reasonable state for BulkActionsBar\r\n//       setSelectedIds(prev =>\r\n//         prev && prev.length > 0 && prev.includes(idFromUrl) ? prev : [idFromUrl]\r\n//       );\r\n//     }\r\n//   }, [location.search]);\r\n\r\n//   // \r\n//   // 2) When user selects contacts via checkboxes,\r\n//   //    focus the first one for Contact 360\r\n//   // \r\n//   useEffect(() => {\r\n//     if (selectedIds && selectedIds.length > 0) {\r\n//       setFocusedContactId(selectedIds[0]);\r\n//     } else {\r\n//       // Only clear if not coming from a URL-driven focus\r\n//       const params = new URLSearchParams(location.search);\r\n//       const idFromUrl = params.get(\"contactId\");\r\n//       if (!idFromUrl) {\r\n//         setFocusedContactId(null);\r\n//         setContactSummary(null);\r\n//       }\r\n//     }\r\n//     // eslint-disable-next-line react-hooks/exhaustive-deps\r\n//   }, [selectedIds]);\r\n\r\n//   // \r\n//   // 3) Handlers for list side\r\n//   // \r\n//   const handleAddClick = () => {\r\n//     setEditingContact(null);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleEditContact = contact => {\r\n//     setEditingContact(contact);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleModalClose = () => {\r\n//     setIsModalOpen(false);\r\n//     setEditingContact(null);\r\n//   };\r\n\r\n//   const handleSaveComplete = () => {\r\n//     // Modal will close itself via onClose; we just trigger refresh.\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   const handleSelectionChange = ids => {\r\n//     setSelectedIds(ids || []);\r\n//   };\r\n\r\n//   const handleTabChange = tab => {\r\n//     setActiveTab(tab);\r\n//     setCurrentPage(1);\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleClearSelection = () => {\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   const handleRefreshList = () => {\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   // \r\n//   // 4) Fetch Contact 360 summary when focusedContactId changes\r\n//   // \r\n//   useEffect(() => {\r\n//     const contactId = focusedContactId;\r\n//     if (!contactId) return;\r\n\r\n//     let cancelled = false;\r\n\r\n//     const loadSummary = async () => {\r\n//       try {\r\n//         setIsSummaryLoading(true);\r\n//         const response = await axiosClient.get(\r\n//           `/crm/contact-summary/${contactId}`\r\n//         );\r\n//         if (cancelled) return;\r\n//         setContactSummary(response.data || null);\r\n//       } catch (error) {\r\n//         if (cancelled) return;\r\n//         console.error(\"Failed to load contact summary\", error);\r\n//         toast.error(\r\n//           error?.response?.data?.message ||\r\n//             \"Failed to load Contact 360 summary.\"\r\n//         );\r\n//         setContactSummary(null);\r\n//       } finally {\r\n//         if (!cancelled) {\r\n//           setIsSummaryLoading(false);\r\n//         }\r\n//       }\r\n//     };\r\n\r\n//     loadSummary();\r\n\r\n//     return () => {\r\n//       cancelled = true;\r\n//     };\r\n//   }, [focusedContactId]);\r\n\r\n//   // \r\n//   // 5) Derived CRM summary slices (tags, notes, reminder, timeline)\r\n//   //     mirrors the logic were already using in Chat Inbox\r\n//   // \r\n//   const tagsList = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     if (Array.isArray(contactSummary.tags)) return contactSummary.tags;\r\n//     if (Array.isArray(contactSummary.contactTags))\r\n//       return contactSummary.contactTags;\r\n//     if (Array.isArray(contactSummary.tagSummaries))\r\n//       return contactSummary.tagSummaries;\r\n//     if (Array.isArray(contactSummary.tagList)) return contactSummary.tagList;\r\n//     return [];\r\n//   }, [contactSummary]);\r\n\r\n//   const recentNotes = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const notes =\r\n//       contactSummary.recentNotes ||\r\n//       contactSummary.notes ||\r\n//       contactSummary.lastNotes ||\r\n//       [];\r\n//     return Array.isArray(notes) ? notes.slice(0, 3) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const nextReminder = useMemo(() => {\r\n//     if (!contactSummary) return null;\r\n//     return (\r\n//       contactSummary.nextReminder ||\r\n//       contactSummary.upcomingReminder ||\r\n//       contactSummary.reminder ||\r\n//       null\r\n//     );\r\n//   }, [contactSummary]);\r\n\r\n//   const recentTimeline = useMemo(() => {\r\n//     if (!contactSummary) return [];\r\n//     const items =\r\n//       contactSummary.recentTimeline ||\r\n//       contactSummary.timeline ||\r\n//       contactSummary.events ||\r\n//       [];\r\n//     return Array.isArray(items) ? items.slice(0, 5) : [];\r\n//   }, [contactSummary]);\r\n\r\n//   const basic =\r\n//     contactSummary?.contact ||\r\n//     contactSummary?.contactBasic ||\r\n//     contactSummary?.contactInfo ||\r\n//     contactSummary ||\r\n//     null;\r\n\r\n//   const displayName =\r\n//     basic?.fullName || basic?.name || basic?.contactName || \"\";\r\n//   const displayPhone =\r\n//     basic?.phoneNumber || basic?.whatsappNumber || basic?.phone || \"\";\r\n//   const displayEmail = basic?.email || basic?.emailAddress || \"\";\r\n//   const displayStatus =\r\n//     basic?.status || basic?.lifecycleStage || basic?.stage || null;\r\n//   const createdAt =\r\n//     basic?.createdAt ||\r\n//     basic?.createdOn ||\r\n//     basic?.firstSeenAt ||\r\n//     basic?.createdDate;\r\n//   const lastInbound =\r\n//     basic?.lastInboundAt ||\r\n//     basic?.lastInboundMessageAt ||\r\n//     basic?.lastIncomingAt;\r\n//   const lastOutbound =\r\n//     basic?.lastOutboundAt ||\r\n//     basic?.lastOutboundMessageAt ||\r\n//     basic?.lastOutgoingAt;\r\n\r\n//   // \r\n//   // 6) Render\r\n//   // \r\n//   return (\r\n//     <div className=\"flex h-full bg-slate-50\">\r\n//       {/* LEFT: Contacts list + filters + bulk actions */}\r\n//       <div className=\"flex-1 flex flex-col border-r border-slate-200 bg-white\">\r\n//         {/* Top bar: search + tabs + filters */}\r\n//         <div className=\"border-b border-slate-200\">\r\n//           <ContactsTopBar\r\n//             onAddClick={handleAddClick}\r\n//             onSearchChange={setSearchTerm}\r\n//             activeTab={activeTab}\r\n//             onTabChange={handleTabChange}\r\n//             searchTerm={searchTerm}\r\n//             onFilterClick={() =>\r\n//               toast.info(\"Advanced filters will come in a later phase.\")\r\n//             }\r\n//           />\r\n//         </div>\r\n\r\n//         {/* Bulk actions (only visible when something is selected) */}\r\n//         {selectedIds.length > 0 && (\r\n//           <BulkActionsBar\r\n//             selectedIds={selectedIds}\r\n//             onClearSelection={handleClearSelection}\r\n//             onRefresh={handleRefreshList}\r\n//           />\r\n//         )}\r\n\r\n//         {/* Contacts table */}\r\n//         <div className=\"flex-1 overflow-hidden\">\r\n//           <ContactsTable\r\n//             onEdit={handleEditContact}\r\n//             refreshTrigger={refreshTrigger}\r\n//             activeTab={activeTab}\r\n//             onSelectionChange={handleSelectionChange}\r\n//             searchTerm={searchTerm}\r\n//             currentPage={currentPage}\r\n//             setCurrentPage={setCurrentPage}\r\n//           />\r\n//         </div>\r\n\r\n//         {/* Contact create/edit modal */}\r\n//         <ContactFormModal\r\n//           isOpen={isModalOpen}\r\n//           onClose={handleModalClose}\r\n//           contact={editingContact}\r\n//           onSaveComplete={handleSaveComplete}\r\n//         />\r\n//       </div>\r\n\r\n//       {/* RIGHT: Contact 360 mini-CRM panel */}\r\n//       <div className=\"hidden lg:flex w-[360px] xl:w-[380px] flex-col bg-slate-25\">\r\n//         {/* Header */}\r\n//         <div className=\"border-b border-slate-200 px-4 py-3 bg-white\">\r\n//           <div className=\"flex items-center justify-between\">\r\n//             <div>\r\n//               <p className=\"text-[11px] font-semibold uppercase tracking-wide text-slate-500\">\r\n//                 Contact 360\r\n//               </p>\r\n//               <p className=\"text-xs text-slate-500\">\r\n//                 Quick CRM snapshot for the selected contact\r\n//               </p>\r\n//             </div>\r\n//             <div className=\"h-8 w-8 rounded-full bg-purple-50 flex items-center justify-center\">\r\n//               <User className=\"h-4 w-4 text-purple-600\" />\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//         {/* Body */}\r\n//         <div className=\"flex-1 overflow-y-auto px-4 py-3 space-y-4\">\r\n//           {/* Empty state */}\r\n//           {!focusedContactId && !isSummaryLoading && (\r\n//             <div className=\"mt-8 text-center text-slate-500 text-sm\">\r\n//               <div className=\"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-full bg-slate-100\">\r\n//                 <Filter className=\"h-4 w-4 text-slate-500\" />\r\n//               </div>\r\n//               <p className=\"font-medium\">No contact selected</p>\r\n//               <p className=\"mt-1 text-xs text-slate-500\">\r\n//                 Select a contact from the list (or open this page from Chat\r\n//                 Inbox) to see their CRM profile.\r\n//               </p>\r\n//             </div>\r\n//           )}\r\n\r\n//           {/* Loading */}\r\n//           {focusedContactId && isSummaryLoading && (\r\n//             <div className=\"mt-6 space-y-3\">\r\n//               <div className=\"animate-pulse space-y-3\">\r\n//                 <div className=\"h-5 w-32 rounded bg-slate-200\" />\r\n//                 <div className=\"h-16 rounded-xl bg-slate-100\" />\r\n//                 <div className=\"h-10 rounded-xl bg-slate-100\" />\r\n//                 <div className=\"h-24 rounded-xl bg-slate-100\" />\r\n//               </div>\r\n//             </div>\r\n//           )}\r\n\r\n//           {/* Actual summary */}\r\n//           {focusedContactId && !isSummaryLoading && contactSummary && (\r\n//             <>\r\n//               {/* Basic info card */}\r\n//               <div className=\"rounded-xl border border-slate-200 bg-slate-50 px-3 py-3\">\r\n//                 <div className=\"flex items-start justify-between gap-2\">\r\n//                   <div>\r\n//                     <div className=\"text-sm font-semibold text-slate-900\">\r\n//                       {displayName}\r\n//                     </div>\r\n//                     {displayPhone && (\r\n//                       <div className=\"mt-0.5 text-xs text-slate-600 font-mono\">\r\n//                         {displayPhone}\r\n//                       </div>\r\n//                     )}\r\n//                     {displayEmail && (\r\n//                       <div className=\"mt-0.5 text-xs text-slate-500\">\r\n//                         {displayEmail}\r\n//                       </div>\r\n//                     )}\r\n//                   </div>\r\n//                   {displayStatus && (\r\n//                     <span className=\"inline-flex items-center rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[10px] font-medium text-amber-700\">\r\n//                       {displayStatus}\r\n//                     </span>\r\n//                   )}\r\n//                 </div>\r\n\r\n//                 <div className=\"mt-3 grid grid-cols-2 gap-3 text-[11px] text-slate-600\">\r\n//                   <div>\r\n//                     <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                       Created\r\n//                     </p>\r\n//                     <p className=\"mt-0.5 font-medium\">\r\n//                       {formatDateTime(createdAt)}\r\n//                     </p>\r\n//                   </div>\r\n//                   <div>\r\n//                     <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                       Last inbound\r\n//                     </p>\r\n//                     <p className=\"mt-0.5 font-medium\">\r\n//                       {formatDateTime(lastInbound)}\r\n//                     </p>\r\n//                   </div>\r\n//                   <div>\r\n//                     <p className=\"text-[10px] uppercase text-slate-400\">\r\n//                       Last outbound\r\n//                     </p>\r\n//                     <p className=\"mt-0.5 font-medium\">\r\n//                       {formatDateTime(lastOutbound)}\r\n//                     </p>\r\n//                   </div>\r\n//                 </div>\r\n//               </div>\r\n\r\n//               {/* Tags */}\r\n//               <div className=\"rounded-xl border border-slate-200 bg-white px-3 py-3\">\r\n//                 <div className=\"flex items-center justify-between mb-2\">\r\n//                   <div className=\"flex items-center gap-2\">\r\n//                     <div className=\"h-6 w-6 rounded-full bg-purple-50 flex items-center justify-center\">\r\n//                       <Tag className=\"h-3 w-3 text-purple-600\" />\r\n//                     </div>\r\n//                     <p className=\"text-xs font-semibold text-slate-800\">Tags</p>\r\n//                   </div>\r\n//                 </div>\r\n//                 {tagsList.length === 0 ? (\r\n//                   <p className=\"text-xs text-slate-500\">\r\n//                     No tags yet. You can tag this contact from the main Contacts\r\n//                     view.\r\n//                   </p>\r\n//                 ) : (\r\n//                   <div className=\"flex flex-wrap gap-1.5\">\r\n//                     {tagsList.map(tag => (\r\n//                       <span\r\n//                         key={tag.id || tag.tagId || tag.name}\r\n//                         className=\"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] text-slate-800\"\r\n//                       >\r\n//                         {tag.color && (\r\n//                           <span\r\n//                             className=\"mr-1 h-2 w-2 rounded-full\"\r\n//                             style={{ backgroundColor: tag.color }}\r\n//                           />\r\n//                         )}\r\n//                         {tag.name || tag.label || tag.tagName}\r\n//                       </span>\r\n//                     ))}\r\n//                   </div>\r\n//                 )}\r\n//               </div>\r\n\r\n//               {/* Next Reminder */}\r\n//               <div className=\"rounded-xl border border-slate-200 bg-white px-3 py-3\">\r\n//                 <div className=\"flex items-center gap-2 mb-2\">\r\n//                   <div className=\"h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center\">\r\n//                     <Bell className=\"h-3 w-3 text-emerald-700\" />\r\n//                   </div>\r\n//                   <p className=\"text-xs font-semibold text-slate-800\">\r\n//                     Next reminder\r\n//                   </p>\r\n//                 </div>\r\n//                 {!nextReminder ? (\r\n//                   <p className=\"text-xs text-slate-500\">\r\n//                     No upcoming reminder scheduled.\r\n//                   </p>\r\n//                 ) : (\r\n//                   <div className=\"space-y-1 text-xs text-slate-700\">\r\n//                     <p className=\"font-medium\">\r\n//                       {nextReminder.title || nextReminder.subject || \"Reminder\"}\r\n//                     </p>\r\n//                     {nextReminder.dueAt && (\r\n//                       <p className=\"flex items-center gap-1 text-slate-500\">\r\n//                         <Clock className=\"h-3 w-3\" />\r\n//                         {formatDateTime(\r\n//                           nextReminder.dueAt ||\r\n//                             nextReminder.dueDate ||\r\n//                             nextReminder.remindAt\r\n//                         )}\r\n//                       </p>\r\n//                     )}\r\n//                     {nextReminder.note && (\r\n//                       <p className=\"text-[11px] text-slate-500\">\r\n//                         {nextReminder.note}\r\n//                       </p>\r\n//                     )}\r\n//                   </div>\r\n//                 )}\r\n//               </div>\r\n\r\n//               {/* Recent Notes */}\r\n//               <div className=\"rounded-xl border border-slate-200 bg-white px-3 py-3\">\r\n//                 <div className=\"flex items-center gap-2 mb-2\">\r\n//                   <div className=\"h-6 w-6 rounded-full bg-sky-50 flex items-center justify-center\">\r\n//                     <StickyNote className=\"h-3 w-3 text-sky-700\" />\r\n//                   </div>\r\n//                   <p className=\"text-xs font-semibold text-slate-800\">\r\n//                     Recent notes\r\n//                   </p>\r\n//                 </div>\r\n//                 {recentNotes.length === 0 ? (\r\n//                   <p className=\"text-xs text-slate-500\">\r\n//                     No notes yet. Use the Notes module in CRM to add context for\r\n//                     this lead.\r\n//                   </p>\r\n//                 ) : (\r\n//                   <div className=\"space-y-2\">\r\n//                     {recentNotes.map(note => (\r\n//                       <div\r\n//                         key={note.id || note.noteId}\r\n//                         className=\"rounded-lg border border-slate-100 bg-slate-50 px-2 py-1.5\"\r\n//                       >\r\n//                         <p className=\"text-[11px] font-medium text-slate-800\">\r\n//                           {note.title || \"Note\"}\r\n//                         </p>\r\n//                         {note.content && (\r\n//                           <p className=\"mt-0.5 text-[11px] text-slate-600 line-clamp-2\">\r\n//                             {note.content}\r\n//                           </p>\r\n//                         )}\r\n//                         {note.createdAt && (\r\n//                           <p className=\"mt-0.5 text-[10px] text-slate-400\">\r\n//                             {formatDateTime(note.createdAt)}\r\n//                           </p>\r\n//                         )}\r\n//                       </div>\r\n//                     ))}\r\n//                   </div>\r\n//                 )}\r\n//               </div>\r\n\r\n//               {/* Recent Timeline */}\r\n//               <div className=\"rounded-xl border border-slate-200 bg-white px-3 py-3 mb-2\">\r\n//                 <div className=\"flex items-center gap-2 mb-2\">\r\n//                   <div className=\"h-6 w-6 rounded-full bg-indigo-50 flex items-center justify-center\">\r\n//                     <Activity className=\"h-3 w-3 text-indigo-700\" />\r\n//                   </div>\r\n//                   <p className=\"text-xs font-semibold text-slate-800\">\r\n//                     Recent activity\r\n//                   </p>\r\n//                 </div>\r\n//                 {recentTimeline.length === 0 ? (\r\n//                   <p className=\"text-xs text-slate-500\">\r\n//                     No recent timeline events captured for this contact yet.\r\n//                   </p>\r\n//                 ) : (\r\n//                   <ol className=\"space-y-1.5 text-[11px] text-slate-700\">\r\n//                     {recentTimeline.map(item => (\r\n//                       <li\r\n//                         key={item.id || item.eventId || item.occurredAt}\r\n//                         className=\"flex items-start gap-2\"\r\n//                       >\r\n//                         <span className=\"mt-1 h-1.5 w-1.5 rounded-full bg-indigo-500 flex-shrink-0\" />\r\n//                         <div>\r\n//                           <p className=\"font-medium\">\r\n//                             {item.title || item.type || \"Event\"}\r\n//                           </p>\r\n//                           {item.description && (\r\n//                             <p className=\"text-[11px] text-slate-600 line-clamp-2\">\r\n//                               {item.description}\r\n//                             </p>\r\n//                           )}\r\n//                           {item.occurredAt && (\r\n//                             <p className=\"text-[10px] text-slate-400 mt-0.5\">\r\n//                               {formatDateTime(item.occurredAt)}\r\n//                             </p>\r\n//                           )}\r\n//                         </div>\r\n//                       </li>\r\n//                     ))}\r\n//                   </ol>\r\n//                 )}\r\n//               </div>\r\n//             </>\r\n//           )}\r\n//         </div>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// import React, { useState } from \"react\";\r\n// import TopBar from \"./components/ContactsTopBar\";\r\n// import ContactsTable from \"./components/ContactsTable\";\r\n// import ContactFormModal from \"./components/ContactFormModal\";\r\n// import BulkActionsBar from \"./components/BulkActionsBar\";\r\n\r\n// function Contacts() {\r\n//   const [isModalOpen, setIsModalOpen] = useState(false);\r\n//   const [selectedContact, setSelectedContact] = useState(null);\r\n//   const [refreshTrigger, setRefreshTrigger] = useState(0);\r\n//   const [currentPage, setCurrentPage] = useState(1); //  Added here\r\n//   const [activeTab, setActiveTab] = useState(\"all\");\r\n//   const [searchTerm, setSearchTerm] = useState(\"\");\r\n//   const [selectedIds, setSelectedIds] = useState([]);\r\n\r\n//   const handleAddNew = () => {\r\n//     setSelectedContact(null);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleEdit = contact => {\r\n//     setSelectedContact(contact);\r\n//     setIsModalOpen(true);\r\n//   };\r\n\r\n//   const handleSaveComplete = () => {\r\n//     setIsModalOpen(false);\r\n//     setSelectedContact(null);\r\n//     setCurrentPage(1); //  Reset to page 1 on save\r\n//     setRefreshTrigger(prev => prev + 1);\r\n//   };\r\n\r\n//   const handleSelectionChange = ids => {\r\n//     setSelectedIds(ids);\r\n//   };\r\n\r\n//   const clearSelection = () => {\r\n//     setSelectedIds([]);\r\n//   };\r\n\r\n//   return (\r\n//     <div className=\"p-4 space-y-4\">\r\n//       <TopBar\r\n//         onAddClick={handleAddNew}\r\n//         activeTab={activeTab}\r\n//         onTabChange={setActiveTab}\r\n//         onSearchChange={setSearchTerm}\r\n//       />\r\n\r\n//       {selectedIds.length > 0 && (\r\n//         <BulkActionsBar\r\n//           selectedIds={selectedIds}\r\n//           onClearSelection={clearSelection}\r\n//           onRefresh={() => setRefreshTrigger(prev => prev + 1)}\r\n//         />\r\n//       )}\r\n\r\n//       <ContactsTable\r\n//         onEdit={handleEdit}\r\n//         activeTab={activeTab}\r\n//         refreshTrigger={refreshTrigger}\r\n//         searchTerm={searchTerm}\r\n//         onSelectionChange={handleSelectionChange}\r\n//         selectedIds={selectedIds}\r\n//         currentPage={currentPage}\r\n//         setCurrentPage={setCurrentPage} //  Pass down\r\n//       />\r\n\r\n//       <ContactFormModal\r\n//         isOpen={isModalOpen}\r\n//         onClose={() => setIsModalOpen(false)}\r\n//         contact={selectedContact}\r\n//         onSaveComplete={handleSaveComplete}\r\n//       />\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// export default Contacts;\r\n","import axiosClient from \"../../api/axiosClient\";\n\nconst DEFAULT_ENTITY_TYPE = \"Contact\";\n\nconst pickFirst = (...values) => {\n  for (const value of values) {\n    if (value !== undefined && value !== null) return value;\n  }\n  return null;\n};\n\nconst safeTrim = value => String(value || \"\").trim();\n\nconst normalizeEntityType = value => {\n  const trimmed = safeTrim(value);\n  return trimmed || DEFAULT_ENTITY_TYPE;\n};\n\n// OptionsJson is stored as a JSON string; invalid JSON should become empty list.\nexport const parseOptionsJson = raw => {\n  if (!raw) return [];\n  try {\n    const parsed = typeof raw === \"string\" ? JSON.parse(raw) : raw;\n    const options =\n      parsed?.options ??\n      parsed?.Options ??\n      parsed?.values ??\n      parsed?.Values ??\n      parsed;\n    if (!Array.isArray(options)) return [];\n    return options\n      .map(opt => safeTrim(opt))\n      .filter(opt => opt.length > 0);\n  } catch {\n    return [];\n  }\n};\n\nexport const buildOptionsPayload = options => ({\n  options: Array.isArray(options)\n    ? options.map(opt => safeTrim(opt)).filter(opt => opt.length > 0)\n    : [],\n});\n\n// ValueJson is a JSON string like {\"value\": ...}; on parse failure, keep raw.\nexport const parseValueJson = raw => {\n  if (raw === undefined || raw === null || raw === \"\") return null;\n  if (typeof raw !== \"string\") {\n    if (raw && typeof raw === \"object\" && \"value\" in raw) return raw.value;\n    return raw;\n  }\n  try {\n    const parsed = JSON.parse(raw);\n    if (parsed && typeof parsed === \"object\" && \"value\" in parsed) {\n      return parsed.value;\n    }\n    return parsed;\n  } catch {\n    return raw;\n  }\n};\n\nexport const normalizeDefinition = def => {\n  const optionsJson = pickFirst(def?.optionsJson, def?.OptionsJson);\n  const options = parseOptionsJson(optionsJson ?? def?.options ?? def?.Options);\n\n  return {\n    id: pickFirst(\n      def?.id,\n      def?.fieldId,\n      def?.FieldId,\n      def?.definitionId,\n      def?.DefinitionId,\n      def?.customFieldDefinitionId\n    ),\n    entityType: pickFirst(def?.entityType, def?.EntityType, DEFAULT_ENTITY_TYPE),\n    key: pickFirst(def?.key, def?.Key, \"\"),\n    label: pickFirst(def?.label, def?.Label, \"\"),\n    dataType: pickFirst(def?.dataType, def?.DataType, \"\"),\n    options,\n    isRequired: Boolean(pickFirst(def?.isRequired, def?.IsRequired, false)),\n    isActive: pickFirst(def?.isActive, def?.IsActive, true) !== false,\n    sortOrder: Number(pickFirst(def?.sortOrder, def?.SortOrder, 0)) || 0,\n  };\n};\n\nconst normalizeDefinitions = raw => {\n  const list = Array.isArray(raw) ? raw : [];\n  return list.map(normalizeDefinition).sort((a, b) => {\n    if (a.sortOrder !== b.sortOrder) return a.sortOrder - b.sortOrder;\n    return a.label.localeCompare(b.label);\n  });\n};\n\nconst normalizeSchemaWithValues = payload => {\n  const root = payload?.data ?? payload ?? {};\n\n  const defs =\n    root.definitions ??\n    root.Definitions ??\n    root.schema ??\n    root.Schema ??\n    root.fields ??\n    root.Fields ??\n    [];\n\n  const values =\n    root.values ??\n    root.Values ??\n    root.fieldValues ??\n    root.FieldValues ??\n    [];\n\n  const definitions = normalizeDefinitions(defs);\n  const valuesMap = {};\n\n  if (Array.isArray(values)) {\n    values.forEach(item => {\n      const fieldId = pickFirst(\n        item?.fieldId,\n        item?.FieldId,\n        item?.definitionId,\n        item?.DefinitionId\n      );\n      if (!fieldId) return;\n      const valueJson = pickFirst(item?.valueJson, item?.ValueJson, item?.json);\n      const value = parseValueJson(valueJson ?? item?.value ?? item?.Value);\n      valuesMap[fieldId] = value;\n    });\n  }\n\n  return { definitions, valuesMap };\n};\n\nexport const getCustomFieldDefinitions = async ({\n  entityType = DEFAULT_ENTITY_TYPE,\n  includeInactive = false,\n} = {}) => {\n  const normalizedEntityType = normalizeEntityType(entityType);\n  const res = await axiosClient.get(\"/customfields/definitions\", {\n    params: { entityType: normalizedEntityType, includeInactive },\n  });\n\n  const raw = res?.data?.data ?? res?.data ?? [];\n  return normalizeDefinitions(raw);\n};\n\nexport const createCustomFieldDefinition = async payload =>\n  axiosClient.post(\"/customfields/definitions\", payload);\n\nexport const updateCustomFieldDefinition = async (fieldId, payload) =>\n  axiosClient.put(`/customfields/definitions/${fieldId}`, payload);\n\nexport const deleteCustomFieldDefinition = async fieldId =>\n  axiosClient.delete(`/customfields/definitions/${fieldId}`);\n\nexport const getSchemaWithValues = async ({\n  entityType = DEFAULT_ENTITY_TYPE,\n  entityId,\n} = {}) => {\n  const normalizedEntityType = normalizeEntityType(entityType);\n  const res = await axiosClient.get(\"/customfields/schema-with-values\", {\n    params: { entityType: normalizedEntityType, entityId },\n  });\n  return normalizeSchemaWithValues(res?.data);\n};\n\nexport const upsertCustomFieldValues = async payload =>\n  axiosClient.put(\"/customfields/values\", payload);\n\nexport const CUSTOM_FIELD_DATA_TYPES = [\n  \"Text\",\n  \"Number\",\n  \"Date\",\n  \"Boolean\",\n  \"SingleSelect\",\n  \"MultiSelect\",\n];\n"],"names":["ContactsTopBar","_ref","onAddClick","onSearchChange","activeTab","onTabChange","searchTerm","onFilterClick","onImportClick","onDownloadSample","importing","activeFiltersCount","_jsxs","className","children","_jsx","Search","size","type","placeholder","value","onChange","e","target","onClick","concat","SlidersHorizontal","Download","disabled","Upload","Plus","key","label","map","tab","isActive","Checkbox","React","ref","checked","onCheckedChange","props","_objectWithoutProperties","_excluded","_objectSpread","displayName","DropdownMenu","Menu","as","DropdownMenuTrigger","_ref2","asChild","MenuButton","Fragment","DropdownMenuContent","_ref3","Transition","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","MenuItems","DropdownMenuItem","_ref4","MenuItem","_ref5","active","normalizeTagsResponse","res","_res$data$data","_res$data","payload","data","Array","isArray","ContactTagModal","isOpen","mode","contact","onClose","onUpdated","availableTags","setAvailableTags","selectedTagId","setSelectedTagId","loadingTags","setLoadingTags","saving","setSaving","existingTags","tags","contactTags","tagSummaries","tagList","getContactTags","async","_filtered$","_list$0$id","_list$","_list$2","list","firstId","id","tagId","String","all","axiosClient","get","length","_","fetchAllTags","existingIds","Set","t","_t$id","filter","Boolean","filtered","has","error","toast","load","title","emptyText","name","onSubmit","preventDefault","warn","Number","isFinite","body","contactIds","request","url","method","err","_err$response","status","response","post","success","_error$response","_error$response$data","message","tag","_tag$id","_tag$name","tagName","parseDate","d","Date","isNaN","getTime","dateRangeMatch","fromValue","toValue","from","to","end","setHours","coerceBool","s","toLowerCase","getComplianceBadges","optStatus","channelStatus","badges","push","applyLocalFilters","filters","_contact$createdAt","_contact$lastSeenAt","createdAt","created_at","lastSeenAt","last_seen_at","lastSeen","q","term","trim","email","phone","phoneNumber","includes","matchesSearch","createdFrom","createdTo","lastSeenFrom","lastSeenTo","optedInFilter","optedIn","_contact$optedIn","b","isOptedIn","isOptIn","blockedFilter","incomingBlocked","_contact$incomingBloc","isIncomingBlocked","isBlocked","matchesStatus","filterTagIds","tagIds","tagMatch","every","some","matchesTagsClientSide","ContactsTable","onEdit","refreshTrigger","onSelectionChange","selectedIds","currentPage","setCurrentPage","contacts","setContacts","useState","totalPages","setTotalPages","totalCount","setTotalCount","pageSize","setPageSize","tagModalOpen","setTagModalOpen","tagModalMode","setTagModalMode","tagModalContact","setTagModalContact","navigate","useNavigate","fetchContacts","useCallback","_res$data$data3","_res$data3","_ref6","_result$totalCount","_ref7","_result$pageSize","_result$totalPages","effectiveFilters","total","Math","max","ceil","safePage","min","start","pageItems","slice","attributes","_res$data$data2","_res$data2","advancedParams","JSON","stringify","params","search","page","result","items","Items","TotalCount","resolvedPageSize","PageSize","totalFromPayload","TotalPages","_err$response$data","useEffect","openTagModal","rowPadding","c","pageIds","undefined","merged","remaining","colSpan","idx","handleRowCheckbox","updated","i","badge","toLocaleDateString","MoreVertical","window","confirm","delete","_err$response2","_err$response2$data","handleDelete","closeTagModal","_Fragment","p","TagSelector","selected","multi","tagsProp","tagsState","setTagsState","fetchTags","console","safeTags","isSelected","handleToggle","notes","style","backgroundColor","colorHex","toDateInputValue","toISOString","formatDisplayValue","dataType","join","_unused","CustomFieldsEditor","entityType","entityId","definitions","setDefinitions","values","setValues","loading","setLoading","isViewMode","normalizedEntityType","useMemo","loadSchema","defs","valuesMap","getSchemaWithValues","normalizedValues","forEach","def","raw","orderedDefinitions","sort","a","sortOrder","handleValueChange","fieldId","nextValue","prev","_values$def$id","_values$def$id2","_values$def$id3","isRequired","options","option","handleMultiSelectToggle","current","item","parsed","upsertCustomFieldValues","_error$response2","_error$response2$data","leadSources","emailRegex","onSaveComplete","formData","setFormData","leadSource","allTags","setAllTags","isSaving","setIsSaving","touched","setTouched","submitAttempted","setSubmitAttempted","normalizePhoneValue","digits","replace","startsWith","phoneError","emailError","test","getEmailError","canSubmit","existing","handleChange","put","errorMessage","required","normalizedValue","maxLength","inputMode","autoComplete","source","open","ids","onClearSelection","onRefresh","normalize","_res","resolvedTagId","postErr","_postErr$response","results","Promise","allSettled","contactId","succeeded","r","_r$reason","_r$reason$response","reason","failed","normalizePhone","normalizeHeader","header","getRowValue","row","keys","CsvUploadModal","onImportingChange","file","setFile","validating","setValidating","checkingExisting","setCheckingExisting","uploading","setUploading","rowReports","setRowReports","hasValidated","setHasValidated","skipInvalid","setSkipInvalid","skipDuplicates","setSkipDuplicates","skipExisting","setSkipExisting","confirmOpen","setConfirmOpen","errorRows","errors","duplicateRows","isDuplicate","existingRows","existsInCrm","importableRows","totalRows","validRows","skippedRows","blockingReasons","reasons","canImport","resetState","accept","_e$target$files","files","index","rowNumber","phoneRaw","normalizedPhone","handleClose","handleValidate","endsWith","Papa","skipEmptyLines","transformHeader","complete","rows","reports","emailValue","seenPhones","report","add","phones","normalized","IsActive","checkExistingContacts","handleOpenConfirm","exportRows","Name","PhoneNumber","Email","LeadSource","Notes","csv","columns","blob","Blob","FormData","append","headers","Hash","createLucideIcon","x1","x2","y1","y2","startOfDay","date","endOfDay","yyyy","getFullYear","mm","getMonth","padStart","dd","getDate","DEFAULT_CONTACT_FILTERS","Object","freeze","lastSeenPreset","createdPreset","SECTIONS","icon","Calendar","Tag","Layers","StatusTab","setField","RadioGroup","opt","v","TagsTab","tagQuery","setTagQuery","toggleTag","selectedTagIds","normalizedTagQuery","visibleTags","RefreshCw","Check","DateRangeTab","presets","presetKey","onPreset","onFrom","onTo","AttributesTab","setFilters","attributeDefs","loadingAttributes","updateRow","patch","op","removeRow","splice","X","addRow","ContactsFilterModal","initialFilters","onApply","onClear","activeSection","setActiveSection","setTags","setAttributeDefs","setLoadingAttributes","getCustomFieldDefinitions","_unused2","applyPreset","section","now","getHours","setDate","setMonth","presetToRange","prefix","getSectionCount","_filters$tagIds","_filters$attributes","totalApplied","onMouseDown","stopPropagation","Filter","count","Icon","k","handleClearAll","Trash2","Contacts","isModalOpen","setIsModalOpen","editingContact","setEditingContact","setRefreshTrigger","setActiveTab","setSearchTerm","setSelectedIds","isImporting","setIsImporting","isImportModalOpen","setIsImportModalOpen","isFilterModalOpen","setIsFilterModalOpen","handleRefreshList","User","handleAddClick","handleImportClick","handleDownloadSample","formatPhoneForCsv","text","escapeCsv","URL","createObjectURL","link","document","createElement","href","download","appendChild","click","removeChild","revokeObjectURL","BulkActionsBar","handleClearSelection","nextFilters","handleClearFilters","ContactFormModal","handleModalClose","handleSaveComplete","handleImportModalClose","DEFAULT_ENTITY_TYPE","pickFirst","_len","arguments","_key","safeTrim","normalizeEntityType","buildOptionsPayload","normalizeDefinition","optionsJson","OptionsJson","_parsed$options","parse","Options","Values","parseOptionsJson","FieldId","definitionId","DefinitionId","customFieldDefinitionId","EntityType","Key","Label","DataType","IsRequired","SortOrder","normalizeDefinitions","localeCompare","normalizeSchemaWithValues","_payload$data","_ref8","_ref9","_ref0","_root$definitions","_ref1","_ref10","_ref11","_root$values","root","Definitions","schema","Schema","fields","Fields","fieldValues","FieldValues","_ref12","valueJson","ValueJson","json","parseValueJson","Value","_ref13","includeInactive","createCustomFieldDefinition","updateCustomFieldDefinition","deleteCustomFieldDefinition","CUSTOM_FIELD_DATA_TYPES"],"sourceRoot":""}